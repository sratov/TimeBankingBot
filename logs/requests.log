2025-05-31 12:07:26,899 - ================================================================================
2025-05-31 12:07:26,899 - Starting Time Banking API
2025-05-31 12:07:26,899 - ================================================================================
2025-05-31 12:07:26,899 - Bot token: 80221..._4-bU (length: 46)
2025-05-31 12:08:22,122 - ================================================================================
2025-05-31 12:08:22,122 - Starting Time Banking API
2025-05-31 12:08:22,122 - ================================================================================
2025-05-31 12:08:22,122 - Bot token: 80221..._4-bU (length: 46)
2025-05-31 12:08:31,618 - [107a60db-614d-4c4b-a23b-519c0ce7190d] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:08:31,622 - Error in protected route: module 'jwt' has no attribute 'ExpiredSignatureError'
Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 1725, in protected_route
    payload = jwt.decode(access_token, JWT_SECRET_KEY, algorithms=[JWT_ALGORITHM])
              ^^^^^^^^^^
AttributeError: module 'jwt' has no attribute 'decode'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 1731, in protected_route
    except jwt.ExpiredSignatureError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: module 'jwt' has no attribute 'ExpiredSignatureError'
2025-05-31 12:08:31,624 - HTTP exception: 500 - Internal server error
2025-05-31 12:08:31,625 - [107a60db-614d-4c4b-a23b-519c0ce7190d] Response status: 500 - Completed in 0.0062s
2025-05-31 12:08:32,094 - [2d391b11-d9cd-416d-9557-971574d8854f] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:08:32,095 - [2d391b11-d9cd-416d-9557-971574d8854f] Request body for POST will be processed by endpoint.
2025-05-31 12:08:32,095 - 

********************************************************************************
2025-05-31 12:08:32,096 - === Starting Telegram Authentication ===
2025-05-31 12:08:32,097 - ********************************************************************************
2025-05-31 12:08:32,101 - Successfully read entire body (POST), length: 580
2025-05-31 12:08:32,101 - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:08:32,108 - Verifying Telegram hash...
2025-05-31 12:08:32,109 - Hash verification successful
2025-05-31 12:08:32,109 - Parsing user data...
2025-05-31 12:08:32,109 - Looking up user with telegram_id: 887978091
2025-05-31 12:08:32,109 - Database error: 'dict' object has no attribute 'query'
Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 1537, in telegram_auth
    user = db.query(models.User).filter(models.User.telegram_id == telegram_id).first()
           ^^^^^^^^
AttributeError: 'dict' object has no attribute 'query'
2025-05-31 12:08:32,109 - Authentication failed with HTTPException
2025-05-31 12:08:32,109 - HTTP exception: 500 - Database error
2025-05-31 12:08:32,109 - [2d391b11-d9cd-416d-9557-971574d8854f] Response status: 500 - Completed in 0.0139s
2025-05-31 12:08:32,579 - [18f37d3c-fd25-4623-9adf-647b87bb6e93] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:08:32,580 - [18f37d3c-fd25-4623-9adf-647b87bb6e93] Request body for POST will be processed by endpoint.
2025-05-31 12:08:32,581 - 

********************************************************************************
2025-05-31 12:08:32,582 - === Starting Telegram Authentication ===
2025-05-31 12:08:32,582 - ********************************************************************************
2025-05-31 12:08:32,587 - Successfully read entire body (POST), length: 579
2025-05-31 12:08:32,592 - Got init_data from JSON body (POST), test_mode=True
2025-05-31 12:08:32,592 - Test mode detected in /auth/telegram! Creating test user...
2025-05-31 12:08:32,592 - Attempt 1: Error reading request body (POST): 'dict' object has no attribute 'query'
Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 1333, in telegram_auth
    db.query(models.User).filter(models.User.telegram_id == 12345).first()
    ^^^^^^^^
AttributeError: 'dict' object has no attribute 'query'
2025-05-31 12:08:32,596 - Test mode active - bypassing hash verification
2025-05-31 12:08:32,597 - Error in test mode: 'dict' object has no attribute 'query'
2025-05-31 12:08:32,597 - 'dict' object has no attribute 'query'
Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 1423, in telegram_auth
    test_user = db.query(models.User).filter(models.User.telegram_id == 12345).first()
                ^^^^^^^^
AttributeError: 'dict' object has no attribute 'query'
2025-05-31 12:08:32,598 - Authentication failed with HTTPException
2025-05-31 12:08:32,599 - HTTP exception: 500 - Error in test mode
2025-05-31 12:08:32,599 - [18f37d3c-fd25-4623-9adf-647b87bb6e93] Response status: 500 - Completed in 0.0191s
2025-05-31 12:08:33,497 - [76e42fd6-e735-421f-a85d-30d87eee2d2e] Request from 77.91.101.132:0 - POST /debug/auth/
2025-05-31 12:08:33,498 - [76e42fd6-e735-421f-a85d-30d87eee2d2e] Request body for POST will be processed by endpoint.
2025-05-31 12:08:33,499 - 

********************************************************************************
2025-05-31 12:08:33,499 - === Starting Debug Auth POST ===
2025-05-31 12:08:33,499 - ********************************************************************************
2025-05-31 12:08:33,500 - Successfully read body for /debug/auth POST, length: 44
2025-05-31 12:08:33,501 - Creating/fetching test user for /debug/auth: telegram_id=12345, username=test_user
2025-05-31 12:08:33,502 - [76e42fd6-e735-421f-a85d-30d87eee2d2e] Error during request processing: 'dict' object has no attribute 'query'
2025-05-31 12:08:33,559 - [76e42fd6-e735-421f-a85d-30d87eee2d2e] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 200, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 1038, in debug_auth_post
    user = db.query(models.User).filter(models.User.telegram_id == telegram_id).first()
           ^^^^^^^^
AttributeError: 'dict' object has no attribute 'query'

2025-05-31 12:08:33,559 - [76e42fd6-e735-421f-a85d-30d87eee2d2e] Failed after 0.0042s
2025-05-31 12:08:33,559 - Unhandled exception: 'dict' object has no attribute 'query'
2025-05-31 12:08:33,593 - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 200, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 1038, in debug_auth_post
    user = db.query(models.User).filter(models.User.telegram_id == telegram_id).first()
           ^^^^^^^^
AttributeError: 'dict' object has no attribute 'query'

2025-05-31 12:13:22,313 - ================================================================================
2025-05-31 12:13:22,313 - Starting Time Banking API
2025-05-31 12:13:22,314 - ================================================================================
2025-05-31 12:13:22,314 - Bot token: 80221..._4-bU (length: 46)
2025-05-31 12:17:51,736 - ================================================================================
2025-05-31 12:17:51,736 - Starting Time Banking API
2025-05-31 12:17:51,736 - ================================================================================
2025-05-31 12:17:51,737 - Bot token: 80221..._4-bU (length: 46)
2025-05-31 12:18:19,757 - [9b53607f-0cd6-46a4-8eb6-723cfdbd8619] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:18:19,762 - [9b53607f-0cd6-46a4-8eb6-723cfdbd8619] Response status: 200 - Completed in 0.0047s
2025-05-31 12:18:20,193 - [5df461a6-a791-4f53-91d8-ede3ff642ee9] Request from 77.91.101.132:0 - GET /user/me/
2025-05-31 12:18:20,195 - [5df461a6-a791-4f53-91d8-ede3ff642ee9] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:18:20,217 - [5df461a6-a791-4f53-91d8-ede3ff642ee9] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:18:20,217 - [5df461a6-a791-4f53-91d8-ede3ff642ee9] Failed after 0.0016s
2025-05-31 12:18:20,232 - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:18:20,232 - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:18:20,620 - [a634f376-7064-4961-8223-19e949eccb39] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:18:20,620 - [a634f376-7064-4961-8223-19e949eccb39] Request body for POST will be processed by endpoint.
2025-05-31 12:18:20,622 - 

********************************************************************************
2025-05-31 12:18:20,622 - === Starting Telegram Authentication ===
2025-05-31 12:18:20,623 - ********************************************************************************
2025-05-31 12:18:20,632 - Successfully read entire body (POST), length: 580
2025-05-31 12:18:20,632 - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:18:20,632 - Verifying Telegram hash...
2025-05-31 12:18:20,632 - Hash verification successful
2025-05-31 12:18:20,632 - Parsing user data...
2025-05-31 12:18:20,632 - Looking up user with telegram_id: 887978091
2025-05-31 12:18:20,649 - Found existing user: sar_a_to_v (ID: 2, Telegram ID: 887978091)
2025-05-31 12:18:20,649 - Creating JWT tokens for user: sar_a_to_v
2025-05-31 12:18:20,651 - === Authentication Successful ===
2025-05-31 12:18:20,651 - ********************************************************************************


2025-05-31 12:18:20,651 - [a634f376-7064-4961-8223-19e949eccb39] Response status: 200 - Completed in 0.0308s
2025-05-31 12:18:21,345 - [4597c1d7-0759-4ab3-9a89-aa2018f4d1f4] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:18:21,347 - [4597c1d7-0759-4ab3-9a89-aa2018f4d1f4] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:18:21,348 - [4597c1d7-0759-4ab3-9a89-aa2018f4d1f4] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:18:21,349 - [4597c1d7-0759-4ab3-9a89-aa2018f4d1f4] Failed after 0.0015s
2025-05-31 12:18:21,350 - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:18:21,351 - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:18:23,195 - [71cc148d-3f40-48e6-8e10-f4cfc0e0bd89] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:18:23,196 - [848f85c3-1bc8-4adf-b225-87b1c4b77afa] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:18:23,209 - [09eab5ab-31e6-40f5-9514-1e2cb7bf8935] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:18:23,209 - [d8611f1c-e0b3-41f2-a36a-d2006b2baf6b] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:18:23,210 - [848f85c3-1bc8-4adf-b225-87b1c4b77afa] Response status: 200 - Completed in 0.0136s
2025-05-31 12:18:23,213 - [71cc148d-3f40-48e6-8e10-f4cfc0e0bd89] Response status: 200 - Completed in 0.0172s
2025-05-31 12:18:23,215 - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:18:23,220 - [09eab5ab-31e6-40f5-9514-1e2cb7bf8935] Response status: 200 - Completed in 0.0112s
2025-05-31 12:18:23,221 - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:18:23,224 - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:18:23,225 - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:18:23,226 - [d8611f1c-e0b3-41f2-a36a-d2006b2baf6b] Response status: 200 - Completed in 0.0164s
2025-05-31 12:18:23,393 - [548992b4-a414-4590-b159-8ad56da5fd81] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:18:23,398 - [548992b4-a414-4590-b159-8ad56da5fd81] Response status: 200 - Completed in 0.0043s
2025-05-31 12:18:23,436 - [8386b47b-f846-4846-b038-d615474a13eb] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:18:23,437 - [214b7710-0fab-4f49-a78d-42aeed26577e] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:18:23,441 - [8386b47b-f846-4846-b038-d615474a13eb] Response status: 200 - Completed in 0.0042s
2025-05-31 12:18:23,444 - [214b7710-0fab-4f49-a78d-42aeed26577e] Response status: 200 - Completed in 0.0066s
2025-05-31 12:18:23,448 - [9ae0c4c8-540f-422f-b308-c71ee0f0aac7] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:18:23,451 - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:18:23,452 - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:18:23,453 - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:18:23,454 - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:18:23,456 - [9ae0c4c8-540f-422f-b308-c71ee0f0aac7] Response status: 200 - Completed in 0.0063s
2025-05-31 12:18:26,170 - [fbf42733-26fe-49aa-8906-b12b548a2a99] Request from 77.91.101.132:0 - POST /profile/2/avatar/
2025-05-31 12:18:26,170 - [fbf42733-26fe-49aa-8906-b12b548a2a99] Request body for POST will be processed by endpoint.
2025-05-31 12:18:26,182 - [fbf42733-26fe-49aa-8906-b12b548a2a99] Response status: 200 - Completed in 0.0114s
2025-05-31 12:18:26,355 - [34013895-f24e-40f9-b549-1fe14ac5af8c] Request from 77.91.101.132:0 - GET /static/avatars/user_2_avatar_1748683106.jpg
2025-05-31 12:18:26,413 - [34013895-f24e-40f9-b549-1fe14ac5af8c] Response status: 200 - Completed in 0.0570s
2025-05-31 12:18:35,635 - [8ea03a1b-b016-4230-aad1-e697adf81714] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:18:35,637 - [8ea03a1b-b016-4230-aad1-e697adf81714] Response status: 200 - Completed in 0.0011s
2025-05-31 12:18:35,851 - [824a126c-896e-4209-bb56-123d49b11f9e] Request from 77.91.101.132:0 - GET /user/me/
2025-05-31 12:18:35,854 - [824a126c-896e-4209-bb56-123d49b11f9e] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:18:35,855 - [824a126c-896e-4209-bb56-123d49b11f9e] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:18:35,856 - [824a126c-896e-4209-bb56-123d49b11f9e] Failed after 0.0016s
2025-05-31 12:18:35,856 - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:18:35,857 - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:18:36,337 - [a34783b8-6c0a-4ba1-8e52-4aa8740e2dc8] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:18:36,338 - [a34783b8-6c0a-4ba1-8e52-4aa8740e2dc8] Request body for POST will be processed by endpoint.
2025-05-31 12:18:36,339 - 

********************************************************************************
2025-05-31 12:18:36,340 - === Starting Telegram Authentication ===
2025-05-31 12:18:36,340 - ********************************************************************************
2025-05-31 12:18:36,349 - Successfully read entire body (POST), length: 580
2025-05-31 12:18:36,351 - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:18:36,354 - Verifying Telegram hash...
2025-05-31 12:18:36,361 - Hash verification successful
2025-05-31 12:18:36,361 - Parsing user data...
2025-05-31 12:18:36,362 - Looking up user with telegram_id: 887978091
2025-05-31 12:18:36,362 - Found existing user: sar_a_to_v (ID: 2, Telegram ID: 887978091)
2025-05-31 12:18:36,362 - Updated avatar URL to: https://t.me/i/userpic/320/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg
2025-05-31 12:18:36,367 - Creating JWT tokens for user: sar_a_to_v
2025-05-31 12:18:36,367 - === Authentication Successful ===
2025-05-31 12:18:36,367 - ********************************************************************************


2025-05-31 12:18:36,367 - [a34783b8-6c0a-4ba1-8e52-4aa8740e2dc8] Response status: 200 - Completed in 0.0285s
2025-05-31 12:18:36,617 - [3466c4bb-ccce-48ca-ab27-a3bc2879c396] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:18:36,619 - [3466c4bb-ccce-48ca-ab27-a3bc2879c396] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:18:36,620 - [3466c4bb-ccce-48ca-ab27-a3bc2879c396] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:18:36,621 - [3466c4bb-ccce-48ca-ab27-a3bc2879c396] Failed after 0.0018s
2025-05-31 12:18:36,622 - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:18:36,624 - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:18:39,290 - [b4fe8d00-6003-4929-bad7-3d8bb54dbbbb] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:18:39,291 - [ec6a467b-3ec5-445d-b203-2a70a2c877fd] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:18:39,291 - [db619207-12ba-486a-8d84-2052290ad796] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:18:39,293 - [41f9f09f-e425-4f72-8c5f-d40df6c86dc7] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:18:39,293 - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:18:39,300 - [b4fe8d00-6003-4929-bad7-3d8bb54dbbbb] Response status: 200 - Completed in 0.0103s
2025-05-31 12:18:39,301 - [ec6a467b-3ec5-445d-b203-2a70a2c877fd] Response status: 200 - Completed in 0.0097s
2025-05-31 12:18:39,301 - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:18:39,307 - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:18:39,308 - [41f9f09f-e425-4f72-8c5f-d40df6c86dc7] Response status: 200 - Completed in 0.0144s
2025-05-31 12:18:39,309 - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:18:39,312 - [db619207-12ba-486a-8d84-2052290ad796] Response status: 200 - Completed in 0.0207s
2025-05-31 12:18:39,471 - [a1af17c0-0514-4c93-a80c-96945acc5b29] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:18:39,472 - [10d5fa31-5924-4990-9cee-4470c9d7680d] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:18:39,476 - [a1af17c0-0514-4c93-a80c-96945acc5b29] Response status: 200 - Completed in 0.0042s
2025-05-31 12:18:39,476 - [10d5fa31-5924-4990-9cee-4470c9d7680d] Response status: 200 - Completed in 0.0036s
2025-05-31 12:18:39,517 - [213bd5d4-56e7-44c4-b98d-3d94148f3a59] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:18:39,518 - [4ec0b2a7-7585-4436-88da-0bbe33d5d946] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:18:39,520 - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:18:39,522 - [4ec0b2a7-7585-4436-88da-0bbe33d5d946] Response status: 200 - Completed in 0.0036s
2025-05-31 12:18:39,523 - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:18:39,524 - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:18:39,526 - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:18:39,527 - [213bd5d4-56e7-44c4-b98d-3d94148f3a59] Response status: 200 - Completed in 0.0098s
2025-05-31 12:19:01,021 - [1943f22f-37ce-48e0-bf4d-81f9b15fd250] Request from 77.91.101.132:0 - GET /users/search/
2025-05-31 12:19:01,023 - [1943f22f-37ce-48e0-bf4d-81f9b15fd250] Query params: {'username': 'en7ka'}
2025-05-31 12:19:01,030 - [1943f22f-37ce-48e0-bf4d-81f9b15fd250] Response status: 200 - Completed in 0.0066s
2025-05-31 12:19:04,821 - [bbab433a-72cb-42ab-af7c-653f250e274c] Request from 77.91.101.132:0 - POST /friends/request/
2025-05-31 12:19:04,822 - [bbab433a-72cb-42ab-af7c-653f250e274c] Request body for POST will be processed by endpoint.
2025-05-31 12:19:04,843 - [bbab433a-72cb-42ab-af7c-653f250e274c] Response status: 200 - Completed in 0.0199s
2025-05-31 12:19:05,060 - [73d88e35-254b-487e-878a-7ccfdf2d1891] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:19:05,065 - [73d88e35-254b-487e-878a-7ccfdf2d1891] Response status: 200 - Completed in 0.0039s
2025-05-31 12:19:06,098 - [6bc5ce8a-289b-46ce-9bc1-d3d6d8d58b33] Request from 77.91.101.132:0 - POST /friends/request/
2025-05-31 12:19:06,099 - [6bc5ce8a-289b-46ce-9bc1-d3d6d8d58b33] Request body for POST will be processed by endpoint.
2025-05-31 12:19:06,103 - HTTP exception: 400 - Friend request already exists
2025-05-31 12:19:06,104 - [6bc5ce8a-289b-46ce-9bc1-d3d6d8d58b33] Response status: 400 - Completed in 0.0043s
2025-05-31 12:19:16,763 - [4c4e4100-063d-4355-a170-0e61c362dfca] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:19:16,766 - [4c4e4100-063d-4355-a170-0e61c362dfca] Response status: 200 - Completed in 0.0017s
2025-05-31 12:19:16,965 - [8eff9db0-d3ff-4809-80b7-d7291d272521] Request from 77.91.101.132:0 - GET /user/me/
2025-05-31 12:19:16,968 - [8eff9db0-d3ff-4809-80b7-d7291d272521] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:19:16,969 - [8eff9db0-d3ff-4809-80b7-d7291d272521] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:19:16,971 - [8eff9db0-d3ff-4809-80b7-d7291d272521] Failed after 0.0021s
2025-05-31 12:19:16,972 - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:19:16,976 - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:19:17,404 - [b3e5a093-4a55-4ac1-a430-f47f1ca25cd6] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:19:17,406 - [b3e5a093-4a55-4ac1-a430-f47f1ca25cd6] Request body for POST will be processed by endpoint.
2025-05-31 12:19:17,408 - 

********************************************************************************
2025-05-31 12:19:17,408 - === Starting Telegram Authentication ===
2025-05-31 12:19:17,409 - ********************************************************************************
2025-05-31 12:19:17,423 - Successfully read entire body (POST), length: 580
2025-05-31 12:19:17,426 - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:19:17,426 - Verifying Telegram hash...
2025-05-31 12:19:17,439 - Hash verification successful
2025-05-31 12:19:17,439 - Parsing user data...
2025-05-31 12:19:17,439 - Looking up user with telegram_id: 887978091
2025-05-31 12:19:17,439 - Found existing user: sar_a_to_v (ID: 2, Telegram ID: 887978091)
2025-05-31 12:19:17,439 - Creating JWT tokens for user: sar_a_to_v
2025-05-31 12:19:17,439 - === Authentication Successful ===
2025-05-31 12:19:17,439 - ********************************************************************************


2025-05-31 12:19:17,439 - [b3e5a093-4a55-4ac1-a430-f47f1ca25cd6] Response status: 200 - Completed in 0.0329s
2025-05-31 12:19:17,680 - [25ca86cf-af46-4ec5-956a-558071b9a1d6] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:19:17,682 - [25ca86cf-af46-4ec5-956a-558071b9a1d6] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:19:17,686 - [25ca86cf-af46-4ec5-956a-558071b9a1d6] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:19:17,688 - [25ca86cf-af46-4ec5-956a-558071b9a1d6] Failed after 0.0017s
2025-05-31 12:19:17,689 - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:19:17,691 - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:19:19,864 - [c3b80711-08da-4196-b3f7-b334561fa424] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:19:19,872 - [14637f35-74d7-4c41-b241-e167c5810220] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:19:19,874 - [c4a24266-55f7-47e1-9b7d-1b71618024ae] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:19:19,874 - [2ce3cafc-2816-4ba8-a507-5726ded19b90] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:19:19,887 - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:19:19,892 - [c3b80711-08da-4196-b3f7-b334561fa424] Response status: 200 - Completed in 0.0204s
2025-05-31 12:19:19,892 - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:19:19,900 - [c4a24266-55f7-47e1-9b7d-1b71618024ae] Response status: 200 - Completed in 0.0259s
2025-05-31 12:19:19,900 - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:19:19,904 - [14637f35-74d7-4c41-b241-e167c5810220] Response status: 200 - Completed in 0.0298s
2025-05-31 12:19:19,904 - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:19:19,911 - [2ce3cafc-2816-4ba8-a507-5726ded19b90] Response status: 200 - Completed in 0.0370s
2025-05-31 12:19:20,114 - [65101505-2067-449a-b441-396d7d0c2c39] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:19:20,120 - [65101505-2067-449a-b441-396d7d0c2c39] Response status: 200 - Completed in 0.0050s
2025-05-31 12:19:20,140 - [d0c59ac8-72aa-4c2c-a83f-fd38c3707cc9] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:19:20,140 - [bbb540a8-7fa2-4921-a711-d8f11d79e7f9] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:19:20,140 - [6b3b99d9-a1be-4410-8f30-41b7916f48d2] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:19:20,147 - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:19:20,147 - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:19:20,156 - [6b3b99d9-a1be-4410-8f30-41b7916f48d2] Response status: 200 - Completed in 0.0154s
2025-05-31 12:19:20,156 - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:19:20,160 - [bbb540a8-7fa2-4921-a711-d8f11d79e7f9] Response status: 200 - Completed in 0.0200s
2025-05-31 12:19:20,162 - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:19:20,167 - [d0c59ac8-72aa-4c2c-a83f-fd38c3707cc9] Response status: 200 - Completed in 0.0277s
2025-05-31 12:19:26,722 - [2a5c66dc-9b44-4901-827e-39a2ea8c688c] Request from 77.91.101.132:0 - POST /friends/request/
2025-05-31 12:19:26,722 - [2a5c66dc-9b44-4901-827e-39a2ea8c688c] Request body for POST will be processed by endpoint.
2025-05-31 12:19:26,726 - HTTP exception: 400 - Friend request already exists
2025-05-31 12:19:26,727 - [2a5c66dc-9b44-4901-827e-39a2ea8c688c] Response status: 400 - Completed in 0.0041s
2025-05-31 12:19:28,559 - [304a1b1a-3c06-4992-be6a-538b28dd107d] Request from 77.91.101.132:0 - POST /friends/request/
2025-05-31 12:19:28,560 - [304a1b1a-3c06-4992-be6a-538b28dd107d] Request body for POST will be processed by endpoint.
2025-05-31 12:19:28,564 - HTTP exception: 400 - Friend request already exists
2025-05-31 12:19:28,565 - [304a1b1a-3c06-4992-be6a-538b28dd107d] Response status: 400 - Completed in 0.0044s
2025-05-31 12:19:35,701 - [672529af-ec0e-4ede-9d89-bbc5d82744ee] Request from 77.91.101.132:0 - POST /listings/8/accept/
2025-05-31 12:19:35,703 - [672529af-ec0e-4ede-9d89-bbc5d82744ee] Request body for POST will be processed by endpoint.
2025-05-31 12:19:35,727 - [672529af-ec0e-4ede-9d89-bbc5d82744ee] Response status: 200 - Completed in 0.0241s
2025-05-31 12:19:40,813 - [bb00678d-406f-4c4c-9303-ae789c16d4d6] Request from 77.91.101.132:0 - POST /friends/request/
2025-05-31 12:19:40,814 - [bb00678d-406f-4c4c-9303-ae789c16d4d6] Request body for POST will be processed by endpoint.
2025-05-31 12:19:40,817 - HTTP exception: 400 - Friend request already exists
2025-05-31 12:19:40,817 - [bb00678d-406f-4c4c-9303-ae789c16d4d6] Response status: 400 - Completed in 0.0032s
2025-05-31 12:21:15,292 - [93ec43e5-a491-482e-870c-05f57d7be617] Request from 5.35.38.40:0 - GET /auth/protected/
2025-05-31 12:21:15,295 - HTTP exception: 401 - Not authenticated
2025-05-31 12:21:15,296 - [93ec43e5-a491-482e-870c-05f57d7be617] Response status: 401 - Completed in 0.0027s
2025-05-31 12:21:15,697 - [6a4ef3b7-8732-4c15-9007-7f015636c6ad] Request from 5.35.38.40:0 - POST /auth/telegram/
2025-05-31 12:21:15,698 - [6a4ef3b7-8732-4c15-9007-7f015636c6ad] Request body for POST will be processed by endpoint.
2025-05-31 12:21:15,699 - HTTP exception: 401 - Not authenticated
2025-05-31 12:21:15,700 - [6a4ef3b7-8732-4c15-9007-7f015636c6ad] Response status: 401 - Completed in 0.0022s
2025-05-31 12:21:16,774 - [06d34788-ec4c-4d1a-8172-f2990c06b065] Request from 5.35.38.40:0 - POST /auth/telegram/
2025-05-31 12:21:16,775 - [06d34788-ec4c-4d1a-8172-f2990c06b065] Request body for POST will be processed by endpoint.
2025-05-31 12:21:16,778 - HTTP exception: 401 - Not authenticated
2025-05-31 12:21:16,778 - [06d34788-ec4c-4d1a-8172-f2990c06b065] Response status: 401 - Completed in 0.0022s
2025-05-31 12:21:17,195 - [af7b3b37-fad5-4c57-b802-b404a0fdd862] Request from 5.35.38.40:0 - POST /debug/auth/
2025-05-31 12:21:17,196 - [af7b3b37-fad5-4c57-b802-b404a0fdd862] Request body for POST will be processed by endpoint.
2025-05-31 12:21:17,198 - 

********************************************************************************
2025-05-31 12:21:17,199 - === Starting Debug Auth POST ===
2025-05-31 12:21:17,199 - ********************************************************************************
2025-05-31 12:21:17,201 - Successfully read body for /debug/auth POST, length: 44
2025-05-31 12:21:17,202 - Creating/fetching test user for /debug/auth: telegram_id=12345, username=test_user
2025-05-31 12:21:17,203 - User 12345 found in database, using existing user
2025-05-31 12:21:17,203 - [af7b3b37-fad5-4c57-b802-b404a0fdd862] Response status: 200 - Completed in 0.0070s
2025-05-31 12:21:21,309 - [2e50e485-cb4a-4d53-a94c-d7459be22d4e] Request from 5.35.38.40:0 - GET /listings/
2025-05-31 12:21:21,311 - [2e50e485-cb4a-4d53-a94c-d7459be22d4e] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:21:21,314 - [2e50e485-cb4a-4d53-a94c-d7459be22d4e] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:21:21,315 - [2e50e485-cb4a-4d53-a94c-d7459be22d4e] Failed after 0.0016s
2025-05-31 12:21:21,315 - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:21:21,320 - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:22:53,810 - [90982f29-c422-44dc-8e2b-1d7ee3acf8b7] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:22:53,812 - HTTP exception: 401 - Not authenticated
2025-05-31 12:22:53,813 - [90982f29-c422-44dc-8e2b-1d7ee3acf8b7] Response status: 401 - Completed in 0.0028s
2025-05-31 12:22:54,196 - [6f9ff956-95b5-48d9-8f8e-63f8524a10d1] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:22:54,198 - [6f9ff956-95b5-48d9-8f8e-63f8524a10d1] Request body for POST will be processed by endpoint.
2025-05-31 12:22:54,200 - HTTP exception: 401 - Not authenticated
2025-05-31 12:22:54,200 - [6f9ff956-95b5-48d9-8f8e-63f8524a10d1] Response status: 401 - Completed in 0.0022s
2025-05-31 12:22:54,632 - [99ccf10f-dd7c-40e2-8ec1-878f4358d0e0] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:22:54,633 - [99ccf10f-dd7c-40e2-8ec1-878f4358d0e0] Request body for POST will be processed by endpoint.
2025-05-31 12:22:54,636 - HTTP exception: 401 - Not authenticated
2025-05-31 12:22:54,636 - [99ccf10f-dd7c-40e2-8ec1-878f4358d0e0] Response status: 401 - Completed in 0.0024s
2025-05-31 12:22:55,013 - [d6f3d70f-486f-4da4-aa1d-02346488f7bc] Request from 77.91.101.132:0 - POST /debug/auth/
2025-05-31 12:22:55,014 - [d6f3d70f-486f-4da4-aa1d-02346488f7bc] Request body for POST will be processed by endpoint.
2025-05-31 12:22:55,015 - 

********************************************************************************
2025-05-31 12:22:55,016 - === Starting Debug Auth POST ===
2025-05-31 12:22:55,016 - ********************************************************************************
2025-05-31 12:22:55,017 - Successfully read body for /debug/auth POST, length: 44
2025-05-31 12:22:55,017 - Creating/fetching test user for /debug/auth: telegram_id=12345, username=test_user
2025-05-31 12:22:55,017 - User 12345 found in database, using existing user
2025-05-31 12:22:55,021 - [d6f3d70f-486f-4da4-aa1d-02346488f7bc] Response status: 200 - Completed in 0.0064s
2025-05-31 12:22:57,046 - [1341a3d2-d790-4563-b645-8361b65bf0aa] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:22:57,049 - [1341a3d2-d790-4563-b645-8361b65bf0aa] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:22:57,050 - [1341a3d2-d790-4563-b645-8361b65bf0aa] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:22:57,051 - [1341a3d2-d790-4563-b645-8361b65bf0aa] Failed after 0.0017s
2025-05-31 12:22:57,053 - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:22:57,056 - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:22:58,294 - [78c0e03e-af28-406f-ac4c-6be51540f0e0] Request from 77.91.101.132:0 - GET /listings/user/1/
2025-05-31 12:22:58,297 - [ce7c206e-ced3-4757-a4e4-5e2576ba0dd0] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:22:58,301 - [ce7c206e-ced3-4757-a4e4-5e2576ba0dd0] Response status: 200 - Completed in 0.0043s
2025-05-31 12:22:58,306 - [78c0e03e-af28-406f-ac4c-6be51540f0e0] Response status: 200 - Completed in 0.0105s
2025-05-31 12:22:58,318 - [56093740-981d-4f5a-8506-8677faf51f61] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:22:58,323 - [56093740-981d-4f5a-8506-8677faf51f61] Response status: 200 - Completed in 0.0045s
2025-05-31 12:22:58,353 - [02ab9595-9448-4e41-971f-d3904bd986dc] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:22:58,356 - [GetTransactionPartners] Fetching transaction partners for user_id: 1
2025-05-31 12:22:58,358 - [GetTransactionPartners] Found 0 completed listings involving user 1
2025-05-31 12:22:58,358 - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:22:58,358 - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:22:58,358 - [02ab9595-9448-4e41-971f-d3904bd986dc] Response status: 200 - Completed in 0.0039s
2025-05-31 12:22:58,507 - [7ded179c-0507-41ac-be86-77d2417c37dc] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:22:58,508 - [049caa85-092c-49fd-bd29-e46798f46132] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:22:58,509 - [620998cb-16bc-48af-959f-2b89bbdf12c3] Request from 77.91.101.132:0 - GET /listings/user/1/
2025-05-31 12:22:58,516 - [049caa85-092c-49fd-bd29-e46798f46132] Response status: 200 - Completed in 0.0070s
2025-05-31 12:22:58,516 - [7ded179c-0507-41ac-be86-77d2417c37dc] Response status: 200 - Completed in 0.0076s
2025-05-31 12:22:58,523 - [620998cb-16bc-48af-959f-2b89bbdf12c3] Response status: 200 - Completed in 0.0139s
2025-05-31 12:22:58,534 - [26db709e-96ca-49a2-b02d-380169735d6b] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:22:58,536 - [GetTransactionPartners] Fetching transaction partners for user_id: 1
2025-05-31 12:22:58,538 - [GetTransactionPartners] Found 0 completed listings involving user 1
2025-05-31 12:22:58,538 - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:22:58,538 - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:22:58,538 - [26db709e-96ca-49a2-b02d-380169735d6b] Response status: 200 - Completed in 0.0033s
2025-05-31 12:23:19,726 - [b01c4f11-545b-42ea-96b0-32ff935e003f] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:23:19,728 - [b01c4f11-545b-42ea-96b0-32ff935e003f] Response status: 200 - Completed in 0.0017s
2025-05-31 12:23:19,947 - [e7e746d0-248d-48fb-88da-ea2c2f68e3e3] Request from 77.91.101.132:0 - GET /user/me/
2025-05-31 12:23:19,949 - [e7e746d0-248d-48fb-88da-ea2c2f68e3e3] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:23:19,952 - [e7e746d0-248d-48fb-88da-ea2c2f68e3e3] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:23:19,954 - [e7e746d0-248d-48fb-88da-ea2c2f68e3e3] Failed after 0.0016s
2025-05-31 12:23:19,954 - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:23:19,956 - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:23:20,412 - [fb206b74-6cfc-4345-bd10-9edaf0e75da4] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:23:20,413 - [fb206b74-6cfc-4345-bd10-9edaf0e75da4] Request body for POST will be processed by endpoint.
2025-05-31 12:23:20,415 - 

********************************************************************************
2025-05-31 12:23:20,416 - === Starting Telegram Authentication ===
2025-05-31 12:23:20,417 - ********************************************************************************
2025-05-31 12:23:20,427 - Successfully read entire body (POST), length: 580
2025-05-31 12:23:20,427 - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:23:20,435 - Verifying Telegram hash...
2025-05-31 12:23:20,438 - Hash verification successful
2025-05-31 12:23:20,438 - Parsing user data...
2025-05-31 12:23:20,438 - Looking up user with telegram_id: 887978091
2025-05-31 12:23:20,446 - Found existing user: sar_a_to_v (ID: 2, Telegram ID: 887978091)
2025-05-31 12:23:20,446 - Creating JWT tokens for user: sar_a_to_v
2025-05-31 12:23:20,450 - === Authentication Successful ===
2025-05-31 12:23:20,451 - ********************************************************************************


2025-05-31 12:23:20,452 - [fb206b74-6cfc-4345-bd10-9edaf0e75da4] Response status: 200 - Completed in 0.0383s
2025-05-31 12:23:20,730 - [65bbb3bf-ee54-45be-8888-4915dc000230] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:23:20,734 - [65bbb3bf-ee54-45be-8888-4915dc000230] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:23:20,736 - [65bbb3bf-ee54-45be-8888-4915dc000230] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:23:20,737 - [65bbb3bf-ee54-45be-8888-4915dc000230] Failed after 0.0027s
2025-05-31 12:23:20,738 - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:23:20,741 - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:23:23,395 - [8fb0d098-04a2-4671-90ed-d704671dffc9] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:23:23,402 - [8fb0d098-04a2-4671-90ed-d704671dffc9] Response status: 200 - Completed in 0.0058s
2025-05-31 12:23:23,490 - [92176884-e860-415f-a93a-bbec1f187902] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:23:23,493 - [baf14adb-b8b4-4d77-8e1b-12dd85fcbc74] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:23:23,493 - [f2a9955e-dafa-4102-8d99-c8409ee54528] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:23:23,500 - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:23:23,500 - [92176884-e860-415f-a93a-bbec1f187902] Response status: 200 - Completed in 0.0081s
2025-05-31 12:23:23,504 - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:23:23,507 - [baf14adb-b8b4-4d77-8e1b-12dd85fcbc74] Response status: 200 - Completed in 0.0149s
2025-05-31 12:23:23,509 - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:23:23,512 - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:23:23,514 - [f2a9955e-dafa-4102-8d99-c8409ee54528] Response status: 200 - Completed in 0.0214s
2025-05-31 12:23:23,620 - [f88e24cf-e826-4496-af0a-4834851dc55f] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:23:23,624 - [f88e24cf-e826-4496-af0a-4834851dc55f] Response status: 200 - Completed in 0.0027s
2025-05-31 12:23:23,702 - [f0f7aa7b-d41c-47e0-9252-f425ccacec39] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:23:23,706 - [f0f7aa7b-d41c-47e0-9252-f425ccacec39] Response status: 200 - Completed in 0.0033s
2025-05-31 12:23:23,719 - [4421abd2-8060-4f66-93b8-769a19f81e34] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:23:23,722 - [414ea5e6-aeba-4a49-a450-f0158f1778e7] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:23:23,725 - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:23:23,729 - [4421abd2-8060-4f66-93b8-769a19f81e34] Response status: 200 - Completed in 0.0081s
2025-05-31 12:23:23,730 - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:23:23,734 - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:23:23,735 - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:23:23,738 - [414ea5e6-aeba-4a49-a450-f0158f1778e7] Response status: 200 - Completed in 0.0149s
2025-05-31 12:23:42,390 - [ac16dff8-2126-43e3-a34d-d16490396151] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:23:42,392 - HTTP exception: 401 - Not authenticated
2025-05-31 12:23:42,392 - [ac16dff8-2126-43e3-a34d-d16490396151] Response status: 401 - Completed in 0.0021s
2025-05-31 12:23:42,822 - [2f9fdc2c-0b68-4d5e-9d5e-e8c887b681ea] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:23:42,824 - [2f9fdc2c-0b68-4d5e-9d5e-e8c887b681ea] Request body for POST will be processed by endpoint.
2025-05-31 12:23:42,825 - HTTP exception: 401 - Not authenticated
2025-05-31 12:23:42,826 - [2f9fdc2c-0b68-4d5e-9d5e-e8c887b681ea] Response status: 401 - Completed in 0.0022s
2025-05-31 12:23:43,240 - [bf29abbe-dff2-4a36-8cf6-2f34f134a369] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:23:43,241 - [bf29abbe-dff2-4a36-8cf6-2f34f134a369] Request body for POST will be processed by endpoint.
2025-05-31 12:23:43,243 - HTTP exception: 401 - Not authenticated
2025-05-31 12:23:43,243 - [bf29abbe-dff2-4a36-8cf6-2f34f134a369] Response status: 401 - Completed in 0.0022s
2025-05-31 12:23:43,608 - [e79a1db9-555d-4ed0-96b4-1dd9fa4a0777] Request from 77.91.101.132:0 - POST /debug/auth/
2025-05-31 12:23:43,608 - [e79a1db9-555d-4ed0-96b4-1dd9fa4a0777] Request body for POST will be processed by endpoint.
2025-05-31 12:23:43,609 - 

********************************************************************************
2025-05-31 12:23:43,610 - === Starting Debug Auth POST ===
2025-05-31 12:23:43,610 - ********************************************************************************
2025-05-31 12:23:43,612 - Successfully read body for /debug/auth POST, length: 44
2025-05-31 12:23:43,613 - Creating/fetching test user for /debug/auth: telegram_id=12345, username=test_user
2025-05-31 12:23:43,614 - User 12345 found in database, using existing user
2025-05-31 12:23:43,615 - [e79a1db9-555d-4ed0-96b4-1dd9fa4a0777] Response status: 200 - Completed in 0.0070s
2025-05-31 12:27:28,977 - ================================================================================
2025-05-31 12:27:28,977 - Starting Time Banking API
2025-05-31 12:27:28,977 - ================================================================================
2025-05-31 12:27:28,977 - Bot token: 80221..._4-bU (length: 46)
2025-05-31 12:27:45,212 - [6bb1f8f9-7400-4b19-a3c0-5c5b36ced160] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:27:45,215 - HTTP exception: 401 - Not authenticated
2025-05-31 12:27:45,216 - [6bb1f8f9-7400-4b19-a3c0-5c5b36ced160] Response status: 401 - Completed in 0.0030s
2025-05-31 12:27:45,653 - [f69eb6fe-8bdf-4ede-9e17-eec7a7e774c6] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:27:45,653 - [f69eb6fe-8bdf-4ede-9e17-eec7a7e774c6] Request body for POST will be processed by endpoint.
2025-05-31 12:27:45,655 - HTTP exception: 401 - Not authenticated
2025-05-31 12:27:45,656 - [f69eb6fe-8bdf-4ede-9e17-eec7a7e774c6] Response status: 401 - Completed in 0.0022s
2025-05-31 12:27:46,009 - [b9060319-3740-4f4c-9968-afe73d72fda3] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:27:46,010 - [b9060319-3740-4f4c-9968-afe73d72fda3] Request body for POST will be processed by endpoint.
2025-05-31 12:27:46,012 - HTTP exception: 401 - Not authenticated
2025-05-31 12:27:46,013 - [b9060319-3740-4f4c-9968-afe73d72fda3] Response status: 401 - Completed in 0.0027s
2025-05-31 12:27:46,960 - [13d6c919-97bb-4ec6-aacf-8efa879c32fd] Request from 77.91.101.132:0 - POST /debug/auth/
2025-05-31 12:27:46,960 - [13d6c919-97bb-4ec6-aacf-8efa879c32fd] Request body for POST will be processed by endpoint.
2025-05-31 12:27:46,962 - 

********************************************************************************
2025-05-31 12:27:46,962 - === Starting Debug Auth POST ===
2025-05-31 12:27:46,962 - ********************************************************************************
2025-05-31 12:27:46,964 - Successfully read body for /debug/auth POST, length: 44
2025-05-31 12:27:46,966 - Creating/fetching test user for /debug/auth: telegram_id=12345, username=test_user
2025-05-31 12:27:46,968 - User 12345 found in database, using existing user
2025-05-31 12:27:46,978 - [13d6c919-97bb-4ec6-aacf-8efa879c32fd] Response status: 200 - Completed in 0.0169s
2025-05-31 12:27:49,672 - [464b7bb2-f997-4d84-ad18-3b99d8e7cb82] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:27:49,686 - [464b7bb2-f997-4d84-ad18-3b99d8e7cb82] Response status: 200 - Completed in 0.0138s
2025-05-31 12:28:30,052 - [07663bc9-16fd-4e1c-8c4b-9d9b44e80e33] Request from 77.91.101.132:0 - GET /listings/user/1/
2025-05-31 12:28:30,064 - [7d5118dd-8f43-49bc-ad92-2852f9f6c8cb] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:28:30,065 - [06596033-3347-46a6-833c-cac08069c971] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:28:30,067 - [00bc8a1f-39b1-45e2-b12a-011cb27f9ac6] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:28:30,067 - [07663bc9-16fd-4e1c-8c4b-9d9b44e80e33] Response status: 200 - Completed in 0.0136s
2025-05-31 12:28:30,078 - [GetTransactionPartners] Fetching transaction partners for user_id: 1
2025-05-31 12:28:30,088 - [06596033-3347-46a6-833c-cac08069c971] Response status: 200 - Completed in 0.0218s
2025-05-31 12:28:30,091 - [GetTransactionPartners] Found 0 completed listings involving user 1
2025-05-31 12:28:30,092 - [7d5118dd-8f43-49bc-ad92-2852f9f6c8cb] Response status: 200 - Completed in 0.0269s
2025-05-31 12:28:30,092 - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:28:30,096 - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:28:30,097 - [00bc8a1f-39b1-45e2-b12a-011cb27f9ac6] Response status: 200 - Completed in 0.0304s
2025-05-31 12:28:30,233 - [21bbd3f0-e768-4ac2-91d4-06ed35f6f4fa] Request from 77.91.101.132:0 - GET /listings/user/1/
2025-05-31 12:28:30,238 - [21bbd3f0-e768-4ac2-91d4-06ed35f6f4fa] Response status: 200 - Completed in 0.0038s
2025-05-31 12:28:30,295 - [8c2ce231-60a7-4759-a8f7-dce4d58d2677] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:28:30,300 - [8c2ce231-60a7-4759-a8f7-dce4d58d2677] Response status: 200 - Completed in 0.0042s
2025-05-31 12:28:30,384 - [d1a787d2-2ad5-49ab-9123-d9bd06c0db79] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:28:30,385 - [acaaa1d8-ddc4-43b0-82ca-5f635252fab4] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:28:30,388 - [GetTransactionPartners] Fetching transaction partners for user_id: 1
2025-05-31 12:28:30,391 - [d1a787d2-2ad5-49ab-9123-d9bd06c0db79] Response status: 200 - Completed in 0.0064s
2025-05-31 12:28:30,391 - [GetTransactionPartners] Found 0 completed listings involving user 1
2025-05-31 12:28:30,392 - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:28:30,395 - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:28:30,396 - [acaaa1d8-ddc4-43b0-82ca-5f635252fab4] Response status: 200 - Completed in 0.0103s
2025-05-31 12:29:55,986 - [f71e620a-1645-4a53-bfd3-887bac30f059] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:29:55,989 - [f71e620a-1645-4a53-bfd3-887bac30f059] Response status: 200 - Completed in 0.0021s
2025-05-31 12:29:56,172 - [ed289847-c0cd-4d00-b35f-f697a76a1b1c] Request from 77.91.101.132:0 - GET /user/me/
2025-05-31 12:29:56,175 - [ed289847-c0cd-4d00-b35f-f697a76a1b1c] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:29:56,184 - [ed289847-c0cd-4d00-b35f-f697a76a1b1c] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:29:56,185 - [ed289847-c0cd-4d00-b35f-f697a76a1b1c] Failed after 0.0016s
2025-05-31 12:29:56,186 - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:29:56,189 - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:29:56,670 - [543b72d2-3340-4935-9dd3-bb68f77aadf1] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:29:56,671 - [543b72d2-3340-4935-9dd3-bb68f77aadf1] Request body for POST will be processed by endpoint.
2025-05-31 12:29:56,673 - 

********************************************************************************
2025-05-31 12:29:56,674 - === Starting Telegram Authentication ===
2025-05-31 12:29:56,674 - ********************************************************************************
2025-05-31 12:29:56,686 - Successfully read entire body (POST), length: 580
2025-05-31 12:29:56,686 - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:29:56,692 - Verifying Telegram hash...
2025-05-31 12:29:56,702 - Hash verification successful
2025-05-31 12:29:56,702 - Parsing user data...
2025-05-31 12:29:56,705 - Looking up user with telegram_id: 887978091
2025-05-31 12:29:56,705 - Found existing user: sar_a_to_v (ID: 2, Telegram ID: 887978091)
2025-05-31 12:29:56,705 - Creating JWT tokens for user: sar_a_to_v
2025-05-31 12:29:56,710 - === Authentication Successful ===
2025-05-31 12:29:56,710 - ********************************************************************************


2025-05-31 12:29:56,710 - [543b72d2-3340-4935-9dd3-bb68f77aadf1] Response status: 200 - Completed in 0.0387s
2025-05-31 12:29:57,041 - [e22e444e-1435-4c8e-8495-e4e8612515c3] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:29:57,045 - [e22e444e-1435-4c8e-8495-e4e8612515c3] Response status: 200 - Completed in 0.0032s
2025-05-31 12:29:58,894 - [46110178-7298-4ec8-8894-16ad599b4230] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:29:58,899 - [46110178-7298-4ec8-8894-16ad599b4230] Response status: 200 - Completed in 0.0044s
2025-05-31 12:29:58,946 - [79550e80-9eb0-4a34-bc32-cce691d3a5f3] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:29:58,948 - [97e913d0-ff61-4ca4-aca9-ff8fb1fa3474] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:29:58,948 - [d91ff10d-49f3-4f06-82dc-02b1c9e55aab] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:29:58,950 - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:29:58,959 - [79550e80-9eb0-4a34-bc32-cce691d3a5f3] Response status: 200 - Completed in 0.0090s
2025-05-31 12:29:58,960 - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:29:58,962 - [d91ff10d-49f3-4f06-82dc-02b1c9e55aab] Response status: 200 - Completed in 0.0145s
2025-05-31 12:29:58,963 - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:29:58,967 - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:29:58,970 - [97e913d0-ff61-4ca4-aca9-ff8fb1fa3474] Response status: 200 - Completed in 0.0223s
2025-05-31 12:29:59,133 - [1bac9595-a9ea-47ef-bc39-470a74c44893] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:29:59,135 - [340e8426-5e62-4409-8390-e461648c4620] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:29:59,142 - [1bac9595-a9ea-47ef-bc39-470a74c44893] Response status: 200 - Completed in 0.0082s
2025-05-31 12:29:59,144 - [340e8426-5e62-4409-8390-e461648c4620] Response status: 200 - Completed in 0.0083s
2025-05-31 12:29:59,196 - [369aa461-b33b-43b5-bad0-c52e4df12160] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:29:59,198 - [cd95ac6d-02ff-4ce7-8ce5-d044b0759ff5] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:29:59,199 - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:29:59,203 - [369aa461-b33b-43b5-bad0-c52e4df12160] Response status: 200 - Completed in 0.0061s
2025-05-31 12:29:59,206 - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:29:59,210 - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:29:59,212 - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:29:59,214 - [cd95ac6d-02ff-4ce7-8ce5-d044b0759ff5] Response status: 200 - Completed in 0.0159s
2025-05-31 12:35:51,276 - [277113ce-287c-4160-a71e-abcb6ef7b43e] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:35:51,279 - [277113ce-287c-4160-a71e-abcb6ef7b43e] Response status: 200 - Completed in 0.0021s
2025-05-31 12:35:51,509 - [45d0874f-a444-430b-8acf-4ed3ccbd25b1] Request from 77.91.101.132:0 - GET /user/me/
2025-05-31 12:35:51,512 - [45d0874f-a444-430b-8acf-4ed3ccbd25b1] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:35:51,514 - [45d0874f-a444-430b-8acf-4ed3ccbd25b1] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:35:51,516 - [45d0874f-a444-430b-8acf-4ed3ccbd25b1] Failed after 0.0021s
2025-05-31 12:35:51,516 - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:35:51,516 - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:35:52,037 - [aee2292c-ec4c-4cf7-855b-766917e50918] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:35:52,038 - [aee2292c-ec4c-4cf7-855b-766917e50918] Request body for POST will be processed by endpoint.
2025-05-31 12:35:52,040 - 

********************************************************************************
2025-05-31 12:35:52,041 - === Starting Telegram Authentication ===
2025-05-31 12:35:52,041 - ********************************************************************************
2025-05-31 12:35:52,052 - Successfully read entire body (POST), length: 580
2025-05-31 12:35:52,052 - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:35:52,057 - Verifying Telegram hash...
2025-05-31 12:35:52,069 - Hash verification successful
2025-05-31 12:35:52,070 - Parsing user data...
2025-05-31 12:35:52,072 - Looking up user with telegram_id: 887978091
2025-05-31 12:35:52,074 - Found existing user: sar_a_to_v (ID: 2, Telegram ID: 887978091)
2025-05-31 12:35:52,074 - Creating JWT tokens for user: sar_a_to_v
2025-05-31 12:35:52,074 - === Authentication Successful ===
2025-05-31 12:35:52,077 - ********************************************************************************


2025-05-31 12:35:52,079 - [aee2292c-ec4c-4cf7-855b-766917e50918] Response status: 200 - Completed in 0.0386s
2025-05-31 12:35:52,739 - [c0fdb19e-ee12-4807-a1c0-5f206896322b] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:35:52,744 - [c0fdb19e-ee12-4807-a1c0-5f206896322b] Response status: 200 - Completed in 0.0049s
2025-05-31 12:35:53,866 - [bb473551-7a2b-4edf-b60c-199717d143ba] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:35:53,870 - [bb473551-7a2b-4edf-b60c-199717d143ba] Response status: 200 - Completed in 0.0027s
2025-05-31 12:35:53,979 - [c94d01d6-858d-4a6a-aead-34b48afcba7b] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:35:53,981 - [396b889a-444d-41b2-baba-6f13f0120875] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:35:53,981 - [ab2838ca-bc24-4454-bc28-f8f07e71a648] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:35:53,985 - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:35:53,988 - [ab2838ca-bc24-4454-bc28-f8f07e71a648] Response status: 200 - Completed in 0.0076s
2025-05-31 12:35:53,988 - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:35:53,996 - [c94d01d6-858d-4a6a-aead-34b48afcba7b] Response status: 200 - Completed in 0.0163s
2025-05-31 12:35:53,999 - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:35:54,004 - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:35:54,006 - [396b889a-444d-41b2-baba-6f13f0120875] Response status: 200 - Completed in 0.0253s
2025-05-31 12:35:54,037 - [c9f22b88-0229-4273-b756-4e02fc758653] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:35:54,042 - [c9f22b88-0229-4273-b756-4e02fc758653] Response status: 200 - Completed in 0.0044s
2025-05-31 12:35:54,163 - [ac06de22-85ea-4a29-8c1f-90e59de207cc] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:35:54,170 - [ac06de22-85ea-4a29-8c1f-90e59de207cc] Response status: 200 - Completed in 0.0053s
2025-05-31 12:35:54,221 - [22eaed82-65f9-4602-8d90-f7ab1b6e15bb] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:35:54,224 - [e4fd424a-99d6-4559-8767-dc6cc90c048d] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:35:54,226 - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:35:54,226 - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:35:54,234 - [22eaed82-65f9-4602-8d90-f7ab1b6e15bb] Response status: 200 - Completed in 0.0104s
2025-05-31 12:35:54,234 - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:35:54,239 - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:35:54,241 - [e4fd424a-99d6-4559-8767-dc6cc90c048d] Response status: 200 - Completed in 0.0162s
2025-05-31 12:44:12,255 - [72e98829-cd43-4658-a689-94d687af866a] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:44:12,258 - [72e98829-cd43-4658-a689-94d687af866a] Response status: 200 - Completed in 0.0016s
2025-05-31 12:44:13,895 - ================================================================================
2025-05-31 12:44:13,896 - Starting Time Banking API
2025-05-31 12:44:13,896 - ================================================================================
2025-05-31 12:44:13,897 - Bot token: 80221..._4-bU (length: 46)
2025-05-31 12:44:13,937 - [4376fc07-2985-47d8-99a5-e2e373a4005d] Request from 77.91.101.132:0 - GET /user/me/
2025-05-31 12:44:13,947 - [GetUserMe] User sar_a_to_v (ID: 2) found. Avatar path from DB to be returned: 'https://t.me/i/userpic/320/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg'
2025-05-31 12:44:13,948 - [4376fc07-2985-47d8-99a5-e2e373a4005d] Response status: 200 - Completed in 0.0091s
2025-05-31 12:44:14,606 - [53c0ffa1-5a69-43c4-b760-ce63bbd16910] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:44:14,615 - [53c0ffa1-5a69-43c4-b760-ce63bbd16910] Response status: 200 - Completed in 0.0075s
2025-05-31 12:44:15,810 - [58812260-4fa7-40a0-afd1-2ca49abf750e] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:44:15,818 - [58812260-4fa7-40a0-afd1-2ca49abf750e] Response status: 200 - Completed in 0.0080s
2025-05-31 12:44:15,933 - [551944bf-26d2-40c1-b2fc-ff13941316e8] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:44:15,936 - [c43a9056-6fbc-4f60-a4bb-038ca79eaf35] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:44:15,937 - [4f658dbe-753a-4615-b81e-a8951c5c2f88] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:44:15,947 - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:44:15,955 - [551944bf-26d2-40c1-b2fc-ff13941316e8] Response status: 200 - Completed in 0.0212s
2025-05-31 12:44:15,959 - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:44:15,961 - [4f658dbe-753a-4615-b81e-a8951c5c2f88] Response status: 200 - Completed in 0.0234s
2025-05-31 12:44:15,962 - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:44:15,967 - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:44:15,969 - [c43a9056-6fbc-4f60-a4bb-038ca79eaf35] Response status: 200 - Completed in 0.0322s
2025-05-31 12:44:16,034 - [e0ab6e82-b71c-424b-8c72-600ecd6abda0] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:44:16,039 - [e0ab6e82-b71c-424b-8c72-600ecd6abda0] Response status: 200 - Completed in 0.0039s
2025-05-31 12:44:16,176 - [22284943-24f6-468f-ad88-3980345fc5b5] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:44:16,177 - [12738295-301a-405f-b749-18efc151e6bd] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:44:16,178 - [1621ff89-5d26-4c27-98b2-8df366bf8f04] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:44:16,182 - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:44:16,187 - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:44:16,187 - [1621ff89-5d26-4c27-98b2-8df366bf8f04] Response status: 200 - Completed in 0.0084s
2025-05-31 12:44:16,191 - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:44:16,191 - [22284943-24f6-468f-ad88-3980345fc5b5] Response status: 200 - Completed in 0.0144s
2025-05-31 12:44:16,192 - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:44:16,197 - [12738295-301a-405f-b749-18efc151e6bd] Response status: 200 - Completed in 0.0188s
2025-05-31 12:44:20,487 - [cdac9a34-3544-4d40-947b-ad360439e6c4] Request from 77.91.101.132:0 - POST /profile/2/avatar/
2025-05-31 12:44:20,488 - [cdac9a34-3544-4d40-947b-ad360439e6c4] Request body for POST will be processed by endpoint.
2025-05-31 12:44:20,505 - [cdac9a34-3544-4d40-947b-ad360439e6c4] Response status: 200 - Completed in 0.0166s
2025-05-31 12:44:20,732 - [4febc741-1d60-418f-a9a5-07ab98023b47] Request from 77.91.101.132:0 - GET /static/avatars/user_2_avatar_1748684660.jpg
2025-05-31 12:44:20,782 - [4febc741-1d60-418f-a9a5-07ab98023b47] Response status: 200 - Completed in 0.0485s
2025-05-31 12:45:09,613 - [88c5c756-60e6-4505-89ab-53da39d0366d] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:45:09,617 - HTTP exception: 401 - Not authenticated
2025-05-31 12:45:09,618 - [88c5c756-60e6-4505-89ab-53da39d0366d] Response status: 401 - Completed in 0.0032s
2025-05-31 12:45:10,066 - [0236a331-9e85-4c86-936a-2435dad16016] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:45:10,067 - [0236a331-9e85-4c86-936a-2435dad16016] Request body for POST will be processed by endpoint.
2025-05-31 12:45:10,069 - HTTP exception: 401 - Not authenticated
2025-05-31 12:45:10,069 - [0236a331-9e85-4c86-936a-2435dad16016] Response status: 401 - Completed in 0.0017s
2025-05-31 12:45:10,551 - [36c140b3-0be2-4e4a-8402-07034d62aa92] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:45:10,552 - [36c140b3-0be2-4e4a-8402-07034d62aa92] Request body for POST will be processed by endpoint.
2025-05-31 12:45:10,554 - HTTP exception: 401 - Not authenticated
2025-05-31 12:45:10,555 - [36c140b3-0be2-4e4a-8402-07034d62aa92] Response status: 401 - Completed in 0.0026s
2025-05-31 12:45:11,530 - [4dbe7442-057a-4848-917f-bab04e923d20] Request from 77.91.101.132:0 - POST /debug/auth/
2025-05-31 12:45:11,531 - [4dbe7442-057a-4848-917f-bab04e923d20] Request body for POST will be processed by endpoint.
2025-05-31 12:45:11,532 - 

********************************************************************************
2025-05-31 12:45:11,533 - === Starting Debug Auth POST ===
2025-05-31 12:45:11,534 - ********************************************************************************
2025-05-31 12:45:11,535 - Successfully read body for /debug/auth POST, length: 44
2025-05-31 12:45:11,537 - Creating/fetching test user for /debug/auth: telegram_id=12345, username=test_user
2025-05-31 12:45:11,538 - User 12345 found in database, using existing user
2025-05-31 12:45:11,541 - [4dbe7442-057a-4848-917f-bab04e923d20] Response status: 200 - Completed in 0.0093s
2025-05-31 12:45:16,106 - [3021ffcd-a2bd-4128-abc1-b70dd6813690] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:45:16,109 - [3021ffcd-a2bd-4128-abc1-b70dd6813690] Response status: 200 - Completed in 0.0026s
2025-05-31 12:48:48,221 - ================================================================================
2025-05-31 12:48:48,222 - Starting Time Banking API
2025-05-31 12:48:48,223 - ================================================================================
2025-05-31 12:48:48,223 - Bot token: 80221..._4-bU (length: 46)
2025-05-31 12:49:06,497 - [ac04a991-ed72-45ab-91fc-4b0467adf009] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:49:06,500 - HTTP exception: 401 - Not authenticated
2025-05-31 12:49:06,501 - [ac04a991-ed72-45ab-91fc-4b0467adf009] Response status: 401 - Completed in 0.0030s
2025-05-31 12:49:07,314 - [76f7912b-1e0f-4b31-b0bd-d967b9e5bf64] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:49:07,315 - [76f7912b-1e0f-4b31-b0bd-d967b9e5bf64] Request body for POST will be processed by endpoint.
2025-05-31 12:49:07,316 - 

********************************************************************************
2025-05-31 12:49:07,317 - === Starting Telegram Authentication ===
2025-05-31 12:49:07,317 - ********************************************************************************
2025-05-31 12:49:07,326 - Successfully read entire body (POST), length: 604
2025-05-31 12:49:07,328 - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:49:07,332 - Verifying Telegram hash...
2025-05-31 12:49:07,343 - Hash verification successful
2025-05-31 12:49:07,343 - Parsing user data...
2025-05-31 12:49:07,346 - Looking up user with telegram_id: 7127128314
2025-05-31 12:49:07,347 - Creating new user with telegram_id: 7127128314
2025-05-31 12:49:07,359 - New user created: hendrix611 (ID: 4, Telegram ID: 7127128314)
2025-05-31 12:49:07,360 - Creating JWT tokens for user: hendrix611
2025-05-31 12:49:07,368 - === Authentication Successful ===
2025-05-31 12:49:07,368 - ********************************************************************************


2025-05-31 12:49:07,369 - [76f7912b-1e0f-4b31-b0bd-d967b9e5bf64] Response status: 200 - Completed in 0.0531s
2025-05-31 12:49:07,932 - [131498c7-911f-4609-960a-ac2373eff5ec] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:49:07,942 - [131498c7-911f-4609-960a-ac2373eff5ec] Response status: 200 - Completed in 0.0096s
2025-05-31 12:49:10,010 - [f38bac18-630a-455d-80d9-a830b94ccb5b] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:49:10,013 - [GetTransactionPartners] Fetching transaction partners for user_id: 4
2025-05-31 12:49:10,016 - [GetTransactionPartners] Found 0 completed listings involving user 4
2025-05-31 12:49:10,017 - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:49:10,017 - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:49:10,019 - [f38bac18-630a-455d-80d9-a830b94ccb5b] Response status: 200 - Completed in 0.0079s
2025-05-31 12:49:10,028 - [bf5da8a5-8fa6-43c5-b015-3ad74356d621] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:49:10,031 - [61bd9d9c-c5e3-481c-a770-52aeebe39838] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:49:10,041 - [bf5da8a5-8fa6-43c5-b015-3ad74356d621] Response status: 200 - Completed in 0.0117s
2025-05-31 12:49:10,049 - [61bd9d9c-c5e3-481c-a770-52aeebe39838] Response status: 200 - Completed in 0.0168s
2025-05-31 12:49:10,066 - [a0a5f349-dc2b-42f6-b6f3-0e66d3d988c0] Request from 77.91.101.132:0 - GET /listings/user/4/
2025-05-31 12:49:10,075 - [a0a5f349-dc2b-42f6-b6f3-0e66d3d988c0] Response status: 200 - Completed in 0.0080s
2025-05-31 12:49:10,215 - [1b8c8110-694b-4608-8006-7a244e5708e4] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:49:10,217 - [GetTransactionPartners] Fetching transaction partners for user_id: 4
2025-05-31 12:49:10,219 - [GetTransactionPartners] Found 0 completed listings involving user 4
2025-05-31 12:49:10,219 - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:49:10,220 - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:49:10,221 - [1b8c8110-694b-4608-8006-7a244e5708e4] Response status: 200 - Completed in 0.0055s
2025-05-31 12:49:10,253 - [37d62eef-906f-4b5b-b340-b757b92e1ad1] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:49:10,255 - [a629c790-ebc3-4f15-bf6b-3bbfdac87606] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:49:10,261 - [37d62eef-906f-4b5b-b340-b757b92e1ad1] Response status: 200 - Completed in 0.0069s
2025-05-31 12:49:10,262 - [a629c790-ebc3-4f15-bf6b-3bbfdac87606] Response status: 200 - Completed in 0.0068s
2025-05-31 12:49:10,270 - [3d8ab861-9b90-49c9-a3fa-c2425cb83fcf] Request from 77.91.101.132:0 - GET /listings/user/4/
2025-05-31 12:49:10,275 - [3d8ab861-9b90-49c9-a3fa-c2425cb83fcf] Response status: 200 - Completed in 0.0033s
2025-05-31 12:49:17,883 - [e0df9447-8d82-40f3-a52a-3f3119e2ecf0] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:49:17,886 - [88f7396c-4fec-4d34-8ebe-4fbc6401dfa5] Request from 77.91.101.132:0 - GET /listings/user/4/
2025-05-31 12:49:17,892 - [c37b36b7-ade2-4940-a52a-f7769feb78ee] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:49:17,893 - [a4886b93-ffe5-46da-984e-43c64b832d33] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:49:17,894 - [e0df9447-8d82-40f3-a52a-3f3119e2ecf0] Response status: 200 - Completed in 0.0098s
2025-05-31 12:49:17,895 - [88f7396c-4fec-4d34-8ebe-4fbc6401dfa5] Response status: 200 - Completed in 0.0087s
2025-05-31 12:49:17,900 - [GetTransactionPartners] Fetching transaction partners for user_id: 4
2025-05-31 12:49:17,903 - [GetTransactionPartners] Found 0 completed listings involving user 4
2025-05-31 12:49:17,903 - [c37b36b7-ade2-4940-a52a-f7769feb78ee] Response status: 200 - Completed in 0.0103s
2025-05-31 12:49:17,904 - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:49:17,905 - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:49:17,907 - [a4886b93-ffe5-46da-984e-43c64b832d33] Response status: 200 - Completed in 0.0141s
2025-05-31 12:49:18,057 - [7963c9ad-6fa6-4025-a335-ac14392923b9] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:49:18,061 - [7963c9ad-6fa6-4025-a335-ac14392923b9] Response status: 200 - Completed in 0.0033s
2025-05-31 12:49:18,066 - [fc772269-f2d4-4588-9503-e3ba76140a67] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:49:18,068 - [067a989e-a49c-4868-9ddf-aaf1dce2bd6d] Request from 77.91.101.132:0 - GET /listings/user/4/
2025-05-31 12:49:18,074 - [fc772269-f2d4-4588-9503-e3ba76140a67] Response status: 200 - Completed in 0.0072s
2025-05-31 12:49:18,074 - [067a989e-a49c-4868-9ddf-aaf1dce2bd6d] Response status: 200 - Completed in 0.0061s
2025-05-31 12:49:18,155 - [b0d2eda3-1758-48dd-a81c-5a5f3ff03f49] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:49:18,157 - [GetTransactionPartners] Fetching transaction partners for user_id: 4
2025-05-31 12:49:18,159 - [GetTransactionPartners] Found 0 completed listings involving user 4
2025-05-31 12:49:18,159 - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:49:18,159 - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:49:18,160 - [b0d2eda3-1758-48dd-a81c-5a5f3ff03f49] Response status: 200 - Completed in 0.0049s
2025-05-31 12:49:27,229 - [24c930a9-72e3-4194-b8c9-38b1ed2f3771] Request from 77.91.101.132:0 - GET /users/search/
2025-05-31 12:49:27,230 - [24c930a9-72e3-4194-b8c9-38b1ed2f3771] Query params: {'username': '@sar_a_to_v'}
2025-05-31 12:49:27,235 - [24c930a9-72e3-4194-b8c9-38b1ed2f3771] Response status: 200 - Completed in 0.0043s
2025-05-31 12:49:28,414 - [630e0172-a41f-4485-b000-2fde0f11248a] Request from 77.91.101.132:0 - GET /users/search/
2025-05-31 12:49:28,415 - [630e0172-a41f-4485-b000-2fde0f11248a] Query params: {'username': '@sar_a_to_v'}
2025-05-31 12:49:28,419 - [630e0172-a41f-4485-b000-2fde0f11248a] Response status: 200 - Completed in 0.0022s
2025-05-31 12:49:28,721 - [8890b8ce-b45a-457b-b09f-099522a8f1c3] Request from 77.91.101.132:0 - GET /users/search/
2025-05-31 12:49:28,722 - [8890b8ce-b45a-457b-b09f-099522a8f1c3] Query params: {'username': '@sar_a_to_v'}
2025-05-31 12:49:28,725 - [8890b8ce-b45a-457b-b09f-099522a8f1c3] Response status: 200 - Completed in 0.0027s
