2025-05-30 23:58:31,136 - backend.auth - INFO - ================================================================================
2025-05-30 23:58:31,136 - backend.auth - INFO - Authentication module initialized
2025-05-30 23:58:31,136 - backend.auth - INFO - BOT_TOKEN: 80221..._4-bU (length: 46)
2025-05-30 23:58:31,136 - backend.auth - INFO - ================================================================================
2025-05-30 23:59:30,252 - backend.auth - DEBUG - 
==================================================
2025-05-30 23:59:30,252 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-30 23:59:30,253 - backend.auth - DEBUG - ==================================================
2025-05-30 23:59:30,253 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-30 23:59:30,254 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-30 23:59:30,254 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TRZXJyR&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748638760&signature=04HF3L9BTSwwWIIUHOPr1DXhtuFONu4qadaDW0WxeqZwILtX0coGmnIOWbqJOW30mOeP-Wl1pEFIky94G-XdDQ&hash=a54f6d3da406dc45eae9a386bdf84c547b5d0abe6a5f6b3e4500e85edb10253f'
2025-05-30 23:59:30,255 - backend.auth - DEBUG - received_hash: a54f6d3da406dc45eae9a386bdf84c547b5d0abe6a5f6b3e4500e85edb10253f
2025-05-30 23:59:30,255 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TRZXJyR', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748638760', 'signature': '04HF3L9BTSwwWIIUHOPr1DXhtuFONu4qadaDW0WxeqZwILtX0coGmnIOWbqJOW30mOeP-Wl1pEFIky94G-XdDQ'}
2025-05-30 23:59:30,256 - backend.auth - DEBUG - Hash from dictionary: a54f6d3da406dc45eae9a386bdf84c547b5d0abe6a5f6b3e4500e85edb10253f
2025-05-30 23:59:30,258 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748638760
query_id=AAFreO00AAAAAGt47TRZXJyR
signature=04HF3L9BTSwwWIIUHOPr1DXhtuFONu4qadaDW0WxeqZwILtX0coGmnIOWbqJOW30mOeP-Wl1pEFIky94G-XdDQ
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-30 23:59:30,259 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-30 23:59:30,260 - backend.auth - DEBUG - Calculated hash: a54f6d3da406dc45eae9a386bdf84c547b5d0abe6a5f6b3e4500e85edb10253f
2025-05-30 23:59:30,260 - backend.auth - DEBUG - Hash verification result: True
2025-05-30 23:59:30,261 - backend.auth - DEBUG - ==================================================

2025-05-30 23:59:30,274 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 20:59:30.268063)
2025-05-30 23:59:30,275 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 20:59:30.275391)
2025-05-31 00:03:01,886 - backend.auth - DEBUG - 
==================================================
2025-05-31 00:03:01,886 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 00:03:01,886 - backend.auth - DEBUG - ==================================================
2025-05-31 00:03:01,886 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 00:03:01,891 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 00:03:01,891 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TS-bRLe&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748638972&signature=YnPFvu1WkxEC2HwdlK37OroXbxgHGWfqqke6lj2cxiF0lb4QFKAElIv3TzROXt0HPJdcrWfIlnBkK4wJzpzDAw&hash=40f6f2c57b13cd2dc21cb66f8d29511b1ade809fd3128b20e7e1a8ece4da41a7'
2025-05-31 00:03:01,891 - backend.auth - DEBUG - received_hash: 40f6f2c57b13cd2dc21cb66f8d29511b1ade809fd3128b20e7e1a8ece4da41a7
2025-05-31 00:03:01,891 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TS-bRLe', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748638972', 'signature': 'YnPFvu1WkxEC2HwdlK37OroXbxgHGWfqqke6lj2cxiF0lb4QFKAElIv3TzROXt0HPJdcrWfIlnBkK4wJzpzDAw'}
2025-05-31 00:03:01,891 - backend.auth - DEBUG - Hash from dictionary: 40f6f2c57b13cd2dc21cb66f8d29511b1ade809fd3128b20e7e1a8ece4da41a7
2025-05-31 00:03:01,891 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748638972
query_id=AAFreO00AAAAAGt47TS-bRLe
signature=YnPFvu1WkxEC2HwdlK37OroXbxgHGWfqqke6lj2cxiF0lb4QFKAElIv3TzROXt0HPJdcrWfIlnBkK4wJzpzDAw
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 00:03:01,891 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 00:03:01,897 - backend.auth - DEBUG - Calculated hash: 40f6f2c57b13cd2dc21cb66f8d29511b1ade809fd3128b20e7e1a8ece4da41a7
2025-05-31 00:03:01,897 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 00:03:01,897 - backend.auth - DEBUG - ==================================================

2025-05-31 00:03:01,918 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 21:03:01.918330)
2025-05-31 00:03:01,919 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 21:03:01.919416)
2025-05-31 00:03:51,135 - backend.auth - DEBUG - 
==================================================
2025-05-31 00:03:51,137 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 00:03:51,137 - backend.auth - DEBUG - ==================================================
2025-05-31 00:03:51,137 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 00:03:51,139 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 00:03:51,139 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TQzZJJX&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748639024&signature=vGtPub8XfSEmJXw8dqBSaD3ID4dLA5gvSSXtAWBPR3z8-ElDsmFqPtJjYAeS5SWUE-i2U_Zb3FGz1804k-gHAA&hash=c66082ce7606ecae2e423fed3f799673fe78342aca4d6a68f0dd76b017607c53'
2025-05-31 00:03:51,141 - backend.auth - DEBUG - received_hash: c66082ce7606ecae2e423fed3f799673fe78342aca4d6a68f0dd76b017607c53
2025-05-31 00:03:51,141 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TQzZJJX', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748639024', 'signature': 'vGtPub8XfSEmJXw8dqBSaD3ID4dLA5gvSSXtAWBPR3z8-ElDsmFqPtJjYAeS5SWUE-i2U_Zb3FGz1804k-gHAA'}
2025-05-31 00:03:51,141 - backend.auth - DEBUG - Hash from dictionary: c66082ce7606ecae2e423fed3f799673fe78342aca4d6a68f0dd76b017607c53
2025-05-31 00:03:51,144 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748639024
query_id=AAFreO00AAAAAGt47TQzZJJX
signature=vGtPub8XfSEmJXw8dqBSaD3ID4dLA5gvSSXtAWBPR3z8-ElDsmFqPtJjYAeS5SWUE-i2U_Zb3FGz1804k-gHAA
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 00:03:51,144 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 00:03:51,145 - backend.auth - DEBUG - Calculated hash: c66082ce7606ecae2e423fed3f799673fe78342aca4d6a68f0dd76b017607c53
2025-05-31 00:03:51,145 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 00:03:51,146 - backend.auth - DEBUG - ==================================================

2025-05-31 00:03:51,161 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 21:03:51.161703)
2025-05-31 00:03:51,161 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 21:03:51.161703)
2025-05-31 00:10:51,641 - backend.auth - DEBUG - 
==================================================
2025-05-31 00:10:51,641 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 00:10:51,643 - backend.auth - DEBUG - ==================================================
2025-05-31 00:10:51,643 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 00:10:51,643 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 00:10:51,644 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TSq3Lg9&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748639438&signature=ozcpmjj-PYRzUGsqqBQoXRI5bLqoP13C0o6ZiracBzvKmmZMHd2bk_--Z2iadjJQixuJNdiY_GRDvfY9mbWqAw&hash=80f86d249dab5765e9bbb150b0f23b0588cbd308ba348e677656ccd5c739501a'
2025-05-31 00:10:51,645 - backend.auth - DEBUG - received_hash: 80f86d249dab5765e9bbb150b0f23b0588cbd308ba348e677656ccd5c739501a
2025-05-31 00:10:51,645 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TSq3Lg9', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748639438', 'signature': 'ozcpmjj-PYRzUGsqqBQoXRI5bLqoP13C0o6ZiracBzvKmmZMHd2bk_--Z2iadjJQixuJNdiY_GRDvfY9mbWqAw'}
2025-05-31 00:10:51,646 - backend.auth - DEBUG - Hash from dictionary: 80f86d249dab5765e9bbb150b0f23b0588cbd308ba348e677656ccd5c739501a
2025-05-31 00:10:51,646 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748639438
query_id=AAFreO00AAAAAGt47TSq3Lg9
signature=ozcpmjj-PYRzUGsqqBQoXRI5bLqoP13C0o6ZiracBzvKmmZMHd2bk_--Z2iadjJQixuJNdiY_GRDvfY9mbWqAw
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 00:10:51,647 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 00:10:51,647 - backend.auth - DEBUG - Calculated hash: 80f86d249dab5765e9bbb150b0f23b0588cbd308ba348e677656ccd5c739501a
2025-05-31 00:10:51,648 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 00:10:51,648 - backend.auth - DEBUG - ==================================================

2025-05-31 00:10:51,664 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 21:10:51.663553)
2025-05-31 00:10:51,664 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 21:10:51.664614)
2025-05-31 00:11:12,068 - backend.auth - DEBUG - 
==================================================
2025-05-31 00:11:12,068 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 00:11:12,069 - backend.auth - DEBUG - ==================================================
2025-05-31 00:11:12,070 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 00:11:12,070 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 00:11:12,071 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TRJv4o9&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748639465&signature=2sGs5hw33520Ey6PjTVLlB8tktUlWjzrQvv2Amjjk8zO3iIrR3JzvfTQvrH0hg3TogMwghRDZ9455rClzjfVCg&hash=802aca75e72059200b3b21be4439cdb19acdbc8413d3fde82fa168cee6ef0b5a'
2025-05-31 00:11:12,071 - backend.auth - DEBUG - received_hash: 802aca75e72059200b3b21be4439cdb19acdbc8413d3fde82fa168cee6ef0b5a
2025-05-31 00:11:12,072 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TRJv4o9', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748639465', 'signature': '2sGs5hw33520Ey6PjTVLlB8tktUlWjzrQvv2Amjjk8zO3iIrR3JzvfTQvrH0hg3TogMwghRDZ9455rClzjfVCg'}
2025-05-31 00:11:12,072 - backend.auth - DEBUG - Hash from dictionary: 802aca75e72059200b3b21be4439cdb19acdbc8413d3fde82fa168cee6ef0b5a
2025-05-31 00:11:12,073 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748639465
query_id=AAFreO00AAAAAGt47TRJv4o9
signature=2sGs5hw33520Ey6PjTVLlB8tktUlWjzrQvv2Amjjk8zO3iIrR3JzvfTQvrH0hg3TogMwghRDZ9455rClzjfVCg
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 00:11:12,074 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 00:11:12,074 - backend.auth - DEBUG - Calculated hash: 802aca75e72059200b3b21be4439cdb19acdbc8413d3fde82fa168cee6ef0b5a
2025-05-31 00:11:12,075 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 00:11:12,075 - backend.auth - DEBUG - ==================================================

2025-05-31 00:11:12,091 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 21:11:12.091026)
2025-05-31 00:11:12,091 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 21:11:12.091026)
2025-05-31 00:13:54,379 - backend.auth - DEBUG - 
==================================================
2025-05-31 00:13:54,380 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 00:13:54,380 - backend.auth - DEBUG - ==================================================
2025-05-31 00:13:54,381 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 00:13:54,381 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 00:13:54,382 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TRI5niB&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748639616&signature=KCvhm_Emqq3ybb82CviPVEsazdGxtZ1La7o6PH1628-3jRD9WxTeKNxflI6VrZ0kRL684A_kI8SIpDC7dSUrAQ&hash=70ecf1ecad3b8ef2e8803bf4eebf8d5c80b37f7dd14dcd8794aadc69898bfbee'
2025-05-31 00:13:54,382 - backend.auth - DEBUG - received_hash: 70ecf1ecad3b8ef2e8803bf4eebf8d5c80b37f7dd14dcd8794aadc69898bfbee
2025-05-31 00:13:54,382 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TRI5niB', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748639616', 'signature': 'KCvhm_Emqq3ybb82CviPVEsazdGxtZ1La7o6PH1628-3jRD9WxTeKNxflI6VrZ0kRL684A_kI8SIpDC7dSUrAQ'}
2025-05-31 00:13:54,383 - backend.auth - DEBUG - Hash from dictionary: 70ecf1ecad3b8ef2e8803bf4eebf8d5c80b37f7dd14dcd8794aadc69898bfbee
2025-05-31 00:13:54,384 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748639616
query_id=AAFreO00AAAAAGt47TRI5niB
signature=KCvhm_Emqq3ybb82CviPVEsazdGxtZ1La7o6PH1628-3jRD9WxTeKNxflI6VrZ0kRL684A_kI8SIpDC7dSUrAQ
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 00:13:54,384 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 00:13:54,385 - backend.auth - DEBUG - Calculated hash: 70ecf1ecad3b8ef2e8803bf4eebf8d5c80b37f7dd14dcd8794aadc69898bfbee
2025-05-31 00:13:54,386 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 00:13:54,387 - backend.auth - DEBUG - ==================================================

2025-05-31 00:13:54,394 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 21:13:54.394154)
2025-05-31 00:13:54,395 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 21:13:54.395219)
2025-05-31 00:13:56,343 - backend.auth - INFO - ================================================================================
2025-05-31 00:13:56,344 - backend.auth - INFO - Authentication module initialized
2025-05-31 00:13:56,344 - backend.auth - INFO - BOT_TOKEN: 80221..._4-bU (length: 46)
2025-05-31 00:13:56,344 - backend.auth - INFO - ================================================================================
2025-05-31 00:14:45,102 - backend.auth - DEBUG - 
==================================================
2025-05-31 00:14:45,102 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 00:14:45,103 - backend.auth - DEBUG - ==================================================
2025-05-31 00:14:45,104 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 00:14:45,104 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 00:14:45,105 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TRv9M-9&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748639680&signature=rSnzVBn_Kdk2_wzRbETW8u3NDr4SOe3s9oN15g7qiMRt3E_sWKQ7xKD71LIzBqp_k5reIUCbkCr47qGFw6MmCw&hash=1c69ef5490d4f9940d13ce218fad12f95cb3a08bf1932dffc5fbae9a3abeb41d'
2025-05-31 00:14:45,107 - backend.auth - DEBUG - received_hash: 1c69ef5490d4f9940d13ce218fad12f95cb3a08bf1932dffc5fbae9a3abeb41d
2025-05-31 00:14:45,108 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TRv9M-9', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748639680', 'signature': 'rSnzVBn_Kdk2_wzRbETW8u3NDr4SOe3s9oN15g7qiMRt3E_sWKQ7xKD71LIzBqp_k5reIUCbkCr47qGFw6MmCw'}
2025-05-31 00:14:45,109 - backend.auth - DEBUG - Hash from dictionary: 1c69ef5490d4f9940d13ce218fad12f95cb3a08bf1932dffc5fbae9a3abeb41d
2025-05-31 00:14:45,110 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748639680
query_id=AAFreO00AAAAAGt47TRv9M-9
signature=rSnzVBn_Kdk2_wzRbETW8u3NDr4SOe3s9oN15g7qiMRt3E_sWKQ7xKD71LIzBqp_k5reIUCbkCr47qGFw6MmCw
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 00:14:45,110 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 00:14:45,111 - backend.auth - DEBUG - Calculated hash: 1c69ef5490d4f9940d13ce218fad12f95cb3a08bf1932dffc5fbae9a3abeb41d
2025-05-31 00:14:45,112 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 00:14:45,113 - backend.auth - DEBUG - ==================================================

2025-05-31 00:14:45,128 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 21:14:45.127555)
2025-05-31 00:14:45,128 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 21:14:45.128553)
2025-05-31 00:16:40,387 - backend.auth - DEBUG - 
==================================================
2025-05-31 00:16:40,387 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 00:16:40,388 - backend.auth - DEBUG - ==================================================
2025-05-31 00:16:40,388 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 00:16:40,389 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 00:16:40,389 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TTKNuR6&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748639793&signature=bjTN1zz369fAFJerwU5WfsqrensnxnYzqOCBaFK0glvik3GyX-rwuBSUKq43rrIRFzeXvZ8LXKcSwdhrWrnjDg&hash=0f106b8a5ab7e5effbaa0b2a5c12c928d9b12c423dad58ca36e2058117702c20'
2025-05-31 00:16:40,390 - backend.auth - DEBUG - received_hash: 0f106b8a5ab7e5effbaa0b2a5c12c928d9b12c423dad58ca36e2058117702c20
2025-05-31 00:16:40,390 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TTKNuR6', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748639793', 'signature': 'bjTN1zz369fAFJerwU5WfsqrensnxnYzqOCBaFK0glvik3GyX-rwuBSUKq43rrIRFzeXvZ8LXKcSwdhrWrnjDg'}
2025-05-31 00:16:40,392 - backend.auth - DEBUG - Hash from dictionary: 0f106b8a5ab7e5effbaa0b2a5c12c928d9b12c423dad58ca36e2058117702c20
2025-05-31 00:16:40,393 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748639793
query_id=AAFreO00AAAAAGt47TTKNuR6
signature=bjTN1zz369fAFJerwU5WfsqrensnxnYzqOCBaFK0glvik3GyX-rwuBSUKq43rrIRFzeXvZ8LXKcSwdhrWrnjDg
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 00:16:40,393 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 00:16:40,394 - backend.auth - DEBUG - Calculated hash: 0f106b8a5ab7e5effbaa0b2a5c12c928d9b12c423dad58ca36e2058117702c20
2025-05-31 00:16:40,394 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 00:16:40,395 - backend.auth - DEBUG - ==================================================

2025-05-31 00:16:40,410 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 21:16:40.410355)
2025-05-31 00:16:40,411 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 21:16:40.411358)
2025-05-31 00:17:20,487 - backend.auth - DEBUG - 
==================================================
2025-05-31 00:17:20,490 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 00:17:20,490 - backend.auth - DEBUG - ==================================================
2025-05-31 00:17:20,491 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 00:17:20,491 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 00:17:20,491 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TRB6lGw&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748639835&signature=20F6u21BGuSdZlZat-_tton_LO7ud-QpmC-lecyEfUay3zSkRgdP8m6hCt4crkWyykmwWHynQB9qdrvTP7G3AA&hash=47781cef6ba905a76779186f11aee09bcde98c725573e832a4f522210da372fe'
2025-05-31 00:17:20,494 - backend.auth - DEBUG - received_hash: 47781cef6ba905a76779186f11aee09bcde98c725573e832a4f522210da372fe
2025-05-31 00:17:20,494 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TRB6lGw', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748639835', 'signature': '20F6u21BGuSdZlZat-_tton_LO7ud-QpmC-lecyEfUay3zSkRgdP8m6hCt4crkWyykmwWHynQB9qdrvTP7G3AA'}
2025-05-31 00:17:20,494 - backend.auth - DEBUG - Hash from dictionary: 47781cef6ba905a76779186f11aee09bcde98c725573e832a4f522210da372fe
2025-05-31 00:17:20,494 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748639835
query_id=AAFreO00AAAAAGt47TRB6lGw
signature=20F6u21BGuSdZlZat-_tton_LO7ud-QpmC-lecyEfUay3zSkRgdP8m6hCt4crkWyykmwWHynQB9qdrvTP7G3AA
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 00:17:20,494 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 00:17:20,497 - backend.auth - DEBUG - Calculated hash: 47781cef6ba905a76779186f11aee09bcde98c725573e832a4f522210da372fe
2025-05-31 00:17:20,497 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 00:17:20,497 - backend.auth - DEBUG - ==================================================

2025-05-31 00:17:20,506 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 21:17:20.506036)
2025-05-31 00:17:20,508 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-05-31 21:17:20.508046)
2025-05-31 11:08:55,745 - backend.auth - INFO - ================================================================================
2025-05-31 11:08:55,746 - backend.auth - INFO - Authentication module initialized
2025-05-31 11:08:55,746 - backend.auth - INFO - BOT_TOKEN: 80221..._4-bU (length: 46)
2025-05-31 11:08:55,746 - backend.auth - INFO - ================================================================================
2025-05-31 11:50:12,160 - backend.auth - INFO - ================================================================================
2025-05-31 11:50:12,160 - backend.auth - INFO - Authentication module initialized
2025-05-31 11:50:12,160 - backend.auth - INFO - BOT_TOKEN: 80221..._4-bU (length: 46)
2025-05-31 11:50:12,160 - backend.auth - INFO - ================================================================================
2025-05-31 11:54:28,350 - backend.auth - INFO - ================================================================================
2025-05-31 11:54:28,350 - backend.auth - INFO - Authentication module initialized
2025-05-31 11:54:28,350 - backend.auth - INFO - BOT_TOKEN: 80221..._4-bU (length: 46)
2025-05-31 11:54:28,350 - backend.auth - INFO - ================================================================================
2025-05-31 11:56:00,266 - backend.auth - DEBUG - 
==================================================
2025-05-31 11:56:00,266 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 11:56:00,266 - backend.auth - DEBUG - ==================================================
2025-05-31 11:56:00,267 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 11:56:00,267 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 11:56:00,267 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TQ1-ITU&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748681751&signature=5F7v4YV5-NNMoTfg19WhfVP8_4Cttum1WWLgnJvU3PD038CVSfdmG8YGlHgCyWJkwLy3T0zckyQKq_f3K_VhAw&hash=7fd4adf27781306948445534224cc3d107bacfc58191519481058ef92f6b8ec7'
2025-05-31 11:56:00,267 - backend.auth - DEBUG - received_hash: 7fd4adf27781306948445534224cc3d107bacfc58191519481058ef92f6b8ec7
2025-05-31 11:56:00,268 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TQ1-ITU', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748681751', 'signature': '5F7v4YV5-NNMoTfg19WhfVP8_4Cttum1WWLgnJvU3PD038CVSfdmG8YGlHgCyWJkwLy3T0zckyQKq_f3K_VhAw'}
2025-05-31 11:56:00,268 - backend.auth - DEBUG - Hash from dictionary: 7fd4adf27781306948445534224cc3d107bacfc58191519481058ef92f6b8ec7
2025-05-31 11:56:00,268 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748681751
query_id=AAFreO00AAAAAGt47TQ1-ITU
signature=5F7v4YV5-NNMoTfg19WhfVP8_4Cttum1WWLgnJvU3PD038CVSfdmG8YGlHgCyWJkwLy3T0zckyQKq_f3K_VhAw
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 11:56:00,269 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 11:56:00,269 - backend.auth - DEBUG - Calculated hash: 7fd4adf27781306948445534224cc3d107bacfc58191519481058ef92f6b8ec7
2025-05-31 11:56:00,269 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 11:56:00,269 - backend.auth - DEBUG - ==================================================

2025-05-31 11:56:00,297 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-06-01 08:56:00.281907)
2025-05-31 11:56:00,298 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-06-01 08:56:00.297910)
2025-05-31 11:56:21,406 - backend.auth - DEBUG - 
==================================================
2025-05-31 11:56:21,407 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 11:56:21,407 - backend.auth - DEBUG - ==================================================
2025-05-31 11:56:21,407 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 11:56:21,407 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 11:56:21,408 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TRpeWOd&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748681771&signature=mPvAtH_SQQ05s1kwMCHE-nZLSd099jeDDKbkrt5eEngME5mgvJu_uejtYydNFzLxlzP-3RYIQJKawAKhhLgaBA&hash=ec9fd2005d8c7ffc802923f10df3223c9a33a0c23df8dd60e14d9fd98fd11824'
2025-05-31 11:56:21,408 - backend.auth - DEBUG - received_hash: ec9fd2005d8c7ffc802923f10df3223c9a33a0c23df8dd60e14d9fd98fd11824
2025-05-31 11:56:21,408 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TRpeWOd', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748681771', 'signature': 'mPvAtH_SQQ05s1kwMCHE-nZLSd099jeDDKbkrt5eEngME5mgvJu_uejtYydNFzLxlzP-3RYIQJKawAKhhLgaBA'}
2025-05-31 11:56:21,409 - backend.auth - DEBUG - Hash from dictionary: ec9fd2005d8c7ffc802923f10df3223c9a33a0c23df8dd60e14d9fd98fd11824
2025-05-31 11:56:21,409 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748681771
query_id=AAFreO00AAAAAGt47TRpeWOd
signature=mPvAtH_SQQ05s1kwMCHE-nZLSd099jeDDKbkrt5eEngME5mgvJu_uejtYydNFzLxlzP-3RYIQJKawAKhhLgaBA
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 11:56:21,409 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 11:56:21,409 - backend.auth - DEBUG - Calculated hash: ec9fd2005d8c7ffc802923f10df3223c9a33a0c23df8dd60e14d9fd98fd11824
2025-05-31 11:56:21,410 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 11:56:21,410 - backend.auth - DEBUG - ==================================================

2025-05-31 11:56:21,418 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-06-01 08:56:21.418628)
2025-05-31 11:56:21,419 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-06-01 08:56:21.419627)
2025-05-31 12:07:26,899 - backend.auth - INFO - ================================================================================
2025-05-31 12:07:26,899 - backend.auth - INFO - Authentication module initialized
2025-05-31 12:07:26,899 - backend.auth - INFO - BOT_TOKEN: 80221..._4-bU (length: 46)
2025-05-31 12:07:26,899 - backend.auth - INFO - ================================================================================
2025-05-31 12:07:26,899 - AUTH - INFO - ================================================================================
2025-05-31 12:07:26,899 - AUTH - INFO - Starting Time Banking API
2025-05-31 12:07:26,899 - AUTH - INFO - ================================================================================
2025-05-31 12:07:26,899 - AUTH - INFO - Bot token: 80221..._4-bU (length: 46)
2025-05-31 12:08:22,122 - backend.auth - INFO - ================================================================================
2025-05-31 12:08:22,122 - backend.auth - INFO - Authentication module initialized
2025-05-31 12:08:22,122 - backend.auth - INFO - BOT_TOKEN: 80221..._4-bU (length: 46)
2025-05-31 12:08:22,122 - backend.auth - INFO - ================================================================================
2025-05-31 12:08:22,122 - AUTH - INFO - ================================================================================
2025-05-31 12:08:22,122 - AUTH - INFO - Starting Time Banking API
2025-05-31 12:08:22,122 - AUTH - INFO - ================================================================================
2025-05-31 12:08:22,122 - AUTH - INFO - Bot token: 80221..._4-bU (length: 46)
2025-05-31 12:08:31,618 - AUTH - INFO - [107a60db-614d-4c4b-a23b-519c0ce7190d] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:08:31,622 - AUTH - ERROR - Error in protected route: module 'jwt' has no attribute 'ExpiredSignatureError'
Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 1725, in protected_route
    payload = jwt.decode(access_token, JWT_SECRET_KEY, algorithms=[JWT_ALGORITHM])
              ^^^^^^^^^^
AttributeError: module 'jwt' has no attribute 'decode'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 1731, in protected_route
    except jwt.ExpiredSignatureError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: module 'jwt' has no attribute 'ExpiredSignatureError'
2025-05-31 12:08:31,624 - AUTH - ERROR - HTTP exception: 500 - Internal server error
2025-05-31 12:08:31,625 - AUTH - INFO - [107a60db-614d-4c4b-a23b-519c0ce7190d] Response status: 500 - Completed in 0.0062s
2025-05-31 12:08:32,094 - AUTH - INFO - [2d391b11-d9cd-416d-9557-971574d8854f] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:08:32,095 - AUTH - INFO - [2d391b11-d9cd-416d-9557-971574d8854f] Request body for POST will be processed by endpoint.
2025-05-31 12:08:32,095 - AUTH - INFO - 

********************************************************************************
2025-05-31 12:08:32,096 - AUTH - INFO - === Starting Telegram Authentication ===
2025-05-31 12:08:32,097 - AUTH - INFO - ********************************************************************************
2025-05-31 12:08:32,097 - AUTH - DEBUG - Request headers:
2025-05-31 12:08:32,097 - AUTH - DEBUG -   x-forwarded-proto: https
2025-05-31 12:08:32,097 - AUTH - DEBUG -   x-forwarded-host: 0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:08:32,098 - AUTH - DEBUG -   x-forwarded-for: 77.91.101.132
2025-05-31 12:08:32,098 - AUTH - DEBUG -   sec-fetch-site: same-origin
2025-05-31 12:08:32,098 - AUTH - DEBUG -   sec-fetch-mode: cors
2025-05-31 12:08:32,098 - AUTH - DEBUG -   sec-fetch-dest: empty
2025-05-31 12:08:32,099 - AUTH - DEBUG -   sec-ch-ua-platform: "Windows"
2025-05-31 12:08:32,099 - AUTH - DEBUG -   sec-ch-ua-mobile: ?0
2025-05-31 12:08:32,099 - AUTH - DEBUG -   sec-ch-ua: "Microsoft Edge";v="136", "Microsoft Edge WebView2";v="136", "Not.A/Brand";v="99", "Chromium";v="136"
2025-05-31 12:08:32,099 - AUTH - DEBUG -   referer: https://0e4c-77-91-101-132.ngrok-free.app/
2025-05-31 12:08:32,100 - AUTH - DEBUG -   priority: u=1, i
2025-05-31 12:08:32,100 - AUTH - DEBUG -   origin: https://0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:08:32,100 - AUTH - DEBUG -   cookie: abuse_interstitial=0e4c-77-91-101-132.ngrok-free.app; access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidGVsZWdyYW1faWQiOiI4ODc5NzgwOTEiLCJ1c2VybmFtZSI6InNhcl9hX3RvX3YiLCJ0eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQ4NzY4MTgxfQ.pXpNGty8FjFNCYKhp9NRBuqJa5mPWp1ViEF2fWriUYA; refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidGVsZWdyYW1faWQiOiI4ODc5NzgwOTEiLCJ1c2VybmFtZSI6InNhcl9hX3RvX3YiLCJ0eXBlIjoicmVmcmVzaCIsImV4cCI6MTc0ODc2ODE4MX0.DHa6QZ82zPZTK8JhL1oMCxErNMlJ07yzRaXo0o7zm_8
2025-05-31 12:08:32,100 - AUTH - DEBUG -   content-type: application/json
2025-05-31 12:08:32,101 - AUTH - DEBUG -   accept-language: ru,en;q=0.9,en-GB;q=0.8,en-US;q=0.7
2025-05-31 12:08:32,101 - AUTH - DEBUG -   accept-encoding: gzip, deflate, br, zstd
2025-05-31 12:08:32,101 - AUTH - DEBUG -   accept: application/json, text/plain, */*
2025-05-31 12:08:32,101 - AUTH - DEBUG -   content-length: 580
2025-05-31 12:08:32,101 - AUTH - DEBUG -   user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0
2025-05-31 12:08:32,101 - AUTH - DEBUG -   host: localhost:8000
2025-05-31 12:08:32,101 - AUTH - DEBUG -   connection: close
2025-05-31 12:08:32,101 - AUTH - DEBUG - Request method: POST
2025-05-31 12:08:32,101 - AUTH - DEBUG - POST request to /auth/telegram. Processing body...
2025-05-31 12:08:32,101 - AUTH - DEBUG - Attempt 1: Reading entire request body for POST with timeout...
2025-05-31 12:08:32,101 - AUTH - INFO - Successfully read entire body (POST), length: 580
2025-05-31 12:08:32,101 - AUTH - DEBUG - Raw request body (POST): {"init_data":"query_id=AAFreO00AAAAAGt47TRYVTh6&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748682508&signature=aeHsJ_wpE6mgN7hpEY6qbUuT1IqDx9ogOGtjjE26v_C4thZ-40XSCurX9d4aFIMoxMs4LMYAfb1XYOVzWqc7Bg&hash=88e1...
2025-05-31 12:08:32,101 - AUTH - DEBUG - Parsed JSON data: {'init_data': 'query_id=AAFreO00AAAAAGt47TRYVTh6&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748682508&signature=aeHsJ_wpE6mgN7hpEY6qbUuT1IqDx9ogOGtjjE26v_C4thZ-40XSCurX9d4aFIMoxMs4LMYAfb1XYOVzWqc7Bg&hash=88e12219182ac352f4190614d6ac420ffd7c1415627f3fd10b8ad424a19abf79', 'test_mode': False}
2025-05-31 12:08:32,101 - AUTH - INFO - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:08:32,101 - AUTH - DEBUG - Raw init_data: query_id=AAFreO00AAAAAGt47TRYVTh6&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748682508&signature=aeHsJ_wpE6mgN7hpEY6qbUuT1IqDx9ogOGtjjE26v_C4thZ-40XSCurX9d4aFIMoxMs4LMYAfb1XYOVzWqc7Bg&hash=88e12219182ac352f4190614d6ac420ffd7c1415627f3fd10b8ad424a19abf79
2025-05-31 12:08:32,101 - AUTH - DEBUG - Parsed data parameters count: 5
2025-05-31 12:08:32,101 - AUTH - DEBUG -   query_id: AAFreO00AAAAAGt47TRYVTh6
2025-05-31 12:08:32,101 - AUTH - DEBUG -   user: [hidden for security]
2025-05-31 12:08:32,101 - AUTH - DEBUG -   auth_date: 1748682508
2025-05-31 12:08:32,101 - AUTH - DEBUG -   signature: aeHsJ_wpE6mgN7hpEY6qbUuT1IqDx9ogOGtjjE26v_C4thZ-40XSCurX9d4aFIMoxMs4LMYAfb1XYOVzWqc7Bg
2025-05-31 12:08:32,101 - AUTH - DEBUG -   hash: [hidden for security]
2025-05-31 12:08:32,101 - AUTH - DEBUG - Extracted hash value length: 64
2025-05-31 12:08:32,108 - AUTH - INFO - Verifying Telegram hash...
2025-05-31 12:08:32,108 - backend.auth - DEBUG - 
==================================================
2025-05-31 12:08:32,108 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 12:08:32,108 - backend.auth - DEBUG - ==================================================
2025-05-31 12:08:32,109 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 12:08:32,109 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 12:08:32,109 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TRYVTh6&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748682508&signature=aeHsJ_wpE6mgN7hpEY6qbUuT1IqDx9ogOGtjjE26v_C4thZ-40XSCurX9d4aFIMoxMs4LMYAfb1XYOVzWqc7Bg&hash=88e12219182ac352f4190614d6ac420ffd7c1415627f3fd10b8ad424a19abf79'
2025-05-31 12:08:32,109 - backend.auth - DEBUG - received_hash: 88e12219182ac352f4190614d6ac420ffd7c1415627f3fd10b8ad424a19abf79
2025-05-31 12:08:32,109 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TRYVTh6', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748682508', 'signature': 'aeHsJ_wpE6mgN7hpEY6qbUuT1IqDx9ogOGtjjE26v_C4thZ-40XSCurX9d4aFIMoxMs4LMYAfb1XYOVzWqc7Bg'}
2025-05-31 12:08:32,109 - backend.auth - DEBUG - Hash from dictionary: 88e12219182ac352f4190614d6ac420ffd7c1415627f3fd10b8ad424a19abf79
2025-05-31 12:08:32,109 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748682508
query_id=AAFreO00AAAAAGt47TRYVTh6
signature=aeHsJ_wpE6mgN7hpEY6qbUuT1IqDx9ogOGtjjE26v_C4thZ-40XSCurX9d4aFIMoxMs4LMYAfb1XYOVzWqc7Bg
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 12:08:32,109 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 12:08:32,109 - backend.auth - DEBUG - Calculated hash: 88e12219182ac352f4190614d6ac420ffd7c1415627f3fd10b8ad424a19abf79
2025-05-31 12:08:32,109 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 12:08:32,109 - backend.auth - DEBUG - ==================================================

2025-05-31 12:08:32,109 - AUTH - INFO - Hash verification successful
2025-05-31 12:08:32,109 - AUTH - INFO - Parsing user data...
2025-05-31 12:08:32,109 - AUTH - DEBUG - Raw user data length: 319
2025-05-31 12:08:32,109 - AUTH - DEBUG - URL-decoded user data length: 215
2025-05-31 12:08:32,109 - AUTH - DEBUG - Parsed user_info: ID=887978091, username=sar_a_to_v
2025-05-31 12:08:32,109 - AUTH - DEBUG - Converted telegram_id to int: 887978091 (type: <class 'int'>)
2025-05-31 12:08:32,109 - AUTH - INFO - Looking up user with telegram_id: 887978091
2025-05-31 12:08:32,109 - AUTH - ERROR - Database error: 'dict' object has no attribute 'query'
Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 1537, in telegram_auth
    user = db.query(models.User).filter(models.User.telegram_id == telegram_id).first()
           ^^^^^^^^
AttributeError: 'dict' object has no attribute 'query'
2025-05-31 12:08:32,109 - AUTH - ERROR - Authentication failed with HTTPException
2025-05-31 12:08:32,109 - AUTH - ERROR - HTTP exception: 500 - Database error
2025-05-31 12:08:32,109 - AUTH - INFO - [2d391b11-d9cd-416d-9557-971574d8854f] Response status: 500 - Completed in 0.0139s
2025-05-31 12:08:32,579 - AUTH - INFO - [18f37d3c-fd25-4623-9adf-647b87bb6e93] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:08:32,580 - AUTH - INFO - [18f37d3c-fd25-4623-9adf-647b87bb6e93] Request body for POST will be processed by endpoint.
2025-05-31 12:08:32,581 - AUTH - INFO - 

********************************************************************************
2025-05-31 12:08:32,582 - AUTH - INFO - === Starting Telegram Authentication ===
2025-05-31 12:08:32,582 - AUTH - INFO - ********************************************************************************
2025-05-31 12:08:32,583 - AUTH - DEBUG - Request headers:
2025-05-31 12:08:32,583 - AUTH - DEBUG -   x-forwarded-proto: https
2025-05-31 12:08:32,583 - AUTH - DEBUG -   x-forwarded-host: 0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:08:32,584 - AUTH - DEBUG -   x-forwarded-for: 77.91.101.132
2025-05-31 12:08:32,584 - AUTH - DEBUG -   sec-fetch-site: same-origin
2025-05-31 12:08:32,584 - AUTH - DEBUG -   sec-fetch-mode: cors
2025-05-31 12:08:32,585 - AUTH - DEBUG -   sec-fetch-dest: empty
2025-05-31 12:08:32,585 - AUTH - DEBUG -   sec-ch-ua-platform: "Windows"
2025-05-31 12:08:32,586 - AUTH - DEBUG -   sec-ch-ua-mobile: ?0
2025-05-31 12:08:32,586 - AUTH - DEBUG -   sec-ch-ua: "Microsoft Edge";v="136", "Microsoft Edge WebView2";v="136", "Not.A/Brand";v="99", "Chromium";v="136"
2025-05-31 12:08:32,586 - AUTH - DEBUG -   referer: https://0e4c-77-91-101-132.ngrok-free.app/
2025-05-31 12:08:32,587 - AUTH - DEBUG -   priority: u=1, i
2025-05-31 12:08:32,587 - AUTH - DEBUG -   origin: https://0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:08:32,587 - AUTH - DEBUG -   cookie: abuse_interstitial=0e4c-77-91-101-132.ngrok-free.app; access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidGVsZWdyYW1faWQiOiI4ODc5NzgwOTEiLCJ1c2VybmFtZSI6InNhcl9hX3RvX3YiLCJ0eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQ4NzY4MTgxfQ.pXpNGty8FjFNCYKhp9NRBuqJa5mPWp1ViEF2fWriUYA; refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidGVsZWdyYW1faWQiOiI4ODc5NzgwOTEiLCJ1c2VybmFtZSI6InNhcl9hX3RvX3YiLCJ0eXBlIjoicmVmcmVzaCIsImV4cCI6MTc0ODc2ODE4MX0.DHa6QZ82zPZTK8JhL1oMCxErNMlJ07yzRaXo0o7zm_8
2025-05-31 12:08:32,587 - AUTH - DEBUG -   content-type: application/json
2025-05-31 12:08:32,587 - AUTH - DEBUG -   accept-language: ru,en;q=0.9,en-GB;q=0.8,en-US;q=0.7
2025-05-31 12:08:32,587 - AUTH - DEBUG -   accept-encoding: gzip, deflate, br, zstd
2025-05-31 12:08:32,587 - AUTH - DEBUG -   accept: application/json, text/plain, */*
2025-05-31 12:08:32,587 - AUTH - DEBUG -   content-length: 579
2025-05-31 12:08:32,587 - AUTH - DEBUG -   user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0
2025-05-31 12:08:32,587 - AUTH - DEBUG -   host: localhost:8000
2025-05-31 12:08:32,587 - AUTH - DEBUG -   connection: close
2025-05-31 12:08:32,587 - AUTH - DEBUG - Request method: POST
2025-05-31 12:08:32,587 - AUTH - DEBUG - POST request to /auth/telegram. Processing body...
2025-05-31 12:08:32,587 - AUTH - DEBUG - Attempt 1: Reading entire request body for POST with timeout...
2025-05-31 12:08:32,587 - AUTH - INFO - Successfully read entire body (POST), length: 579
2025-05-31 12:08:32,592 - AUTH - DEBUG - Raw request body (POST): {"init_data":"query_id=AAFreO00AAAAAGt47TRYVTh6&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748682508&signature=aeHsJ_wpE6mgN7hpEY6qbUuT1IqDx9ogOGtjjE26v_C4thZ-40XSCurX9d4aFIMoxMs4LMYAfb1XYOVzWqc7Bg&hash=88e1...
2025-05-31 12:08:32,592 - AUTH - DEBUG - Parsed JSON data: {'init_data': 'query_id=AAFreO00AAAAAGt47TRYVTh6&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748682508&signature=aeHsJ_wpE6mgN7hpEY6qbUuT1IqDx9ogOGtjjE26v_C4thZ-40XSCurX9d4aFIMoxMs4LMYAfb1XYOVzWqc7Bg&hash=88e12219182ac352f4190614d6ac420ffd7c1415627f3fd10b8ad424a19abf79', 'test_mode': True}
2025-05-31 12:08:32,592 - AUTH - INFO - Got init_data from JSON body (POST), test_mode=True
2025-05-31 12:08:32,592 - AUTH - WARNING - Test mode detected in /auth/telegram! Creating test user...
2025-05-31 12:08:32,592 - AUTH - ERROR - Attempt 1: Error reading request body (POST): 'dict' object has no attribute 'query'
Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 1333, in telegram_auth
    db.query(models.User).filter(models.User.telegram_id == 12345).first()
    ^^^^^^^^
AttributeError: 'dict' object has no attribute 'query'
2025-05-31 12:08:32,596 - AUTH - DEBUG - Raw init_data: query_id=AAFreO00AAAAAGt47TRYVTh6&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748682508&signature=aeHsJ_wpE6mgN7hpEY6qbUuT1IqDx9ogOGtjjE26v_C4thZ-40XSCurX9d4aFIMoxMs4LMYAfb1XYOVzWqc7Bg&hash=88e12219182ac352f4190614d6ac420ffd7c1415627f3fd10b8ad424a19abf79
2025-05-31 12:08:32,596 - AUTH - WARNING - Test mode active - bypassing hash verification
2025-05-31 12:08:32,597 - AUTH - ERROR - Error in test mode: 'dict' object has no attribute 'query'
2025-05-31 12:08:32,597 - AUTH - ERROR - 'dict' object has no attribute 'query'
Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 1423, in telegram_auth
    test_user = db.query(models.User).filter(models.User.telegram_id == 12345).first()
                ^^^^^^^^
AttributeError: 'dict' object has no attribute 'query'
2025-05-31 12:08:32,598 - AUTH - ERROR - Authentication failed with HTTPException
2025-05-31 12:08:32,599 - AUTH - ERROR - HTTP exception: 500 - Error in test mode
2025-05-31 12:08:32,599 - AUTH - INFO - [18f37d3c-fd25-4623-9adf-647b87bb6e93] Response status: 500 - Completed in 0.0191s
2025-05-31 12:08:33,497 - AUTH - INFO - [76e42fd6-e735-421f-a85d-30d87eee2d2e] Request from 77.91.101.132:0 - POST /debug/auth/
2025-05-31 12:08:33,498 - AUTH - INFO - [76e42fd6-e735-421f-a85d-30d87eee2d2e] Request body for POST will be processed by endpoint.
2025-05-31 12:08:33,499 - AUTH - WARNING - 

********************************************************************************
2025-05-31 12:08:33,499 - AUTH - WARNING - === Starting Debug Auth POST ===
2025-05-31 12:08:33,499 - AUTH - WARNING - ********************************************************************************
2025-05-31 12:08:33,500 - AUTH - DEBUG - Attempting to read request body for /debug/auth POST...
2025-05-31 12:08:33,500 - AUTH - INFO - Successfully read body for /debug/auth POST, length: 44
2025-05-31 12:08:33,501 - AUTH - DEBUG - Raw request body for /debug/auth POST: {"telegram_id":12345,"username":"test_user"}...
2025-05-31 12:08:33,501 - AUTH - DEBUG - Parsed JSON data for /debug/auth POST: {'telegram_id': 12345, 'username': 'test_user'}
2025-05-31 12:08:33,501 - AUTH - WARNING - Creating/fetching test user for /debug/auth: telegram_id=12345, username=test_user
2025-05-31 12:08:33,502 - AUTH - ERROR - [76e42fd6-e735-421f-a85d-30d87eee2d2e] Error during request processing: 'dict' object has no attribute 'query'
2025-05-31 12:08:33,559 - AUTH - ERROR - [76e42fd6-e735-421f-a85d-30d87eee2d2e] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 200, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 1038, in debug_auth_post
    user = db.query(models.User).filter(models.User.telegram_id == telegram_id).first()
           ^^^^^^^^
AttributeError: 'dict' object has no attribute 'query'

2025-05-31 12:08:33,559 - AUTH - ERROR - [76e42fd6-e735-421f-a85d-30d87eee2d2e] Failed after 0.0042s
2025-05-31 12:08:33,559 - AUTH - ERROR - Unhandled exception: 'dict' object has no attribute 'query'
2025-05-31 12:08:33,593 - AUTH - ERROR - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 200, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 1038, in debug_auth_post
    user = db.query(models.User).filter(models.User.telegram_id == telegram_id).first()
           ^^^^^^^^
AttributeError: 'dict' object has no attribute 'query'

2025-05-31 12:13:22,311 - backend.auth - INFO - ================================================================================
2025-05-31 12:13:22,311 - backend.auth - INFO - Authentication module initialized
2025-05-31 12:13:22,312 - backend.auth - INFO - BOT_TOKEN: 80221..._4-bU (length: 46)
2025-05-31 12:13:22,312 - backend.auth - INFO - ================================================================================
2025-05-31 12:13:22,313 - AUTH - INFO - ================================================================================
2025-05-31 12:13:22,313 - AUTH - INFO - Starting Time Banking API
2025-05-31 12:13:22,314 - AUTH - INFO - ================================================================================
2025-05-31 12:13:22,314 - AUTH - INFO - Bot token: 80221..._4-bU (length: 46)
2025-05-31 12:17:51,734 - backend.auth - INFO - ================================================================================
2025-05-31 12:17:51,734 - backend.auth - INFO - Authentication module initialized
2025-05-31 12:17:51,734 - backend.auth - INFO - BOT_TOKEN: 80221..._4-bU (length: 46)
2025-05-31 12:17:51,735 - backend.auth - INFO - ================================================================================
2025-05-31 12:17:51,736 - AUTH - INFO - ================================================================================
2025-05-31 12:17:51,736 - AUTH - INFO - Starting Time Banking API
2025-05-31 12:17:51,736 - AUTH - INFO - ================================================================================
2025-05-31 12:17:51,737 - AUTH - INFO - Bot token: 80221..._4-bU (length: 46)
2025-05-31 12:18:19,757 - AUTH - INFO - [9b53607f-0cd6-46a4-8eb6-723cfdbd8619] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:18:19,762 - AUTH - INFO - [9b53607f-0cd6-46a4-8eb6-723cfdbd8619] Response status: 200 - Completed in 0.0047s
2025-05-31 12:18:20,193 - AUTH - INFO - [5df461a6-a791-4f53-91d8-ede3ff642ee9] Request from 77.91.101.132:0 - GET /user/me/
2025-05-31 12:18:20,194 - AUTH - DEBUG - [GetUserMe] Attempting to get current user.
2025-05-31 12:18:20,195 - AUTH - ERROR - [5df461a6-a791-4f53-91d8-ede3ff642ee9] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:18:20,217 - AUTH - ERROR - [5df461a6-a791-4f53-91d8-ede3ff642ee9] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:18:20,217 - AUTH - ERROR - [5df461a6-a791-4f53-91d8-ede3ff642ee9] Failed after 0.0016s
2025-05-31 12:18:20,232 - AUTH - ERROR - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:18:20,232 - AUTH - ERROR - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:18:20,620 - AUTH - INFO - [a634f376-7064-4961-8223-19e949eccb39] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:18:20,620 - AUTH - INFO - [a634f376-7064-4961-8223-19e949eccb39] Request body for POST will be processed by endpoint.
2025-05-31 12:18:20,622 - AUTH - INFO - 

********************************************************************************
2025-05-31 12:18:20,622 - AUTH - INFO - === Starting Telegram Authentication ===
2025-05-31 12:18:20,623 - AUTH - INFO - ********************************************************************************
2025-05-31 12:18:20,623 - AUTH - DEBUG - Request headers:
2025-05-31 12:18:20,623 - AUTH - DEBUG -   x-forwarded-proto: https
2025-05-31 12:18:20,624 - AUTH - DEBUG -   x-forwarded-host: 0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:18:20,624 - AUTH - DEBUG -   x-forwarded-for: 77.91.101.132
2025-05-31 12:18:20,624 - AUTH - DEBUG -   sec-fetch-site: same-origin
2025-05-31 12:18:20,625 - AUTH - DEBUG -   sec-fetch-mode: cors
2025-05-31 12:18:20,625 - AUTH - DEBUG -   sec-fetch-dest: empty
2025-05-31 12:18:20,625 - AUTH - DEBUG -   sec-ch-ua-platform: "Windows"
2025-05-31 12:18:20,625 - AUTH - DEBUG -   sec-ch-ua-mobile: ?0
2025-05-31 12:18:20,626 - AUTH - DEBUG -   sec-ch-ua: "Microsoft Edge";v="136", "Microsoft Edge WebView2";v="136", "Not.A/Brand";v="99", "Chromium";v="136"
2025-05-31 12:18:20,626 - AUTH - DEBUG -   referer: https://0e4c-77-91-101-132.ngrok-free.app/
2025-05-31 12:18:20,626 - AUTH - DEBUG -   priority: u=1, i
2025-05-31 12:18:20,627 - AUTH - DEBUG -   origin: https://0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:18:20,627 - AUTH - DEBUG -   cookie: abuse_interstitial=0e4c-77-91-101-132.ngrok-free.app; access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidGVsZWdyYW1faWQiOiI4ODc5NzgwOTEiLCJ1c2VybmFtZSI6InNhcl9hX3RvX3YiLCJ0eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQ4NzY4MTgxfQ.pXpNGty8FjFNCYKhp9NRBuqJa5mPWp1ViEF2fWriUYA; refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidGVsZWdyYW1faWQiOiI4ODc5NzgwOTEiLCJ1c2VybmFtZSI6InNhcl9hX3RvX3YiLCJ0eXBlIjoicmVmcmVzaCIsImV4cCI6MTc0ODc2ODE4MX0.DHa6QZ82zPZTK8JhL1oMCxErNMlJ07yzRaXo0o7zm_8
2025-05-31 12:18:20,627 - AUTH - DEBUG -   content-type: application/json
2025-05-31 12:18:20,627 - AUTH - DEBUG -   accept-language: ru,en;q=0.9,en-GB;q=0.8,en-US;q=0.7
2025-05-31 12:18:20,627 - AUTH - DEBUG -   accept-encoding: gzip, deflate, br, zstd
2025-05-31 12:18:20,627 - AUTH - DEBUG -   accept: application/json, text/plain, */*
2025-05-31 12:18:20,627 - AUTH - DEBUG -   content-length: 580
2025-05-31 12:18:20,627 - AUTH - DEBUG -   user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0
2025-05-31 12:18:20,627 - AUTH - DEBUG -   host: localhost:8000
2025-05-31 12:18:20,627 - AUTH - DEBUG -   connection: close
2025-05-31 12:18:20,631 - AUTH - DEBUG - Request method: POST
2025-05-31 12:18:20,631 - AUTH - DEBUG - POST request to /auth/telegram. Processing body...
2025-05-31 12:18:20,631 - AUTH - DEBUG - Attempt 1: Reading entire request body for POST with timeout...
2025-05-31 12:18:20,632 - AUTH - INFO - Successfully read entire body (POST), length: 580
2025-05-31 12:18:20,632 - AUTH - DEBUG - Raw request body (POST): {"init_data":"query_id=AAFreO00AAAAAGt47TSEeQdJ&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683096&signature=78Pxrc9Kbt81TQyy8h3nny3YKexi-EZE13gzzW6BJ9DSAf2mqR2CfaSj-VliyhpqoVSG7lnZPgvwmsQyr7o1CQ&hash=2d5f...
2025-05-31 12:18:20,632 - AUTH - DEBUG - Parsed JSON data: {'init_data': 'query_id=AAFreO00AAAAAGt47TSEeQdJ&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683096&signature=78Pxrc9Kbt81TQyy8h3nny3YKexi-EZE13gzzW6BJ9DSAf2mqR2CfaSj-VliyhpqoVSG7lnZPgvwmsQyr7o1CQ&hash=2d5fb068604fdd1a98bf652b190ad2a76894e4b9a7726cc03178db5d68230781', 'test_mode': False}
2025-05-31 12:18:20,632 - AUTH - INFO - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:18:20,632 - AUTH - DEBUG - Raw init_data: query_id=AAFreO00AAAAAGt47TSEeQdJ&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683096&signature=78Pxrc9Kbt81TQyy8h3nny3YKexi-EZE13gzzW6BJ9DSAf2mqR2CfaSj-VliyhpqoVSG7lnZPgvwmsQyr7o1CQ&hash=2d5fb068604fdd1a98bf652b190ad2a76894e4b9a7726cc03178db5d68230781
2025-05-31 12:18:20,632 - AUTH - DEBUG - Parsed data parameters count: 5
2025-05-31 12:18:20,632 - AUTH - DEBUG -   query_id: AAFreO00AAAAAGt47TSEeQdJ
2025-05-31 12:18:20,632 - AUTH - DEBUG -   user: [hidden for security]
2025-05-31 12:18:20,632 - AUTH - DEBUG -   auth_date: 1748683096
2025-05-31 12:18:20,632 - AUTH - DEBUG -   signature: 78Pxrc9Kbt81TQyy8h3nny3YKexi-EZE13gzzW6BJ9DSAf2mqR2CfaSj-VliyhpqoVSG7lnZPgvwmsQyr7o1CQ
2025-05-31 12:18:20,632 - AUTH - DEBUG -   hash: [hidden for security]
2025-05-31 12:18:20,632 - AUTH - DEBUG - Extracted hash value length: 64
2025-05-31 12:18:20,632 - AUTH - INFO - Verifying Telegram hash...
2025-05-31 12:18:20,632 - backend.auth - DEBUG - 
==================================================
2025-05-31 12:18:20,632 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 12:18:20,632 - backend.auth - DEBUG - ==================================================
2025-05-31 12:18:20,632 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 12:18:20,632 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 12:18:20,632 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TSEeQdJ&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683096&signature=78Pxrc9Kbt81TQyy8h3nny3YKexi-EZE13gzzW6BJ9DSAf2mqR2CfaSj-VliyhpqoVSG7lnZPgvwmsQyr7o1CQ&hash=2d5fb068604fdd1a98bf652b190ad2a76894e4b9a7726cc03178db5d68230781'
2025-05-31 12:18:20,632 - backend.auth - DEBUG - received_hash: 2d5fb068604fdd1a98bf652b190ad2a76894e4b9a7726cc03178db5d68230781
2025-05-31 12:18:20,632 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TSEeQdJ', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748683096', 'signature': '78Pxrc9Kbt81TQyy8h3nny3YKexi-EZE13gzzW6BJ9DSAf2mqR2CfaSj-VliyhpqoVSG7lnZPgvwmsQyr7o1CQ'}
2025-05-31 12:18:20,632 - backend.auth - DEBUG - Hash from dictionary: 2d5fb068604fdd1a98bf652b190ad2a76894e4b9a7726cc03178db5d68230781
2025-05-31 12:18:20,632 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748683096
query_id=AAFreO00AAAAAGt47TSEeQdJ
signature=78Pxrc9Kbt81TQyy8h3nny3YKexi-EZE13gzzW6BJ9DSAf2mqR2CfaSj-VliyhpqoVSG7lnZPgvwmsQyr7o1CQ
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 12:18:20,632 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 12:18:20,632 - backend.auth - DEBUG - Calculated hash: 2d5fb068604fdd1a98bf652b190ad2a76894e4b9a7726cc03178db5d68230781
2025-05-31 12:18:20,632 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 12:18:20,632 - backend.auth - DEBUG - ==================================================

2025-05-31 12:18:20,632 - AUTH - INFO - Hash verification successful
2025-05-31 12:18:20,632 - AUTH - INFO - Parsing user data...
2025-05-31 12:18:20,632 - AUTH - DEBUG - Raw user data length: 319
2025-05-31 12:18:20,632 - AUTH - DEBUG - URL-decoded user data length: 215
2025-05-31 12:18:20,632 - AUTH - DEBUG - Parsed user_info: ID=887978091, username=sar_a_to_v
2025-05-31 12:18:20,632 - AUTH - DEBUG - Converted telegram_id to int: 887978091 (type: <class 'int'>)
2025-05-31 12:18:20,632 - AUTH - INFO - Looking up user with telegram_id: 887978091
2025-05-31 12:18:20,649 - AUTH - INFO - Found existing user: sar_a_to_v (ID: 2, Telegram ID: 887978091)
2025-05-31 12:18:20,649 - AUTH - INFO - Creating JWT tokens for user: sar_a_to_v
2025-05-31 12:18:20,651 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-06-01 09:18:20.651875)
2025-05-31 12:18:20,651 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-06-01 09:18:20.651875)
2025-05-31 12:18:20,651 - AUTH - INFO - === Authentication Successful ===
2025-05-31 12:18:20,651 - AUTH - INFO - ********************************************************************************


2025-05-31 12:18:20,651 - AUTH - INFO - [a634f376-7064-4961-8223-19e949eccb39] Response status: 200 - Completed in 0.0308s
2025-05-31 12:18:21,345 - AUTH - INFO - [4597c1d7-0759-4ab3-9a89-aa2018f4d1f4] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:18:21,347 - AUTH - ERROR - [4597c1d7-0759-4ab3-9a89-aa2018f4d1f4] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:18:21,348 - AUTH - ERROR - [4597c1d7-0759-4ab3-9a89-aa2018f4d1f4] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:18:21,349 - AUTH - ERROR - [4597c1d7-0759-4ab3-9a89-aa2018f4d1f4] Failed after 0.0015s
2025-05-31 12:18:21,350 - AUTH - ERROR - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:18:21,351 - AUTH - ERROR - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:18:23,195 - AUTH - INFO - [71cc148d-3f40-48e6-8e10-f4cfc0e0bd89] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:18:23,196 - AUTH - INFO - [848f85c3-1bc8-4adf-b225-87b1c4b77afa] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:18:23,209 - AUTH - INFO - [09eab5ab-31e6-40f5-9514-1e2cb7bf8935] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:18:23,209 - AUTH - INFO - [d8611f1c-e0b3-41f2-a36a-d2006b2baf6b] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:18:23,210 - AUTH - INFO - [848f85c3-1bc8-4adf-b225-87b1c4b77afa] Response status: 200 - Completed in 0.0136s
2025-05-31 12:18:23,213 - AUTH - INFO - [71cc148d-3f40-48e6-8e10-f4cfc0e0bd89] Response status: 200 - Completed in 0.0172s
2025-05-31 12:18:23,215 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:18:23,220 - AUTH - INFO - [09eab5ab-31e6-40f5-9514-1e2cb7bf8935] Response status: 200 - Completed in 0.0112s
2025-05-31 12:18:23,221 - AUTH - INFO - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:18:23,222 - AUTH - DEBUG - [GetTransactionPartners] Added partner_id 3 (from listing 11, user was creator)
2025-05-31 12:18:23,224 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:18:23,225 - AUTH - INFO - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:18:23,225 - AUTH - DEBUG - [GetTransactionPartners] Returning partner 1: ID=3, Username=en7ka
2025-05-31 12:18:23,226 - AUTH - INFO - [d8611f1c-e0b3-41f2-a36a-d2006b2baf6b] Response status: 200 - Completed in 0.0164s
2025-05-31 12:18:23,393 - AUTH - INFO - [548992b4-a414-4590-b159-8ad56da5fd81] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:18:23,398 - AUTH - INFO - [548992b4-a414-4590-b159-8ad56da5fd81] Response status: 200 - Completed in 0.0043s
2025-05-31 12:18:23,436 - AUTH - INFO - [8386b47b-f846-4846-b038-d615474a13eb] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:18:23,437 - AUTH - INFO - [214b7710-0fab-4f49-a78d-42aeed26577e] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:18:23,441 - AUTH - INFO - [8386b47b-f846-4846-b038-d615474a13eb] Response status: 200 - Completed in 0.0042s
2025-05-31 12:18:23,444 - AUTH - INFO - [214b7710-0fab-4f49-a78d-42aeed26577e] Response status: 200 - Completed in 0.0066s
2025-05-31 12:18:23,448 - AUTH - INFO - [9ae0c4c8-540f-422f-b308-c71ee0f0aac7] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:18:23,451 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:18:23,452 - AUTH - INFO - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:18:23,452 - AUTH - DEBUG - [GetTransactionPartners] Added partner_id 3 (from listing 11, user was creator)
2025-05-31 12:18:23,453 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:18:23,454 - AUTH - INFO - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:18:23,455 - AUTH - DEBUG - [GetTransactionPartners] Returning partner 1: ID=3, Username=en7ka
2025-05-31 12:18:23,456 - AUTH - INFO - [9ae0c4c8-540f-422f-b308-c71ee0f0aac7] Response status: 200 - Completed in 0.0063s
2025-05-31 12:18:26,170 - AUTH - INFO - [fbf42733-26fe-49aa-8906-b12b548a2a99] Request from 77.91.101.132:0 - POST /profile/2/avatar/
2025-05-31 12:18:26,170 - AUTH - INFO - [fbf42733-26fe-49aa-8906-b12b548a2a99] Request body for POST will be processed by endpoint.
2025-05-31 12:18:26,182 - AUTH - INFO - [fbf42733-26fe-49aa-8906-b12b548a2a99] Response status: 200 - Completed in 0.0114s
2025-05-31 12:18:26,355 - AUTH - INFO - [34013895-f24e-40f9-b549-1fe14ac5af8c] Request from 77.91.101.132:0 - GET /static/avatars/user_2_avatar_1748683106.jpg
2025-05-31 12:18:26,413 - AUTH - INFO - [34013895-f24e-40f9-b549-1fe14ac5af8c] Response status: 200 - Completed in 0.0570s
2025-05-31 12:18:35,635 - AUTH - INFO - [8ea03a1b-b016-4230-aad1-e697adf81714] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:18:35,637 - AUTH - INFO - [8ea03a1b-b016-4230-aad1-e697adf81714] Response status: 200 - Completed in 0.0011s
2025-05-31 12:18:35,851 - AUTH - INFO - [824a126c-896e-4209-bb56-123d49b11f9e] Request from 77.91.101.132:0 - GET /user/me/
2025-05-31 12:18:35,852 - AUTH - DEBUG - [GetUserMe] Attempting to get current user.
2025-05-31 12:18:35,854 - AUTH - ERROR - [824a126c-896e-4209-bb56-123d49b11f9e] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:18:35,855 - AUTH - ERROR - [824a126c-896e-4209-bb56-123d49b11f9e] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:18:35,856 - AUTH - ERROR - [824a126c-896e-4209-bb56-123d49b11f9e] Failed after 0.0016s
2025-05-31 12:18:35,856 - AUTH - ERROR - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:18:35,857 - AUTH - ERROR - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:18:36,337 - AUTH - INFO - [a34783b8-6c0a-4ba1-8e52-4aa8740e2dc8] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:18:36,338 - AUTH - INFO - [a34783b8-6c0a-4ba1-8e52-4aa8740e2dc8] Request body for POST will be processed by endpoint.
2025-05-31 12:18:36,339 - AUTH - INFO - 

********************************************************************************
2025-05-31 12:18:36,340 - AUTH - INFO - === Starting Telegram Authentication ===
2025-05-31 12:18:36,340 - AUTH - INFO - ********************************************************************************
2025-05-31 12:18:36,340 - AUTH - DEBUG - Request headers:
2025-05-31 12:18:36,341 - AUTH - DEBUG -   x-forwarded-proto: https
2025-05-31 12:18:36,341 - AUTH - DEBUG -   x-forwarded-host: 0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:18:36,341 - AUTH - DEBUG -   x-forwarded-for: 77.91.101.132
2025-05-31 12:18:36,341 - AUTH - DEBUG -   sec-fetch-site: same-origin
2025-05-31 12:18:36,342 - AUTH - DEBUG -   sec-fetch-mode: cors
2025-05-31 12:18:36,342 - AUTH - DEBUG -   sec-fetch-dest: empty
2025-05-31 12:18:36,342 - AUTH - DEBUG -   sec-ch-ua-platform: "Windows"
2025-05-31 12:18:36,343 - AUTH - DEBUG -   sec-ch-ua-mobile: ?0
2025-05-31 12:18:36,343 - AUTH - DEBUG -   sec-ch-ua: "Microsoft Edge";v="136", "Microsoft Edge WebView2";v="136", "Not.A/Brand";v="99", "Chromium";v="136"
2025-05-31 12:18:36,343 - AUTH - DEBUG -   referer: https://0e4c-77-91-101-132.ngrok-free.app/
2025-05-31 12:18:36,344 - AUTH - DEBUG -   priority: u=1, i
2025-05-31 12:18:36,345 - AUTH - DEBUG -   origin: https://0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:18:36,345 - AUTH - DEBUG -   cookie: abuse_interstitial=0e4c-77-91-101-132.ngrok-free.app; access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidGVsZWdyYW1faWQiOiI4ODc5NzgwOTEiLCJ1c2VybmFtZSI6InNhcl9hX3RvX3YiLCJ0eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQ4NzY5NTAwfQ.u54eMPZ9UjOxv3CFfjRJBQUQ_Keh9BXQO-JBVDh9oHo; refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidGVsZWdyYW1faWQiOiI4ODc5NzgwOTEiLCJ1c2VybmFtZSI6InNhcl9hX3RvX3YiLCJ0eXBlIjoicmVmcmVzaCIsImV4cCI6MTc0ODc2OTUwMH0.XiRpcZB3EgPUmig5b8cmjmyjyx77xl7iDrDVgtY3ZXM
2025-05-31 12:18:36,345 - AUTH - DEBUG -   content-type: application/json
2025-05-31 12:18:36,345 - AUTH - DEBUG -   accept-language: ru,en;q=0.9,en-GB;q=0.8,en-US;q=0.7
2025-05-31 12:18:36,345 - AUTH - DEBUG -   accept-encoding: gzip, deflate, br, zstd
2025-05-31 12:18:36,345 - AUTH - DEBUG -   accept: application/json, text/plain, */*
2025-05-31 12:18:36,345 - AUTH - DEBUG -   content-length: 580
2025-05-31 12:18:36,345 - AUTH - DEBUG -   user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0
2025-05-31 12:18:36,345 - AUTH - DEBUG -   host: localhost:8000
2025-05-31 12:18:36,345 - AUTH - DEBUG -   connection: close
2025-05-31 12:18:36,345 - AUTH - DEBUG - Request method: POST
2025-05-31 12:18:36,345 - AUTH - DEBUG - POST request to /auth/telegram. Processing body...
2025-05-31 12:18:36,349 - AUTH - DEBUG - Attempt 1: Reading entire request body for POST with timeout...
2025-05-31 12:18:36,349 - AUTH - INFO - Successfully read entire body (POST), length: 580
2025-05-31 12:18:36,350 - AUTH - DEBUG - Raw request body (POST): {"init_data":"query_id=AAFreO00AAAAAGt47TSM7RXz&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683108&signature=sMvpAb5dsah0ZpoySTQqFpEbrXlxvaIWFwhlFwusXHcmfTaE7MgdE1g-vjBKABDtcyACrR_st6eM9Wxm3eunBQ&hash=1c8f...
2025-05-31 12:18:36,351 - AUTH - DEBUG - Parsed JSON data: {'init_data': 'query_id=AAFreO00AAAAAGt47TSM7RXz&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683108&signature=sMvpAb5dsah0ZpoySTQqFpEbrXlxvaIWFwhlFwusXHcmfTaE7MgdE1g-vjBKABDtcyACrR_st6eM9Wxm3eunBQ&hash=1c8f949305015f3d43c4d77933c08d475ab412f10995f08dce9efa459e179f1b', 'test_mode': False}
2025-05-31 12:18:36,351 - AUTH - INFO - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:18:36,352 - AUTH - DEBUG - Raw init_data: query_id=AAFreO00AAAAAGt47TSM7RXz&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683108&signature=sMvpAb5dsah0ZpoySTQqFpEbrXlxvaIWFwhlFwusXHcmfTaE7MgdE1g-vjBKABDtcyACrR_st6eM9Wxm3eunBQ&hash=1c8f949305015f3d43c4d77933c08d475ab412f10995f08dce9efa459e179f1b
2025-05-31 12:18:36,352 - AUTH - DEBUG - Parsed data parameters count: 5
2025-05-31 12:18:36,352 - AUTH - DEBUG -   query_id: AAFreO00AAAAAGt47TSM7RXz
2025-05-31 12:18:36,353 - AUTH - DEBUG -   user: [hidden for security]
2025-05-31 12:18:36,353 - AUTH - DEBUG -   auth_date: 1748683108
2025-05-31 12:18:36,353 - AUTH - DEBUG -   signature: sMvpAb5dsah0ZpoySTQqFpEbrXlxvaIWFwhlFwusXHcmfTaE7MgdE1g-vjBKABDtcyACrR_st6eM9Wxm3eunBQ
2025-05-31 12:18:36,354 - AUTH - DEBUG -   hash: [hidden for security]
2025-05-31 12:18:36,354 - AUTH - DEBUG - Extracted hash value length: 64
2025-05-31 12:18:36,354 - AUTH - INFO - Verifying Telegram hash...
2025-05-31 12:18:36,355 - backend.auth - DEBUG - 
==================================================
2025-05-31 12:18:36,356 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 12:18:36,356 - backend.auth - DEBUG - ==================================================
2025-05-31 12:18:36,356 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 12:18:36,357 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 12:18:36,357 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TSM7RXz&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683108&signature=sMvpAb5dsah0ZpoySTQqFpEbrXlxvaIWFwhlFwusXHcmfTaE7MgdE1g-vjBKABDtcyACrR_st6eM9Wxm3eunBQ&hash=1c8f949305015f3d43c4d77933c08d475ab412f10995f08dce9efa459e179f1b'
2025-05-31 12:18:36,358 - backend.auth - DEBUG - received_hash: 1c8f949305015f3d43c4d77933c08d475ab412f10995f08dce9efa459e179f1b
2025-05-31 12:18:36,358 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TSM7RXz', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748683108', 'signature': 'sMvpAb5dsah0ZpoySTQqFpEbrXlxvaIWFwhlFwusXHcmfTaE7MgdE1g-vjBKABDtcyACrR_st6eM9Wxm3eunBQ'}
2025-05-31 12:18:36,359 - backend.auth - DEBUG - Hash from dictionary: 1c8f949305015f3d43c4d77933c08d475ab412f10995f08dce9efa459e179f1b
2025-05-31 12:18:36,359 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748683108
query_id=AAFreO00AAAAAGt47TSM7RXz
signature=sMvpAb5dsah0ZpoySTQqFpEbrXlxvaIWFwhlFwusXHcmfTaE7MgdE1g-vjBKABDtcyACrR_st6eM9Wxm3eunBQ
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 12:18:36,359 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 12:18:36,360 - backend.auth - DEBUG - Calculated hash: 1c8f949305015f3d43c4d77933c08d475ab412f10995f08dce9efa459e179f1b
2025-05-31 12:18:36,360 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 12:18:36,361 - backend.auth - DEBUG - ==================================================

2025-05-31 12:18:36,361 - AUTH - INFO - Hash verification successful
2025-05-31 12:18:36,361 - AUTH - INFO - Parsing user data...
2025-05-31 12:18:36,362 - AUTH - DEBUG - Raw user data length: 319
2025-05-31 12:18:36,362 - AUTH - DEBUG - URL-decoded user data length: 215
2025-05-31 12:18:36,362 - AUTH - DEBUG - Parsed user_info: ID=887978091, username=sar_a_to_v
2025-05-31 12:18:36,362 - AUTH - DEBUG - Converted telegram_id to int: 887978091 (type: <class 'int'>)
2025-05-31 12:18:36,362 - AUTH - INFO - Looking up user with telegram_id: 887978091
2025-05-31 12:18:36,362 - AUTH - INFO - Found existing user: sar_a_to_v (ID: 2, Telegram ID: 887978091)
2025-05-31 12:18:36,362 - AUTH - INFO - Updated avatar URL to: https://t.me/i/userpic/320/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg
2025-05-31 12:18:36,367 - AUTH - INFO - Creating JWT tokens for user: sar_a_to_v
2025-05-31 12:18:36,367 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-06-01 09:18:36.367262)
2025-05-31 12:18:36,367 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-06-01 09:18:36.367262)
2025-05-31 12:18:36,367 - AUTH - INFO - === Authentication Successful ===
2025-05-31 12:18:36,367 - AUTH - INFO - ********************************************************************************


2025-05-31 12:18:36,367 - AUTH - INFO - [a34783b8-6c0a-4ba1-8e52-4aa8740e2dc8] Response status: 200 - Completed in 0.0285s
2025-05-31 12:18:36,617 - AUTH - INFO - [3466c4bb-ccce-48ca-ab27-a3bc2879c396] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:18:36,619 - AUTH - ERROR - [3466c4bb-ccce-48ca-ab27-a3bc2879c396] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:18:36,620 - AUTH - ERROR - [3466c4bb-ccce-48ca-ab27-a3bc2879c396] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:18:36,621 - AUTH - ERROR - [3466c4bb-ccce-48ca-ab27-a3bc2879c396] Failed after 0.0018s
2025-05-31 12:18:36,622 - AUTH - ERROR - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:18:36,624 - AUTH - ERROR - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:18:39,290 - AUTH - INFO - [b4fe8d00-6003-4929-bad7-3d8bb54dbbbb] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:18:39,291 - AUTH - INFO - [ec6a467b-3ec5-445d-b203-2a70a2c877fd] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:18:39,291 - AUTH - INFO - [db619207-12ba-486a-8d84-2052290ad796] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:18:39,293 - AUTH - INFO - [41f9f09f-e425-4f72-8c5f-d40df6c86dc7] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:18:39,293 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:18:39,300 - AUTH - INFO - [b4fe8d00-6003-4929-bad7-3d8bb54dbbbb] Response status: 200 - Completed in 0.0103s
2025-05-31 12:18:39,301 - AUTH - INFO - [ec6a467b-3ec5-445d-b203-2a70a2c877fd] Response status: 200 - Completed in 0.0097s
2025-05-31 12:18:39,301 - AUTH - INFO - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:18:39,304 - AUTH - DEBUG - [GetTransactionPartners] Added partner_id 3 (from listing 11, user was creator)
2025-05-31 12:18:39,307 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:18:39,308 - AUTH - INFO - [41f9f09f-e425-4f72-8c5f-d40df6c86dc7] Response status: 200 - Completed in 0.0144s
2025-05-31 12:18:39,309 - AUTH - INFO - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:18:39,310 - AUTH - DEBUG - [GetTransactionPartners] Returning partner 1: ID=3, Username=en7ka
2025-05-31 12:18:39,312 - AUTH - INFO - [db619207-12ba-486a-8d84-2052290ad796] Response status: 200 - Completed in 0.0207s
2025-05-31 12:18:39,471 - AUTH - INFO - [a1af17c0-0514-4c93-a80c-96945acc5b29] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:18:39,472 - AUTH - INFO - [10d5fa31-5924-4990-9cee-4470c9d7680d] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:18:39,476 - AUTH - INFO - [a1af17c0-0514-4c93-a80c-96945acc5b29] Response status: 200 - Completed in 0.0042s
2025-05-31 12:18:39,476 - AUTH - INFO - [10d5fa31-5924-4990-9cee-4470c9d7680d] Response status: 200 - Completed in 0.0036s
2025-05-31 12:18:39,517 - AUTH - INFO - [213bd5d4-56e7-44c4-b98d-3d94148f3a59] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:18:39,518 - AUTH - INFO - [4ec0b2a7-7585-4436-88da-0bbe33d5d946] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:18:39,520 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:18:39,522 - AUTH - INFO - [4ec0b2a7-7585-4436-88da-0bbe33d5d946] Response status: 200 - Completed in 0.0036s
2025-05-31 12:18:39,523 - AUTH - INFO - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:18:39,523 - AUTH - DEBUG - [GetTransactionPartners] Added partner_id 3 (from listing 11, user was creator)
2025-05-31 12:18:39,524 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:18:39,526 - AUTH - INFO - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:18:39,526 - AUTH - DEBUG - [GetTransactionPartners] Returning partner 1: ID=3, Username=en7ka
2025-05-31 12:18:39,527 - AUTH - INFO - [213bd5d4-56e7-44c4-b98d-3d94148f3a59] Response status: 200 - Completed in 0.0098s
2025-05-31 12:19:01,021 - AUTH - INFO - [1943f22f-37ce-48e0-bf4d-81f9b15fd250] Request from 77.91.101.132:0 - GET /users/search/
2025-05-31 12:19:01,023 - AUTH - INFO - [1943f22f-37ce-48e0-bf4d-81f9b15fd250] Query params: {'username': 'en7ka'}
2025-05-31 12:19:01,030 - AUTH - INFO - [1943f22f-37ce-48e0-bf4d-81f9b15fd250] Response status: 200 - Completed in 0.0066s
2025-05-31 12:19:04,821 - AUTH - INFO - [bbab433a-72cb-42ab-af7c-653f250e274c] Request from 77.91.101.132:0 - POST /friends/request/
2025-05-31 12:19:04,822 - AUTH - INFO - [bbab433a-72cb-42ab-af7c-653f250e274c] Request body for POST will be processed by endpoint.
2025-05-31 12:19:04,843 - AUTH - INFO - [bbab433a-72cb-42ab-af7c-653f250e274c] Response status: 200 - Completed in 0.0199s
2025-05-31 12:19:05,060 - AUTH - INFO - [73d88e35-254b-487e-878a-7ccfdf2d1891] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:19:05,065 - AUTH - INFO - [73d88e35-254b-487e-878a-7ccfdf2d1891] Response status: 200 - Completed in 0.0039s
2025-05-31 12:19:06,098 - AUTH - INFO - [6bc5ce8a-289b-46ce-9bc1-d3d6d8d58b33] Request from 77.91.101.132:0 - POST /friends/request/
2025-05-31 12:19:06,099 - AUTH - INFO - [6bc5ce8a-289b-46ce-9bc1-d3d6d8d58b33] Request body for POST will be processed by endpoint.
2025-05-31 12:19:06,103 - AUTH - ERROR - HTTP exception: 400 - Friend request already exists
2025-05-31 12:19:06,104 - AUTH - INFO - [6bc5ce8a-289b-46ce-9bc1-d3d6d8d58b33] Response status: 400 - Completed in 0.0043s
2025-05-31 12:19:16,763 - AUTH - INFO - [4c4e4100-063d-4355-a170-0e61c362dfca] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:19:16,766 - AUTH - INFO - [4c4e4100-063d-4355-a170-0e61c362dfca] Response status: 200 - Completed in 0.0017s
2025-05-31 12:19:16,965 - AUTH - INFO - [8eff9db0-d3ff-4809-80b7-d7291d272521] Request from 77.91.101.132:0 - GET /user/me/
2025-05-31 12:19:16,967 - AUTH - DEBUG - [GetUserMe] Attempting to get current user.
2025-05-31 12:19:16,968 - AUTH - ERROR - [8eff9db0-d3ff-4809-80b7-d7291d272521] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:19:16,969 - AUTH - ERROR - [8eff9db0-d3ff-4809-80b7-d7291d272521] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:19:16,971 - AUTH - ERROR - [8eff9db0-d3ff-4809-80b7-d7291d272521] Failed after 0.0021s
2025-05-31 12:19:16,972 - AUTH - ERROR - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:19:16,976 - AUTH - ERROR - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:19:17,404 - AUTH - INFO - [b3e5a093-4a55-4ac1-a430-f47f1ca25cd6] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:19:17,406 - AUTH - INFO - [b3e5a093-4a55-4ac1-a430-f47f1ca25cd6] Request body for POST will be processed by endpoint.
2025-05-31 12:19:17,408 - AUTH - INFO - 

********************************************************************************
2025-05-31 12:19:17,408 - AUTH - INFO - === Starting Telegram Authentication ===
2025-05-31 12:19:17,409 - AUTH - INFO - ********************************************************************************
2025-05-31 12:19:17,409 - AUTH - DEBUG - Request headers:
2025-05-31 12:19:17,410 - AUTH - DEBUG -   x-forwarded-proto: https
2025-05-31 12:19:17,410 - AUTH - DEBUG -   x-forwarded-host: 0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:19:17,410 - AUTH - DEBUG -   x-forwarded-for: 77.91.101.132
2025-05-31 12:19:17,410 - AUTH - DEBUG -   sec-fetch-site: same-origin
2025-05-31 12:19:17,410 - AUTH - DEBUG -   sec-fetch-mode: cors
2025-05-31 12:19:17,410 - AUTH - DEBUG -   sec-fetch-dest: empty
2025-05-31 12:19:17,414 - AUTH - DEBUG -   sec-ch-ua-platform: "Windows"
2025-05-31 12:19:17,414 - AUTH - DEBUG -   sec-ch-ua-mobile: ?0
2025-05-31 12:19:17,414 - AUTH - DEBUG -   sec-ch-ua: "Microsoft Edge";v="136", "Microsoft Edge WebView2";v="136", "Not.A/Brand";v="99", "Chromium";v="136"
2025-05-31 12:19:17,415 - AUTH - DEBUG -   referer: https://0e4c-77-91-101-132.ngrok-free.app/
2025-05-31 12:19:17,416 - AUTH - DEBUG -   priority: u=1, i
2025-05-31 12:19:17,416 - AUTH - DEBUG -   origin: https://0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:19:17,417 - AUTH - DEBUG -   cookie: abuse_interstitial=0e4c-77-91-101-132.ngrok-free.app; access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidGVsZWdyYW1faWQiOiI4ODc5NzgwOTEiLCJ1c2VybmFtZSI6InNhcl9hX3RvX3YiLCJ0eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQ4NzY5NTE2fQ.ckZGq7ceFX57HZFe3-u-iMtLz2HhS9nnYkUAEe5jLj4; refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidGVsZWdyYW1faWQiOiI4ODc5NzgwOTEiLCJ1c2VybmFtZSI6InNhcl9hX3RvX3YiLCJ0eXBlIjoicmVmcmVzaCIsImV4cCI6MTc0ODc2OTUxNn0.pHeVZu8IsSNh5Yh42B1NmpUQ9KymbPVjcJr5S0Ddmac
2025-05-31 12:19:17,417 - AUTH - DEBUG -   content-type: application/json
2025-05-31 12:19:17,418 - AUTH - DEBUG -   accept-language: ru,en;q=0.9,en-GB;q=0.8,en-US;q=0.7
2025-05-31 12:19:17,418 - AUTH - DEBUG -   accept-encoding: gzip, deflate, br, zstd
2025-05-31 12:19:17,419 - AUTH - DEBUG -   accept: application/json, text/plain, */*
2025-05-31 12:19:17,419 - AUTH - DEBUG -   content-length: 580
2025-05-31 12:19:17,420 - AUTH - DEBUG -   user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0
2025-05-31 12:19:17,420 - AUTH - DEBUG -   host: localhost:8000
2025-05-31 12:19:17,421 - AUTH - DEBUG -   connection: close
2025-05-31 12:19:17,422 - AUTH - DEBUG - Request method: POST
2025-05-31 12:19:17,422 - AUTH - DEBUG - POST request to /auth/telegram. Processing body...
2025-05-31 12:19:17,422 - AUTH - DEBUG - Attempt 1: Reading entire request body for POST with timeout...
2025-05-31 12:19:17,423 - AUTH - INFO - Successfully read entire body (POST), length: 580
2025-05-31 12:19:17,424 - AUTH - DEBUG - Raw request body (POST): {"init_data":"query_id=AAFreO00AAAAAGt47TTvvLBb&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683152&signature=kVucjJkZPL8lWqgRiSvf406_ig962pK9uu3AAoCJZsx67yRdCSfGKS7NEqL9IJknzja5mPuDZyGB8H0NcIgTAg&hash=12c5...
2025-05-31 12:19:17,425 - AUTH - DEBUG - Parsed JSON data: {'init_data': 'query_id=AAFreO00AAAAAGt47TTvvLBb&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683152&signature=kVucjJkZPL8lWqgRiSvf406_ig962pK9uu3AAoCJZsx67yRdCSfGKS7NEqL9IJknzja5mPuDZyGB8H0NcIgTAg&hash=12c559471345bea78e6eed9c3ce4c9f5c7b59a00b97d4ca74ded344c63009e41', 'test_mode': False}
2025-05-31 12:19:17,426 - AUTH - INFO - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:19:17,426 - AUTH - DEBUG - Raw init_data: query_id=AAFreO00AAAAAGt47TTvvLBb&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683152&signature=kVucjJkZPL8lWqgRiSvf406_ig962pK9uu3AAoCJZsx67yRdCSfGKS7NEqL9IJknzja5mPuDZyGB8H0NcIgTAg&hash=12c559471345bea78e6eed9c3ce4c9f5c7b59a00b97d4ca74ded344c63009e41
2025-05-31 12:19:17,426 - AUTH - DEBUG - Parsed data parameters count: 5
2025-05-31 12:19:17,426 - AUTH - DEBUG -   query_id: AAFreO00AAAAAGt47TTvvLBb
2025-05-31 12:19:17,426 - AUTH - DEBUG -   user: [hidden for security]
2025-05-31 12:19:17,426 - AUTH - DEBUG -   auth_date: 1748683152
2025-05-31 12:19:17,426 - AUTH - DEBUG -   signature: kVucjJkZPL8lWqgRiSvf406_ig962pK9uu3AAoCJZsx67yRdCSfGKS7NEqL9IJknzja5mPuDZyGB8H0NcIgTAg
2025-05-31 12:19:17,426 - AUTH - DEBUG -   hash: [hidden for security]
2025-05-31 12:19:17,426 - AUTH - DEBUG - Extracted hash value length: 64
2025-05-31 12:19:17,426 - AUTH - INFO - Verifying Telegram hash...
2025-05-31 12:19:17,426 - backend.auth - DEBUG - 
==================================================
2025-05-31 12:19:17,426 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 12:19:17,426 - backend.auth - DEBUG - ==================================================
2025-05-31 12:19:17,426 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 12:19:17,426 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 12:19:17,426 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TTvvLBb&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683152&signature=kVucjJkZPL8lWqgRiSvf406_ig962pK9uu3AAoCJZsx67yRdCSfGKS7NEqL9IJknzja5mPuDZyGB8H0NcIgTAg&hash=12c559471345bea78e6eed9c3ce4c9f5c7b59a00b97d4ca74ded344c63009e41'
2025-05-31 12:19:17,426 - backend.auth - DEBUG - received_hash: 12c559471345bea78e6eed9c3ce4c9f5c7b59a00b97d4ca74ded344c63009e41
2025-05-31 12:19:17,426 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TTvvLBb', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748683152', 'signature': 'kVucjJkZPL8lWqgRiSvf406_ig962pK9uu3AAoCJZsx67yRdCSfGKS7NEqL9IJknzja5mPuDZyGB8H0NcIgTAg'}
2025-05-31 12:19:17,426 - backend.auth - DEBUG - Hash from dictionary: 12c559471345bea78e6eed9c3ce4c9f5c7b59a00b97d4ca74ded344c63009e41
2025-05-31 12:19:17,438 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748683152
query_id=AAFreO00AAAAAGt47TTvvLBb
signature=kVucjJkZPL8lWqgRiSvf406_ig962pK9uu3AAoCJZsx67yRdCSfGKS7NEqL9IJknzja5mPuDZyGB8H0NcIgTAg
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 12:19:17,438 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 12:19:17,439 - backend.auth - DEBUG - Calculated hash: 12c559471345bea78e6eed9c3ce4c9f5c7b59a00b97d4ca74ded344c63009e41
2025-05-31 12:19:17,439 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 12:19:17,439 - backend.auth - DEBUG - ==================================================

2025-05-31 12:19:17,439 - AUTH - INFO - Hash verification successful
2025-05-31 12:19:17,439 - AUTH - INFO - Parsing user data...
2025-05-31 12:19:17,439 - AUTH - DEBUG - Raw user data length: 319
2025-05-31 12:19:17,439 - AUTH - DEBUG - URL-decoded user data length: 215
2025-05-31 12:19:17,439 - AUTH - DEBUG - Parsed user_info: ID=887978091, username=sar_a_to_v
2025-05-31 12:19:17,439 - AUTH - DEBUG - Converted telegram_id to int: 887978091 (type: <class 'int'>)
2025-05-31 12:19:17,439 - AUTH - INFO - Looking up user with telegram_id: 887978091
2025-05-31 12:19:17,439 - AUTH - INFO - Found existing user: sar_a_to_v (ID: 2, Telegram ID: 887978091)
2025-05-31 12:19:17,439 - AUTH - INFO - Creating JWT tokens for user: sar_a_to_v
2025-05-31 12:19:17,439 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-06-01 09:19:17.439491)
2025-05-31 12:19:17,439 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-06-01 09:19:17.439491)
2025-05-31 12:19:17,439 - AUTH - INFO - === Authentication Successful ===
2025-05-31 12:19:17,439 - AUTH - INFO - ********************************************************************************


2025-05-31 12:19:17,439 - AUTH - INFO - [b3e5a093-4a55-4ac1-a430-f47f1ca25cd6] Response status: 200 - Completed in 0.0329s
2025-05-31 12:19:17,680 - AUTH - INFO - [25ca86cf-af46-4ec5-956a-558071b9a1d6] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:19:17,682 - AUTH - ERROR - [25ca86cf-af46-4ec5-956a-558071b9a1d6] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:19:17,686 - AUTH - ERROR - [25ca86cf-af46-4ec5-956a-558071b9a1d6] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:19:17,688 - AUTH - ERROR - [25ca86cf-af46-4ec5-956a-558071b9a1d6] Failed after 0.0017s
2025-05-31 12:19:17,689 - AUTH - ERROR - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:19:17,691 - AUTH - ERROR - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:19:19,864 - AUTH - INFO - [c3b80711-08da-4196-b3f7-b334561fa424] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:19:19,872 - AUTH - INFO - [14637f35-74d7-4c41-b241-e167c5810220] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:19:19,874 - AUTH - INFO - [c4a24266-55f7-47e1-9b7d-1b71618024ae] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:19:19,874 - AUTH - INFO - [2ce3cafc-2816-4ba8-a507-5726ded19b90] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:19:19,887 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:19:19,892 - AUTH - INFO - [c3b80711-08da-4196-b3f7-b334561fa424] Response status: 200 - Completed in 0.0204s
2025-05-31 12:19:19,892 - AUTH - INFO - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:19:19,892 - AUTH - DEBUG - [GetTransactionPartners] Added partner_id 3 (from listing 11, user was creator)
2025-05-31 12:19:19,900 - AUTH - INFO - [c4a24266-55f7-47e1-9b7d-1b71618024ae] Response status: 200 - Completed in 0.0259s
2025-05-31 12:19:19,900 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:19:19,904 - AUTH - INFO - [14637f35-74d7-4c41-b241-e167c5810220] Response status: 200 - Completed in 0.0298s
2025-05-31 12:19:19,904 - AUTH - INFO - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:19:19,906 - AUTH - DEBUG - [GetTransactionPartners] Returning partner 1: ID=3, Username=en7ka
2025-05-31 12:19:19,911 - AUTH - INFO - [2ce3cafc-2816-4ba8-a507-5726ded19b90] Response status: 200 - Completed in 0.0370s
2025-05-31 12:19:20,114 - AUTH - INFO - [65101505-2067-449a-b441-396d7d0c2c39] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:19:20,120 - AUTH - INFO - [65101505-2067-449a-b441-396d7d0c2c39] Response status: 200 - Completed in 0.0050s
2025-05-31 12:19:20,140 - AUTH - INFO - [d0c59ac8-72aa-4c2c-a83f-fd38c3707cc9] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:19:20,140 - AUTH - INFO - [bbb540a8-7fa2-4921-a711-d8f11d79e7f9] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:19:20,140 - AUTH - INFO - [6b3b99d9-a1be-4410-8f30-41b7916f48d2] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:19:20,147 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:19:20,147 - AUTH - INFO - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:19:20,156 - AUTH - INFO - [6b3b99d9-a1be-4410-8f30-41b7916f48d2] Response status: 200 - Completed in 0.0154s
2025-05-31 12:19:20,156 - AUTH - DEBUG - [GetTransactionPartners] Added partner_id 3 (from listing 11, user was creator)
2025-05-31 12:19:20,156 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:19:20,160 - AUTH - INFO - [bbb540a8-7fa2-4921-a711-d8f11d79e7f9] Response status: 200 - Completed in 0.0200s
2025-05-31 12:19:20,162 - AUTH - INFO - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:19:20,165 - AUTH - DEBUG - [GetTransactionPartners] Returning partner 1: ID=3, Username=en7ka
2025-05-31 12:19:20,167 - AUTH - INFO - [d0c59ac8-72aa-4c2c-a83f-fd38c3707cc9] Response status: 200 - Completed in 0.0277s
2025-05-31 12:19:26,722 - AUTH - INFO - [2a5c66dc-9b44-4901-827e-39a2ea8c688c] Request from 77.91.101.132:0 - POST /friends/request/
2025-05-31 12:19:26,722 - AUTH - INFO - [2a5c66dc-9b44-4901-827e-39a2ea8c688c] Request body for POST will be processed by endpoint.
2025-05-31 12:19:26,726 - AUTH - ERROR - HTTP exception: 400 - Friend request already exists
2025-05-31 12:19:26,727 - AUTH - INFO - [2a5c66dc-9b44-4901-827e-39a2ea8c688c] Response status: 400 - Completed in 0.0041s
2025-05-31 12:19:28,559 - AUTH - INFO - [304a1b1a-3c06-4992-be6a-538b28dd107d] Request from 77.91.101.132:0 - POST /friends/request/
2025-05-31 12:19:28,560 - AUTH - INFO - [304a1b1a-3c06-4992-be6a-538b28dd107d] Request body for POST will be processed by endpoint.
2025-05-31 12:19:28,564 - AUTH - ERROR - HTTP exception: 400 - Friend request already exists
2025-05-31 12:19:28,565 - AUTH - INFO - [304a1b1a-3c06-4992-be6a-538b28dd107d] Response status: 400 - Completed in 0.0044s
2025-05-31 12:19:35,701 - AUTH - INFO - [672529af-ec0e-4ede-9d89-bbc5d82744ee] Request from 77.91.101.132:0 - POST /listings/8/accept/
2025-05-31 12:19:35,703 - AUTH - INFO - [672529af-ec0e-4ede-9d89-bbc5d82744ee] Request body for POST will be processed by endpoint.
2025-05-31 12:19:35,727 - AUTH - INFO - [672529af-ec0e-4ede-9d89-bbc5d82744ee] Response status: 200 - Completed in 0.0241s
2025-05-31 12:19:40,813 - AUTH - INFO - [bb00678d-406f-4c4c-9303-ae789c16d4d6] Request from 77.91.101.132:0 - POST /friends/request/
2025-05-31 12:19:40,814 - AUTH - INFO - [bb00678d-406f-4c4c-9303-ae789c16d4d6] Request body for POST will be processed by endpoint.
2025-05-31 12:19:40,817 - AUTH - ERROR - HTTP exception: 400 - Friend request already exists
2025-05-31 12:19:40,817 - AUTH - INFO - [bb00678d-406f-4c4c-9303-ae789c16d4d6] Response status: 400 - Completed in 0.0032s
2025-05-31 12:21:15,292 - AUTH - INFO - [93ec43e5-a491-482e-870c-05f57d7be617] Request from 5.35.38.40:0 - GET /auth/protected/
2025-05-31 12:21:15,295 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:21:15,296 - AUTH - INFO - [93ec43e5-a491-482e-870c-05f57d7be617] Response status: 401 - Completed in 0.0027s
2025-05-31 12:21:15,697 - AUTH - INFO - [6a4ef3b7-8732-4c15-9007-7f015636c6ad] Request from 5.35.38.40:0 - POST /auth/telegram/
2025-05-31 12:21:15,698 - AUTH - INFO - [6a4ef3b7-8732-4c15-9007-7f015636c6ad] Request body for POST will be processed by endpoint.
2025-05-31 12:21:15,699 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:21:15,700 - AUTH - INFO - [6a4ef3b7-8732-4c15-9007-7f015636c6ad] Response status: 401 - Completed in 0.0022s
2025-05-31 12:21:16,774 - AUTH - INFO - [06d34788-ec4c-4d1a-8172-f2990c06b065] Request from 5.35.38.40:0 - POST /auth/telegram/
2025-05-31 12:21:16,775 - AUTH - INFO - [06d34788-ec4c-4d1a-8172-f2990c06b065] Request body for POST will be processed by endpoint.
2025-05-31 12:21:16,778 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:21:16,778 - AUTH - INFO - [06d34788-ec4c-4d1a-8172-f2990c06b065] Response status: 401 - Completed in 0.0022s
2025-05-31 12:21:17,195 - AUTH - INFO - [af7b3b37-fad5-4c57-b802-b404a0fdd862] Request from 5.35.38.40:0 - POST /debug/auth/
2025-05-31 12:21:17,196 - AUTH - INFO - [af7b3b37-fad5-4c57-b802-b404a0fdd862] Request body for POST will be processed by endpoint.
2025-05-31 12:21:17,198 - AUTH - WARNING - 

********************************************************************************
2025-05-31 12:21:17,199 - AUTH - WARNING - === Starting Debug Auth POST ===
2025-05-31 12:21:17,199 - AUTH - WARNING - ********************************************************************************
2025-05-31 12:21:17,200 - AUTH - DEBUG - Attempting to read request body for /debug/auth POST...
2025-05-31 12:21:17,201 - AUTH - INFO - Successfully read body for /debug/auth POST, length: 44
2025-05-31 12:21:17,201 - AUTH - DEBUG - Raw request body for /debug/auth POST: {"telegram_id":12345,"username":"test_user"}...
2025-05-31 12:21:17,202 - AUTH - DEBUG - Parsed JSON data for /debug/auth POST: {'telegram_id': 12345, 'username': 'test_user'}
2025-05-31 12:21:17,202 - AUTH - WARNING - Creating/fetching test user for /debug/auth: telegram_id=12345, username=test_user
2025-05-31 12:21:17,203 - AUTH - WARNING - User 12345 found in database, using existing user
2025-05-31 12:21:17,203 - backend.auth - DEBUG - JWT created for None (exp 2025-06-01 09:21:17.203775)
2025-05-31 12:21:17,203 - backend.auth - DEBUG - JWT created for test_user (exp 2025-06-01 09:21:17.203775)
2025-05-31 12:21:17,203 - AUTH - INFO - [af7b3b37-fad5-4c57-b802-b404a0fdd862] Response status: 200 - Completed in 0.0070s
2025-05-31 12:21:21,309 - AUTH - INFO - [2e50e485-cb4a-4d53-a94c-d7459be22d4e] Request from 5.35.38.40:0 - GET /listings/
2025-05-31 12:21:21,311 - AUTH - ERROR - [2e50e485-cb4a-4d53-a94c-d7459be22d4e] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:21:21,314 - AUTH - ERROR - [2e50e485-cb4a-4d53-a94c-d7459be22d4e] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:21:21,315 - AUTH - ERROR - [2e50e485-cb4a-4d53-a94c-d7459be22d4e] Failed after 0.0016s
2025-05-31 12:21:21,315 - AUTH - ERROR - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:21:21,320 - AUTH - ERROR - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:22:53,810 - AUTH - INFO - [90982f29-c422-44dc-8e2b-1d7ee3acf8b7] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:22:53,812 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:22:53,813 - AUTH - INFO - [90982f29-c422-44dc-8e2b-1d7ee3acf8b7] Response status: 401 - Completed in 0.0028s
2025-05-31 12:22:54,196 - AUTH - INFO - [6f9ff956-95b5-48d9-8f8e-63f8524a10d1] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:22:54,198 - AUTH - INFO - [6f9ff956-95b5-48d9-8f8e-63f8524a10d1] Request body for POST will be processed by endpoint.
2025-05-31 12:22:54,200 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:22:54,200 - AUTH - INFO - [6f9ff956-95b5-48d9-8f8e-63f8524a10d1] Response status: 401 - Completed in 0.0022s
2025-05-31 12:22:54,632 - AUTH - INFO - [99ccf10f-dd7c-40e2-8ec1-878f4358d0e0] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:22:54,633 - AUTH - INFO - [99ccf10f-dd7c-40e2-8ec1-878f4358d0e0] Request body for POST will be processed by endpoint.
2025-05-31 12:22:54,636 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:22:54,636 - AUTH - INFO - [99ccf10f-dd7c-40e2-8ec1-878f4358d0e0] Response status: 401 - Completed in 0.0024s
2025-05-31 12:22:55,013 - AUTH - INFO - [d6f3d70f-486f-4da4-aa1d-02346488f7bc] Request from 77.91.101.132:0 - POST /debug/auth/
2025-05-31 12:22:55,014 - AUTH - INFO - [d6f3d70f-486f-4da4-aa1d-02346488f7bc] Request body for POST will be processed by endpoint.
2025-05-31 12:22:55,015 - AUTH - WARNING - 

********************************************************************************
2025-05-31 12:22:55,016 - AUTH - WARNING - === Starting Debug Auth POST ===
2025-05-31 12:22:55,016 - AUTH - WARNING - ********************************************************************************
2025-05-31 12:22:55,017 - AUTH - DEBUG - Attempting to read request body for /debug/auth POST...
2025-05-31 12:22:55,017 - AUTH - INFO - Successfully read body for /debug/auth POST, length: 44
2025-05-31 12:22:55,017 - AUTH - DEBUG - Raw request body for /debug/auth POST: {"telegram_id":12345,"username":"test_user"}...
2025-05-31 12:22:55,017 - AUTH - DEBUG - Parsed JSON data for /debug/auth POST: {'telegram_id': 12345, 'username': 'test_user'}
2025-05-31 12:22:55,017 - AUTH - WARNING - Creating/fetching test user for /debug/auth: telegram_id=12345, username=test_user
2025-05-31 12:22:55,017 - AUTH - WARNING - User 12345 found in database, using existing user
2025-05-31 12:22:55,017 - backend.auth - DEBUG - JWT created for None (exp 2025-06-01 09:22:55.017737)
2025-05-31 12:22:55,021 - backend.auth - DEBUG - JWT created for test_user (exp 2025-06-01 09:22:55.021501)
2025-05-31 12:22:55,021 - AUTH - INFO - [d6f3d70f-486f-4da4-aa1d-02346488f7bc] Response status: 200 - Completed in 0.0064s
2025-05-31 12:22:57,046 - AUTH - INFO - [1341a3d2-d790-4563-b645-8361b65bf0aa] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:22:57,049 - AUTH - ERROR - [1341a3d2-d790-4563-b645-8361b65bf0aa] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:22:57,050 - AUTH - ERROR - [1341a3d2-d790-4563-b645-8361b65bf0aa] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:22:57,051 - AUTH - ERROR - [1341a3d2-d790-4563-b645-8361b65bf0aa] Failed after 0.0017s
2025-05-31 12:22:57,053 - AUTH - ERROR - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:22:57,056 - AUTH - ERROR - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:22:58,294 - AUTH - INFO - [78c0e03e-af28-406f-ac4c-6be51540f0e0] Request from 77.91.101.132:0 - GET /listings/user/1/
2025-05-31 12:22:58,297 - AUTH - INFO - [ce7c206e-ced3-4757-a4e4-5e2576ba0dd0] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:22:58,301 - AUTH - INFO - [ce7c206e-ced3-4757-a4e4-5e2576ba0dd0] Response status: 200 - Completed in 0.0043s
2025-05-31 12:22:58,306 - AUTH - INFO - [78c0e03e-af28-406f-ac4c-6be51540f0e0] Response status: 200 - Completed in 0.0105s
2025-05-31 12:22:58,318 - AUTH - INFO - [56093740-981d-4f5a-8506-8677faf51f61] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:22:58,323 - AUTH - INFO - [56093740-981d-4f5a-8506-8677faf51f61] Response status: 200 - Completed in 0.0045s
2025-05-31 12:22:58,353 - AUTH - INFO - [02ab9595-9448-4e41-971f-d3904bd986dc] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:22:58,356 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 1
2025-05-31 12:22:58,358 - AUTH - INFO - [GetTransactionPartners] Found 0 completed listings involving user 1
2025-05-31 12:22:58,358 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:22:58,358 - AUTH - INFO - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:22:58,358 - AUTH - INFO - [02ab9595-9448-4e41-971f-d3904bd986dc] Response status: 200 - Completed in 0.0039s
2025-05-31 12:22:58,507 - AUTH - INFO - [7ded179c-0507-41ac-be86-77d2417c37dc] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:22:58,508 - AUTH - INFO - [049caa85-092c-49fd-bd29-e46798f46132] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:22:58,509 - AUTH - INFO - [620998cb-16bc-48af-959f-2b89bbdf12c3] Request from 77.91.101.132:0 - GET /listings/user/1/
2025-05-31 12:22:58,516 - AUTH - INFO - [049caa85-092c-49fd-bd29-e46798f46132] Response status: 200 - Completed in 0.0070s
2025-05-31 12:22:58,516 - AUTH - INFO - [7ded179c-0507-41ac-be86-77d2417c37dc] Response status: 200 - Completed in 0.0076s
2025-05-31 12:22:58,523 - AUTH - INFO - [620998cb-16bc-48af-959f-2b89bbdf12c3] Response status: 200 - Completed in 0.0139s
2025-05-31 12:22:58,534 - AUTH - INFO - [26db709e-96ca-49a2-b02d-380169735d6b] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:22:58,536 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 1
2025-05-31 12:22:58,538 - AUTH - INFO - [GetTransactionPartners] Found 0 completed listings involving user 1
2025-05-31 12:22:58,538 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:22:58,538 - AUTH - INFO - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:22:58,538 - AUTH - INFO - [26db709e-96ca-49a2-b02d-380169735d6b] Response status: 200 - Completed in 0.0033s
2025-05-31 12:23:19,726 - AUTH - INFO - [b01c4f11-545b-42ea-96b0-32ff935e003f] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:23:19,728 - AUTH - INFO - [b01c4f11-545b-42ea-96b0-32ff935e003f] Response status: 200 - Completed in 0.0017s
2025-05-31 12:23:19,947 - AUTH - INFO - [e7e746d0-248d-48fb-88da-ea2c2f68e3e3] Request from 77.91.101.132:0 - GET /user/me/
2025-05-31 12:23:19,948 - AUTH - DEBUG - [GetUserMe] Attempting to get current user.
2025-05-31 12:23:19,949 - AUTH - ERROR - [e7e746d0-248d-48fb-88da-ea2c2f68e3e3] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:23:19,952 - AUTH - ERROR - [e7e746d0-248d-48fb-88da-ea2c2f68e3e3] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:23:19,954 - AUTH - ERROR - [e7e746d0-248d-48fb-88da-ea2c2f68e3e3] Failed after 0.0016s
2025-05-31 12:23:19,954 - AUTH - ERROR - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:23:19,956 - AUTH - ERROR - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:23:20,412 - AUTH - INFO - [fb206b74-6cfc-4345-bd10-9edaf0e75da4] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:23:20,413 - AUTH - INFO - [fb206b74-6cfc-4345-bd10-9edaf0e75da4] Request body for POST will be processed by endpoint.
2025-05-31 12:23:20,415 - AUTH - INFO - 

********************************************************************************
2025-05-31 12:23:20,416 - AUTH - INFO - === Starting Telegram Authentication ===
2025-05-31 12:23:20,417 - AUTH - INFO - ********************************************************************************
2025-05-31 12:23:20,418 - AUTH - DEBUG - Request headers:
2025-05-31 12:23:20,418 - AUTH - DEBUG -   x-forwarded-proto: https
2025-05-31 12:23:20,418 - AUTH - DEBUG -   x-forwarded-host: 0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:23:20,418 - AUTH - DEBUG -   x-forwarded-for: 77.91.101.132
2025-05-31 12:23:20,420 - AUTH - DEBUG -   sec-fetch-site: same-origin
2025-05-31 12:23:20,420 - AUTH - DEBUG -   sec-fetch-mode: cors
2025-05-31 12:23:20,420 - AUTH - DEBUG -   sec-fetch-dest: empty
2025-05-31 12:23:20,420 - AUTH - DEBUG -   sec-ch-ua-platform: "Windows"
2025-05-31 12:23:20,420 - AUTH - DEBUG -   sec-ch-ua-mobile: ?0
2025-05-31 12:23:20,422 - AUTH - DEBUG -   sec-ch-ua: "Microsoft Edge";v="136", "Microsoft Edge WebView2";v="136", "Not.A/Brand";v="99", "Chromium";v="136"
2025-05-31 12:23:20,422 - AUTH - DEBUG -   referer: https://0e4c-77-91-101-132.ngrok-free.app/
2025-05-31 12:23:20,422 - AUTH - DEBUG -   priority: u=1, i
2025-05-31 12:23:20,422 - AUTH - DEBUG -   origin: https://0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:23:20,422 - AUTH - DEBUG -   cookie: abuse_interstitial=0e4c-77-91-101-132.ngrok-free.app; access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidGVsZWdyYW1faWQiOiI4ODc5NzgwOTEiLCJ1c2VybmFtZSI6InNhcl9hX3RvX3YiLCJ0eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQ4NzY5NTU3fQ.Uac1YMz1cMhcncDtrLpwabhzFLO8h0c84VF2FzFOIsg; refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidGVsZWdyYW1faWQiOiI4ODc5NzgwOTEiLCJ1c2VybmFtZSI6InNhcl9hX3RvX3YiLCJ0eXBlIjoicmVmcmVzaCIsImV4cCI6MTc0ODc2OTU1N30.twsMWVuJc3mvlcP0GjPh5Grfpazjf5AXT02Q7CWTGtI
2025-05-31 12:23:20,424 - AUTH - DEBUG -   content-type: application/json
2025-05-31 12:23:20,424 - AUTH - DEBUG -   accept-language: ru,en;q=0.9,en-GB;q=0.8,en-US;q=0.7
2025-05-31 12:23:20,424 - AUTH - DEBUG -   accept-encoding: gzip, deflate, br, zstd
2025-05-31 12:23:20,424 - AUTH - DEBUG -   accept: application/json, text/plain, */*
2025-05-31 12:23:20,425 - AUTH - DEBUG -   content-length: 580
2025-05-31 12:23:20,426 - AUTH - DEBUG -   user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0
2025-05-31 12:23:20,426 - AUTH - DEBUG -   host: localhost:8000
2025-05-31 12:23:20,427 - AUTH - DEBUG -   connection: close
2025-05-31 12:23:20,427 - AUTH - DEBUG - Request method: POST
2025-05-31 12:23:20,427 - AUTH - DEBUG - POST request to /auth/telegram. Processing body...
2025-05-31 12:23:20,427 - AUTH - DEBUG - Attempt 1: Reading entire request body for POST with timeout...
2025-05-31 12:23:20,427 - AUTH - INFO - Successfully read entire body (POST), length: 580
2025-05-31 12:23:20,427 - AUTH - DEBUG - Raw request body (POST): {"init_data":"query_id=AAFreO00AAAAAGt47TQ1YxTW&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683395&signature=v3Z50EDT1qnnZnJZQRKg6-KAUp-2kJkP8JkoqXrvfJJL6taxoWt1bu5WXEZnfZBYRDI2bXi-N3O699LTFmEBCw&hash=a984...
2025-05-31 12:23:20,427 - AUTH - DEBUG - Parsed JSON data: {'init_data': 'query_id=AAFreO00AAAAAGt47TQ1YxTW&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683395&signature=v3Z50EDT1qnnZnJZQRKg6-KAUp-2kJkP8JkoqXrvfJJL6taxoWt1bu5WXEZnfZBYRDI2bXi-N3O699LTFmEBCw&hash=a984f43cb475f3cbd622ef8586384f7252d4c7bbfced561a64a8e9362256149d', 'test_mode': False}
2025-05-31 12:23:20,427 - AUTH - INFO - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:23:20,427 - AUTH - DEBUG - Raw init_data: query_id=AAFreO00AAAAAGt47TQ1YxTW&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683395&signature=v3Z50EDT1qnnZnJZQRKg6-KAUp-2kJkP8JkoqXrvfJJL6taxoWt1bu5WXEZnfZBYRDI2bXi-N3O699LTFmEBCw&hash=a984f43cb475f3cbd622ef8586384f7252d4c7bbfced561a64a8e9362256149d
2025-05-31 12:23:20,427 - AUTH - DEBUG - Parsed data parameters count: 5
2025-05-31 12:23:20,427 - AUTH - DEBUG -   query_id: AAFreO00AAAAAGt47TQ1YxTW
2025-05-31 12:23:20,427 - AUTH - DEBUG -   user: [hidden for security]
2025-05-31 12:23:20,427 - AUTH - DEBUG -   auth_date: 1748683395
2025-05-31 12:23:20,427 - AUTH - DEBUG -   signature: v3Z50EDT1qnnZnJZQRKg6-KAUp-2kJkP8JkoqXrvfJJL6taxoWt1bu5WXEZnfZBYRDI2bXi-N3O699LTFmEBCw
2025-05-31 12:23:20,427 - AUTH - DEBUG -   hash: [hidden for security]
2025-05-31 12:23:20,427 - AUTH - DEBUG - Extracted hash value length: 64
2025-05-31 12:23:20,435 - AUTH - INFO - Verifying Telegram hash...
2025-05-31 12:23:20,435 - backend.auth - DEBUG - 
==================================================
2025-05-31 12:23:20,435 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 12:23:20,435 - backend.auth - DEBUG - ==================================================
2025-05-31 12:23:20,435 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 12:23:20,435 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 12:23:20,438 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TQ1YxTW&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683395&signature=v3Z50EDT1qnnZnJZQRKg6-KAUp-2kJkP8JkoqXrvfJJL6taxoWt1bu5WXEZnfZBYRDI2bXi-N3O699LTFmEBCw&hash=a984f43cb475f3cbd622ef8586384f7252d4c7bbfced561a64a8e9362256149d'
2025-05-31 12:23:20,438 - backend.auth - DEBUG - received_hash: a984f43cb475f3cbd622ef8586384f7252d4c7bbfced561a64a8e9362256149d
2025-05-31 12:23:20,438 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TQ1YxTW', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748683395', 'signature': 'v3Z50EDT1qnnZnJZQRKg6-KAUp-2kJkP8JkoqXrvfJJL6taxoWt1bu5WXEZnfZBYRDI2bXi-N3O699LTFmEBCw'}
2025-05-31 12:23:20,438 - backend.auth - DEBUG - Hash from dictionary: a984f43cb475f3cbd622ef8586384f7252d4c7bbfced561a64a8e9362256149d
2025-05-31 12:23:20,438 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748683395
query_id=AAFreO00AAAAAGt47TQ1YxTW
signature=v3Z50EDT1qnnZnJZQRKg6-KAUp-2kJkP8JkoqXrvfJJL6taxoWt1bu5WXEZnfZBYRDI2bXi-N3O699LTFmEBCw
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 12:23:20,438 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 12:23:20,438 - backend.auth - DEBUG - Calculated hash: a984f43cb475f3cbd622ef8586384f7252d4c7bbfced561a64a8e9362256149d
2025-05-31 12:23:20,438 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 12:23:20,438 - backend.auth - DEBUG - ==================================================

2025-05-31 12:23:20,438 - AUTH - INFO - Hash verification successful
2025-05-31 12:23:20,438 - AUTH - INFO - Parsing user data...
2025-05-31 12:23:20,438 - AUTH - DEBUG - Raw user data length: 319
2025-05-31 12:23:20,438 - AUTH - DEBUG - URL-decoded user data length: 215
2025-05-31 12:23:20,438 - AUTH - DEBUG - Parsed user_info: ID=887978091, username=sar_a_to_v
2025-05-31 12:23:20,438 - AUTH - DEBUG - Converted telegram_id to int: 887978091 (type: <class 'int'>)
2025-05-31 12:23:20,438 - AUTH - INFO - Looking up user with telegram_id: 887978091
2025-05-31 12:23:20,446 - AUTH - INFO - Found existing user: sar_a_to_v (ID: 2, Telegram ID: 887978091)
2025-05-31 12:23:20,446 - AUTH - INFO - Creating JWT tokens for user: sar_a_to_v
2025-05-31 12:23:20,448 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-06-01 09:23:20.448953)
2025-05-31 12:23:20,448 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-06-01 09:23:20.448953)
2025-05-31 12:23:20,450 - AUTH - INFO - === Authentication Successful ===
2025-05-31 12:23:20,451 - AUTH - INFO - ********************************************************************************


2025-05-31 12:23:20,452 - AUTH - INFO - [fb206b74-6cfc-4345-bd10-9edaf0e75da4] Response status: 200 - Completed in 0.0383s
2025-05-31 12:23:20,730 - AUTH - INFO - [65bbb3bf-ee54-45be-8888-4915dc000230] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:23:20,734 - AUTH - ERROR - [65bbb3bf-ee54-45be-8888-4915dc000230] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:23:20,736 - AUTH - ERROR - [65bbb3bf-ee54-45be-8888-4915dc000230] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:23:20,737 - AUTH - ERROR - [65bbb3bf-ee54-45be-8888-4915dc000230] Failed after 0.0027s
2025-05-31 12:23:20,738 - AUTH - ERROR - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:23:20,741 - AUTH - ERROR - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 406, in get_listings
    get_current_user(request, db)
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:23:23,395 - AUTH - INFO - [8fb0d098-04a2-4671-90ed-d704671dffc9] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:23:23,402 - AUTH - INFO - [8fb0d098-04a2-4671-90ed-d704671dffc9] Response status: 200 - Completed in 0.0058s
2025-05-31 12:23:23,490 - AUTH - INFO - [92176884-e860-415f-a93a-bbec1f187902] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:23:23,493 - AUTH - INFO - [baf14adb-b8b4-4d77-8e1b-12dd85fcbc74] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:23:23,493 - AUTH - INFO - [f2a9955e-dafa-4102-8d99-c8409ee54528] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:23:23,500 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:23:23,500 - AUTH - INFO - [92176884-e860-415f-a93a-bbec1f187902] Response status: 200 - Completed in 0.0081s
2025-05-31 12:23:23,504 - AUTH - INFO - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:23:23,507 - AUTH - INFO - [baf14adb-b8b4-4d77-8e1b-12dd85fcbc74] Response status: 200 - Completed in 0.0149s
2025-05-31 12:23:23,507 - AUTH - DEBUG - [GetTransactionPartners] Added partner_id 3 (from listing 11, user was creator)
2025-05-31 12:23:23,509 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:23:23,512 - AUTH - INFO - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:23:23,513 - AUTH - DEBUG - [GetTransactionPartners] Returning partner 1: ID=3, Username=en7ka
2025-05-31 12:23:23,514 - AUTH - INFO - [f2a9955e-dafa-4102-8d99-c8409ee54528] Response status: 200 - Completed in 0.0214s
2025-05-31 12:23:23,620 - AUTH - INFO - [f88e24cf-e826-4496-af0a-4834851dc55f] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:23:23,624 - AUTH - INFO - [f88e24cf-e826-4496-af0a-4834851dc55f] Response status: 200 - Completed in 0.0027s
2025-05-31 12:23:23,702 - AUTH - INFO - [f0f7aa7b-d41c-47e0-9252-f425ccacec39] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:23:23,706 - AUTH - INFO - [f0f7aa7b-d41c-47e0-9252-f425ccacec39] Response status: 200 - Completed in 0.0033s
2025-05-31 12:23:23,719 - AUTH - INFO - [4421abd2-8060-4f66-93b8-769a19f81e34] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:23:23,722 - AUTH - INFO - [414ea5e6-aeba-4a49-a450-f0158f1778e7] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:23:23,725 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:23:23,729 - AUTH - INFO - [4421abd2-8060-4f66-93b8-769a19f81e34] Response status: 200 - Completed in 0.0081s
2025-05-31 12:23:23,730 - AUTH - INFO - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:23:23,732 - AUTH - DEBUG - [GetTransactionPartners] Added partner_id 3 (from listing 11, user was creator)
2025-05-31 12:23:23,734 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:23:23,735 - AUTH - INFO - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:23:23,736 - AUTH - DEBUG - [GetTransactionPartners] Returning partner 1: ID=3, Username=en7ka
2025-05-31 12:23:23,738 - AUTH - INFO - [414ea5e6-aeba-4a49-a450-f0158f1778e7] Response status: 200 - Completed in 0.0149s
2025-05-31 12:23:42,390 - AUTH - INFO - [ac16dff8-2126-43e3-a34d-d16490396151] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:23:42,392 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:23:42,392 - AUTH - INFO - [ac16dff8-2126-43e3-a34d-d16490396151] Response status: 401 - Completed in 0.0021s
2025-05-31 12:23:42,822 - AUTH - INFO - [2f9fdc2c-0b68-4d5e-9d5e-e8c887b681ea] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:23:42,824 - AUTH - INFO - [2f9fdc2c-0b68-4d5e-9d5e-e8c887b681ea] Request body for POST will be processed by endpoint.
2025-05-31 12:23:42,825 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:23:42,826 - AUTH - INFO - [2f9fdc2c-0b68-4d5e-9d5e-e8c887b681ea] Response status: 401 - Completed in 0.0022s
2025-05-31 12:23:43,240 - AUTH - INFO - [bf29abbe-dff2-4a36-8cf6-2f34f134a369] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:23:43,241 - AUTH - INFO - [bf29abbe-dff2-4a36-8cf6-2f34f134a369] Request body for POST will be processed by endpoint.
2025-05-31 12:23:43,243 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:23:43,243 - AUTH - INFO - [bf29abbe-dff2-4a36-8cf6-2f34f134a369] Response status: 401 - Completed in 0.0022s
2025-05-31 12:23:43,608 - AUTH - INFO - [e79a1db9-555d-4ed0-96b4-1dd9fa4a0777] Request from 77.91.101.132:0 - POST /debug/auth/
2025-05-31 12:23:43,608 - AUTH - INFO - [e79a1db9-555d-4ed0-96b4-1dd9fa4a0777] Request body for POST will be processed by endpoint.
2025-05-31 12:23:43,609 - AUTH - WARNING - 

********************************************************************************
2025-05-31 12:23:43,610 - AUTH - WARNING - === Starting Debug Auth POST ===
2025-05-31 12:23:43,610 - AUTH - WARNING - ********************************************************************************
2025-05-31 12:23:43,611 - AUTH - DEBUG - Attempting to read request body for /debug/auth POST...
2025-05-31 12:23:43,612 - AUTH - INFO - Successfully read body for /debug/auth POST, length: 44
2025-05-31 12:23:43,612 - AUTH - DEBUG - Raw request body for /debug/auth POST: {"telegram_id":12345,"username":"test_user"}...
2025-05-31 12:23:43,612 - AUTH - DEBUG - Parsed JSON data for /debug/auth POST: {'telegram_id': 12345, 'username': 'test_user'}
2025-05-31 12:23:43,613 - AUTH - WARNING - Creating/fetching test user for /debug/auth: telegram_id=12345, username=test_user
2025-05-31 12:23:43,614 - AUTH - WARNING - User 12345 found in database, using existing user
2025-05-31 12:23:43,615 - backend.auth - DEBUG - JWT created for None (exp 2025-06-01 09:23:43.614159)
2025-05-31 12:23:43,615 - backend.auth - DEBUG - JWT created for test_user (exp 2025-06-01 09:23:43.615855)
2025-05-31 12:23:43,615 - AUTH - INFO - [e79a1db9-555d-4ed0-96b4-1dd9fa4a0777] Response status: 200 - Completed in 0.0070s
2025-05-31 12:27:28,977 - backend.auth - INFO - ================================================================================
2025-05-31 12:27:28,977 - backend.auth - INFO - Authentication module initialized
2025-05-31 12:27:28,977 - backend.auth - INFO - BOT_TOKEN: 80221..._4-bU (length: 46)
2025-05-31 12:27:28,977 - backend.auth - INFO - ================================================================================
2025-05-31 12:27:28,977 - AUTH - INFO - ================================================================================
2025-05-31 12:27:28,977 - AUTH - INFO - Starting Time Banking API
2025-05-31 12:27:28,977 - AUTH - INFO - ================================================================================
2025-05-31 12:27:28,977 - AUTH - INFO - Bot token: 80221..._4-bU (length: 46)
2025-05-31 12:27:45,212 - AUTH - INFO - [6bb1f8f9-7400-4b19-a3c0-5c5b36ced160] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:27:45,215 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:27:45,216 - AUTH - INFO - [6bb1f8f9-7400-4b19-a3c0-5c5b36ced160] Response status: 401 - Completed in 0.0030s
2025-05-31 12:27:45,653 - AUTH - INFO - [f69eb6fe-8bdf-4ede-9e17-eec7a7e774c6] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:27:45,653 - AUTH - INFO - [f69eb6fe-8bdf-4ede-9e17-eec7a7e774c6] Request body for POST will be processed by endpoint.
2025-05-31 12:27:45,655 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:27:45,656 - AUTH - INFO - [f69eb6fe-8bdf-4ede-9e17-eec7a7e774c6] Response status: 401 - Completed in 0.0022s
2025-05-31 12:27:46,009 - AUTH - INFO - [b9060319-3740-4f4c-9968-afe73d72fda3] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:27:46,010 - AUTH - INFO - [b9060319-3740-4f4c-9968-afe73d72fda3] Request body for POST will be processed by endpoint.
2025-05-31 12:27:46,012 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:27:46,013 - AUTH - INFO - [b9060319-3740-4f4c-9968-afe73d72fda3] Response status: 401 - Completed in 0.0027s
2025-05-31 12:27:46,960 - AUTH - INFO - [13d6c919-97bb-4ec6-aacf-8efa879c32fd] Request from 77.91.101.132:0 - POST /debug/auth/
2025-05-31 12:27:46,960 - AUTH - INFO - [13d6c919-97bb-4ec6-aacf-8efa879c32fd] Request body for POST will be processed by endpoint.
2025-05-31 12:27:46,962 - AUTH - WARNING - 

********************************************************************************
2025-05-31 12:27:46,962 - AUTH - WARNING - === Starting Debug Auth POST ===
2025-05-31 12:27:46,962 - AUTH - WARNING - ********************************************************************************
2025-05-31 12:27:46,963 - AUTH - DEBUG - Attempting to read request body for /debug/auth POST...
2025-05-31 12:27:46,964 - AUTH - INFO - Successfully read body for /debug/auth POST, length: 44
2025-05-31 12:27:46,964 - AUTH - DEBUG - Raw request body for /debug/auth POST: {"telegram_id":12345,"username":"test_user"}...
2025-05-31 12:27:46,965 - AUTH - DEBUG - Parsed JSON data for /debug/auth POST: {'telegram_id': 12345, 'username': 'test_user'}
2025-05-31 12:27:46,966 - AUTH - WARNING - Creating/fetching test user for /debug/auth: telegram_id=12345, username=test_user
2025-05-31 12:27:46,968 - AUTH - WARNING - User 12345 found in database, using existing user
2025-05-31 12:27:46,976 - backend.auth - DEBUG - JWT created for None (exp 2025-06-01 09:27:46.968583)
2025-05-31 12:27:46,976 - backend.auth - DEBUG - JWT created for test_user (exp 2025-06-01 09:27:46.976069)
2025-05-31 12:27:46,978 - AUTH - INFO - [13d6c919-97bb-4ec6-aacf-8efa879c32fd] Response status: 200 - Completed in 0.0169s
2025-05-31 12:27:49,672 - AUTH - INFO - [464b7bb2-f997-4d84-ad18-3b99d8e7cb82] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:27:49,686 - AUTH - INFO - [464b7bb2-f997-4d84-ad18-3b99d8e7cb82] Response status: 200 - Completed in 0.0138s
2025-05-31 12:28:30,052 - AUTH - INFO - [07663bc9-16fd-4e1c-8c4b-9d9b44e80e33] Request from 77.91.101.132:0 - GET /listings/user/1/
2025-05-31 12:28:30,064 - AUTH - INFO - [7d5118dd-8f43-49bc-ad92-2852f9f6c8cb] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:28:30,065 - AUTH - INFO - [06596033-3347-46a6-833c-cac08069c971] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:28:30,067 - AUTH - INFO - [00bc8a1f-39b1-45e2-b12a-011cb27f9ac6] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:28:30,067 - AUTH - INFO - [07663bc9-16fd-4e1c-8c4b-9d9b44e80e33] Response status: 200 - Completed in 0.0136s
2025-05-31 12:28:30,078 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 1
2025-05-31 12:28:30,088 - AUTH - INFO - [06596033-3347-46a6-833c-cac08069c971] Response status: 200 - Completed in 0.0218s
2025-05-31 12:28:30,091 - AUTH - INFO - [GetTransactionPartners] Found 0 completed listings involving user 1
2025-05-31 12:28:30,092 - AUTH - INFO - [7d5118dd-8f43-49bc-ad92-2852f9f6c8cb] Response status: 200 - Completed in 0.0269s
2025-05-31 12:28:30,092 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:28:30,096 - AUTH - INFO - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:28:30,097 - AUTH - INFO - [00bc8a1f-39b1-45e2-b12a-011cb27f9ac6] Response status: 200 - Completed in 0.0304s
2025-05-31 12:28:30,233 - AUTH - INFO - [21bbd3f0-e768-4ac2-91d4-06ed35f6f4fa] Request from 77.91.101.132:0 - GET /listings/user/1/
2025-05-31 12:28:30,238 - AUTH - INFO - [21bbd3f0-e768-4ac2-91d4-06ed35f6f4fa] Response status: 200 - Completed in 0.0038s
2025-05-31 12:28:30,295 - AUTH - INFO - [8c2ce231-60a7-4759-a8f7-dce4d58d2677] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:28:30,300 - AUTH - INFO - [8c2ce231-60a7-4759-a8f7-dce4d58d2677] Response status: 200 - Completed in 0.0042s
2025-05-31 12:28:30,384 - AUTH - INFO - [d1a787d2-2ad5-49ab-9123-d9bd06c0db79] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:28:30,385 - AUTH - INFO - [acaaa1d8-ddc4-43b0-82ca-5f635252fab4] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:28:30,388 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 1
2025-05-31 12:28:30,391 - AUTH - INFO - [d1a787d2-2ad5-49ab-9123-d9bd06c0db79] Response status: 200 - Completed in 0.0064s
2025-05-31 12:28:30,391 - AUTH - INFO - [GetTransactionPartners] Found 0 completed listings involving user 1
2025-05-31 12:28:30,392 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:28:30,395 - AUTH - INFO - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:28:30,396 - AUTH - INFO - [acaaa1d8-ddc4-43b0-82ca-5f635252fab4] Response status: 200 - Completed in 0.0103s
2025-05-31 12:29:55,986 - AUTH - INFO - [f71e620a-1645-4a53-bfd3-887bac30f059] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:29:55,989 - AUTH - INFO - [f71e620a-1645-4a53-bfd3-887bac30f059] Response status: 200 - Completed in 0.0021s
2025-05-31 12:29:56,172 - AUTH - INFO - [ed289847-c0cd-4d00-b35f-f697a76a1b1c] Request from 77.91.101.132:0 - GET /user/me/
2025-05-31 12:29:56,173 - AUTH - DEBUG - [GetUserMe] Attempting to get current user.
2025-05-31 12:29:56,175 - AUTH - ERROR - [ed289847-c0cd-4d00-b35f-f697a76a1b1c] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:29:56,184 - AUTH - ERROR - [ed289847-c0cd-4d00-b35f-f697a76a1b1c] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:29:56,185 - AUTH - ERROR - [ed289847-c0cd-4d00-b35f-f697a76a1b1c] Failed after 0.0016s
2025-05-31 12:29:56,186 - AUTH - ERROR - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:29:56,189 - AUTH - ERROR - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:29:56,670 - AUTH - INFO - [543b72d2-3340-4935-9dd3-bb68f77aadf1] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:29:56,671 - AUTH - INFO - [543b72d2-3340-4935-9dd3-bb68f77aadf1] Request body for POST will be processed by endpoint.
2025-05-31 12:29:56,673 - AUTH - INFO - 

********************************************************************************
2025-05-31 12:29:56,674 - AUTH - INFO - === Starting Telegram Authentication ===
2025-05-31 12:29:56,674 - AUTH - INFO - ********************************************************************************
2025-05-31 12:29:56,675 - AUTH - DEBUG - Request headers:
2025-05-31 12:29:56,675 - AUTH - DEBUG -   x-forwarded-proto: https
2025-05-31 12:29:56,675 - AUTH - DEBUG -   x-forwarded-host: 0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:29:56,675 - AUTH - DEBUG -   x-forwarded-for: 77.91.101.132
2025-05-31 12:29:56,676 - AUTH - DEBUG -   sec-fetch-site: same-origin
2025-05-31 12:29:56,676 - AUTH - DEBUG -   sec-fetch-mode: cors
2025-05-31 12:29:56,676 - AUTH - DEBUG -   sec-fetch-dest: empty
2025-05-31 12:29:56,678 - AUTH - DEBUG -   sec-ch-ua-platform: "Windows"
2025-05-31 12:29:56,678 - AUTH - DEBUG -   sec-ch-ua-mobile: ?0
2025-05-31 12:29:56,678 - AUTH - DEBUG -   sec-ch-ua: "Microsoft Edge";v="136", "Microsoft Edge WebView2";v="136", "Not.A/Brand";v="99", "Chromium";v="136"
2025-05-31 12:29:56,678 - AUTH - DEBUG -   referer: https://0e4c-77-91-101-132.ngrok-free.app/
2025-05-31 12:29:56,678 - AUTH - DEBUG -   priority: u=1, i
2025-05-31 12:29:56,678 - AUTH - DEBUG -   origin: https://0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:29:56,678 - AUTH - DEBUG -   cookie: abuse_interstitial=0e4c-77-91-101-132.ngrok-free.app; access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidGVsZWdyYW1faWQiOiI4ODc5NzgwOTEiLCJ1c2VybmFtZSI6InNhcl9hX3RvX3YiLCJ0eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQ4NzY5ODAwfQ.br1QwYBNlTI6F54lsdqZYU9S4GD0SneFsq4YNhkSRKQ; refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidGVsZWdyYW1faWQiOiI4ODc5NzgwOTEiLCJ1c2VybmFtZSI6InNhcl9hX3RvX3YiLCJ0eXBlIjoicmVmcmVzaCIsImV4cCI6MTc0ODc2OTgwMH0.ZvwoPooQxWb1sgJRXIErLv2XrNPLm5U9wzAiqpbEfQE
2025-05-31 12:29:56,678 - AUTH - DEBUG -   content-type: application/json
2025-05-31 12:29:56,681 - AUTH - DEBUG -   accept-language: ru,en;q=0.9,en-GB;q=0.8,en-US;q=0.7
2025-05-31 12:29:56,682 - AUTH - DEBUG -   accept-encoding: gzip, deflate, br, zstd
2025-05-31 12:29:56,682 - AUTH - DEBUG -   accept: application/json, text/plain, */*
2025-05-31 12:29:56,683 - AUTH - DEBUG -   content-length: 580
2025-05-31 12:29:56,683 - AUTH - DEBUG -   user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0
2025-05-31 12:29:56,683 - AUTH - DEBUG -   host: localhost:8000
2025-05-31 12:29:56,683 - AUTH - DEBUG -   connection: close
2025-05-31 12:29:56,683 - AUTH - DEBUG - Request method: POST
2025-05-31 12:29:56,683 - AUTH - DEBUG - POST request to /auth/telegram. Processing body...
2025-05-31 12:29:56,683 - AUTH - DEBUG - Attempt 1: Reading entire request body for POST with timeout...
2025-05-31 12:29:56,686 - AUTH - INFO - Successfully read entire body (POST), length: 580
2025-05-31 12:29:56,686 - AUTH - DEBUG - Raw request body (POST): {"init_data":"query_id=AAFreO00AAAAAGt47TSPN8d6&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683791&signature=_6fw5awgWjNtzHlYv9FpTJTVoCsMXlqQZGln4UTXionwpuLpV2KFjdALCcjZMCk2jBG3EvG_823-jtIlBI0oCw&hash=bee6...
2025-05-31 12:29:56,686 - AUTH - DEBUG - Parsed JSON data: {'init_data': 'query_id=AAFreO00AAAAAGt47TSPN8d6&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683791&signature=_6fw5awgWjNtzHlYv9FpTJTVoCsMXlqQZGln4UTXionwpuLpV2KFjdALCcjZMCk2jBG3EvG_823-jtIlBI0oCw&hash=bee621b6f23bc098950aa8da804ffc949a7542cfa00fd87f06cdc1d1d100678e', 'test_mode': False}
2025-05-31 12:29:56,686 - AUTH - INFO - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:29:56,689 - AUTH - DEBUG - Raw init_data: query_id=AAFreO00AAAAAGt47TSPN8d6&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683791&signature=_6fw5awgWjNtzHlYv9FpTJTVoCsMXlqQZGln4UTXionwpuLpV2KFjdALCcjZMCk2jBG3EvG_823-jtIlBI0oCw&hash=bee621b6f23bc098950aa8da804ffc949a7542cfa00fd87f06cdc1d1d100678e
2025-05-31 12:29:56,689 - AUTH - DEBUG - Parsed data parameters count: 5
2025-05-31 12:29:56,689 - AUTH - DEBUG -   query_id: AAFreO00AAAAAGt47TSPN8d6
2025-05-31 12:29:56,690 - AUTH - DEBUG -   user: [hidden for security]
2025-05-31 12:29:56,691 - AUTH - DEBUG -   auth_date: 1748683791
2025-05-31 12:29:56,691 - AUTH - DEBUG -   signature: _6fw5awgWjNtzHlYv9FpTJTVoCsMXlqQZGln4UTXionwpuLpV2KFjdALCcjZMCk2jBG3EvG_823-jtIlBI0oCw
2025-05-31 12:29:56,691 - AUTH - DEBUG -   hash: [hidden for security]
2025-05-31 12:29:56,692 - AUTH - DEBUG - Extracted hash value length: 64
2025-05-31 12:29:56,692 - AUTH - INFO - Verifying Telegram hash...
2025-05-31 12:29:56,693 - backend.auth - DEBUG - 
==================================================
2025-05-31 12:29:56,693 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 12:29:56,694 - backend.auth - DEBUG - ==================================================
2025-05-31 12:29:56,694 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 12:29:56,695 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 12:29:56,696 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TSPN8d6&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748683791&signature=_6fw5awgWjNtzHlYv9FpTJTVoCsMXlqQZGln4UTXionwpuLpV2KFjdALCcjZMCk2jBG3EvG_823-jtIlBI0oCw&hash=bee621b6f23bc098950aa8da804ffc949a7542cfa00fd87f06cdc1d1d100678e'
2025-05-31 12:29:56,697 - backend.auth - DEBUG - received_hash: bee621b6f23bc098950aa8da804ffc949a7542cfa00fd87f06cdc1d1d100678e
2025-05-31 12:29:56,697 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TSPN8d6', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748683791', 'signature': '_6fw5awgWjNtzHlYv9FpTJTVoCsMXlqQZGln4UTXionwpuLpV2KFjdALCcjZMCk2jBG3EvG_823-jtIlBI0oCw'}
2025-05-31 12:29:56,698 - backend.auth - DEBUG - Hash from dictionary: bee621b6f23bc098950aa8da804ffc949a7542cfa00fd87f06cdc1d1d100678e
2025-05-31 12:29:56,699 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748683791
query_id=AAFreO00AAAAAGt47TSPN8d6
signature=_6fw5awgWjNtzHlYv9FpTJTVoCsMXlqQZGln4UTXionwpuLpV2KFjdALCcjZMCk2jBG3EvG_823-jtIlBI0oCw
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 12:29:56,699 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 12:29:56,700 - backend.auth - DEBUG - Calculated hash: bee621b6f23bc098950aa8da804ffc949a7542cfa00fd87f06cdc1d1d100678e
2025-05-31 12:29:56,700 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 12:29:56,701 - backend.auth - DEBUG - ==================================================

2025-05-31 12:29:56,702 - AUTH - INFO - Hash verification successful
2025-05-31 12:29:56,702 - AUTH - INFO - Parsing user data...
2025-05-31 12:29:56,703 - AUTH - DEBUG - Raw user data length: 319
2025-05-31 12:29:56,703 - AUTH - DEBUG - URL-decoded user data length: 215
2025-05-31 12:29:56,703 - AUTH - DEBUG - Parsed user_info: ID=887978091, username=sar_a_to_v
2025-05-31 12:29:56,703 - AUTH - DEBUG - Converted telegram_id to int: 887978091 (type: <class 'int'>)
2025-05-31 12:29:56,705 - AUTH - INFO - Looking up user with telegram_id: 887978091
2025-05-31 12:29:56,705 - AUTH - INFO - Found existing user: sar_a_to_v (ID: 2, Telegram ID: 887978091)
2025-05-31 12:29:56,705 - AUTH - INFO - Creating JWT tokens for user: sar_a_to_v
2025-05-31 12:29:56,705 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-06-01 09:29:56.705344)
2025-05-31 12:29:56,705 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-06-01 09:29:56.705344)
2025-05-31 12:29:56,710 - AUTH - INFO - === Authentication Successful ===
2025-05-31 12:29:56,710 - AUTH - INFO - ********************************************************************************


2025-05-31 12:29:56,710 - AUTH - INFO - [543b72d2-3340-4935-9dd3-bb68f77aadf1] Response status: 200 - Completed in 0.0387s
2025-05-31 12:29:57,041 - AUTH - INFO - [e22e444e-1435-4c8e-8495-e4e8612515c3] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:29:57,045 - AUTH - INFO - [e22e444e-1435-4c8e-8495-e4e8612515c3] Response status: 200 - Completed in 0.0032s
2025-05-31 12:29:58,894 - AUTH - INFO - [46110178-7298-4ec8-8894-16ad599b4230] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:29:58,899 - AUTH - INFO - [46110178-7298-4ec8-8894-16ad599b4230] Response status: 200 - Completed in 0.0044s
2025-05-31 12:29:58,946 - AUTH - INFO - [79550e80-9eb0-4a34-bc32-cce691d3a5f3] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:29:58,948 - AUTH - INFO - [97e913d0-ff61-4ca4-aca9-ff8fb1fa3474] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:29:58,948 - AUTH - INFO - [d91ff10d-49f3-4f06-82dc-02b1c9e55aab] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:29:58,950 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:29:58,959 - AUTH - INFO - [79550e80-9eb0-4a34-bc32-cce691d3a5f3] Response status: 200 - Completed in 0.0090s
2025-05-31 12:29:58,960 - AUTH - INFO - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:29:58,962 - AUTH - DEBUG - [GetTransactionPartners] Added partner_id 3 (from listing 11, user was creator)
2025-05-31 12:29:58,962 - AUTH - INFO - [d91ff10d-49f3-4f06-82dc-02b1c9e55aab] Response status: 200 - Completed in 0.0145s
2025-05-31 12:29:58,963 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:29:58,967 - AUTH - INFO - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:29:58,969 - AUTH - DEBUG - [GetTransactionPartners] Returning partner 1: ID=3, Username=en7ka
2025-05-31 12:29:58,970 - AUTH - INFO - [97e913d0-ff61-4ca4-aca9-ff8fb1fa3474] Response status: 200 - Completed in 0.0223s
2025-05-31 12:29:59,133 - AUTH - INFO - [1bac9595-a9ea-47ef-bc39-470a74c44893] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:29:59,135 - AUTH - INFO - [340e8426-5e62-4409-8390-e461648c4620] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:29:59,142 - AUTH - INFO - [1bac9595-a9ea-47ef-bc39-470a74c44893] Response status: 200 - Completed in 0.0082s
2025-05-31 12:29:59,144 - AUTH - INFO - [340e8426-5e62-4409-8390-e461648c4620] Response status: 200 - Completed in 0.0083s
2025-05-31 12:29:59,196 - AUTH - INFO - [369aa461-b33b-43b5-bad0-c52e4df12160] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:29:59,198 - AUTH - INFO - [cd95ac6d-02ff-4ce7-8ce5-d044b0759ff5] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:29:59,199 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:29:59,203 - AUTH - INFO - [369aa461-b33b-43b5-bad0-c52e4df12160] Response status: 200 - Completed in 0.0061s
2025-05-31 12:29:59,206 - AUTH - INFO - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:29:59,210 - AUTH - DEBUG - [GetTransactionPartners] Added partner_id 3 (from listing 11, user was creator)
2025-05-31 12:29:59,210 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:29:59,212 - AUTH - INFO - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:29:59,213 - AUTH - DEBUG - [GetTransactionPartners] Returning partner 1: ID=3, Username=en7ka
2025-05-31 12:29:59,214 - AUTH - INFO - [cd95ac6d-02ff-4ce7-8ce5-d044b0759ff5] Response status: 200 - Completed in 0.0159s
2025-05-31 12:35:51,276 - AUTH - INFO - [277113ce-287c-4160-a71e-abcb6ef7b43e] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:35:51,279 - AUTH - INFO - [277113ce-287c-4160-a71e-abcb6ef7b43e] Response status: 200 - Completed in 0.0021s
2025-05-31 12:35:51,509 - AUTH - INFO - [45d0874f-a444-430b-8acf-4ed3ccbd25b1] Request from 77.91.101.132:0 - GET /user/me/
2025-05-31 12:35:51,511 - AUTH - DEBUG - [GetUserMe] Attempting to get current user.
2025-05-31 12:35:51,512 - AUTH - ERROR - [45d0874f-a444-430b-8acf-4ed3ccbd25b1] Error during request processing: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:35:51,514 - AUTH - ERROR - [45d0874f-a444-430b-8acf-4ed3ccbd25b1] Error details: Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:35:51,516 - AUTH - ERROR - [45d0874f-a444-430b-8acf-4ed3ccbd25b1] Failed after 0.0021s
2025-05-31 12:35:51,516 - AUTH - ERROR - Unhandled exception: get_current_user() takes 1 positional argument but 2 were given
2025-05-31 12:35:51,516 - AUTH - ERROR - Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 216, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Арматур\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Арматур\Downloads\time_banking_bot_fixed\time_banking_bot\backend\main.py", line 366, in get_user_me
    token_data = get_current_user(request, db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_current_user() takes 1 positional argument but 2 were given

2025-05-31 12:35:52,037 - AUTH - INFO - [aee2292c-ec4c-4cf7-855b-766917e50918] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:35:52,038 - AUTH - INFO - [aee2292c-ec4c-4cf7-855b-766917e50918] Request body for POST will be processed by endpoint.
2025-05-31 12:35:52,040 - AUTH - INFO - 

********************************************************************************
2025-05-31 12:35:52,041 - AUTH - INFO - === Starting Telegram Authentication ===
2025-05-31 12:35:52,041 - AUTH - INFO - ********************************************************************************
2025-05-31 12:35:52,042 - AUTH - DEBUG - Request headers:
2025-05-31 12:35:52,042 - AUTH - DEBUG -   x-forwarded-proto: https
2025-05-31 12:35:52,042 - AUTH - DEBUG -   x-forwarded-host: 0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:35:52,043 - AUTH - DEBUG -   x-forwarded-for: 77.91.101.132
2025-05-31 12:35:52,043 - AUTH - DEBUG -   sec-fetch-site: same-origin
2025-05-31 12:35:52,043 - AUTH - DEBUG -   sec-fetch-mode: cors
2025-05-31 12:35:52,044 - AUTH - DEBUG -   sec-fetch-dest: empty
2025-05-31 12:35:52,044 - AUTH - DEBUG -   sec-ch-ua-platform: "Windows"
2025-05-31 12:35:52,044 - AUTH - DEBUG -   sec-ch-ua-mobile: ?0
2025-05-31 12:35:52,044 - AUTH - DEBUG -   sec-ch-ua: "Microsoft Edge";v="136", "Microsoft Edge WebView2";v="136", "Not.A/Brand";v="99", "Chromium";v="136"
2025-05-31 12:35:52,044 - AUTH - DEBUG -   referer: https://0e4c-77-91-101-132.ngrok-free.app/
2025-05-31 12:35:52,044 - AUTH - DEBUG -   priority: u=1, i
2025-05-31 12:35:52,047 - AUTH - DEBUG -   origin: https://0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:35:52,047 - AUTH - DEBUG -   cookie: abuse_interstitial=0e4c-77-91-101-132.ngrok-free.app; access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidGVsZWdyYW1faWQiOiI4ODc5NzgwOTEiLCJ1c2VybmFtZSI6InNhcl9hX3RvX3YiLCJ0eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQ4NzcwMTk2fQ.T4F1uHKNfto3odKyxAFhdGYq_zvqE8xyg5k235erkEs; refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwidGVsZWdyYW1faWQiOiI4ODc5NzgwOTEiLCJ1c2VybmFtZSI6InNhcl9hX3RvX3YiLCJ0eXBlIjoicmVmcmVzaCIsImV4cCI6MTc0ODc3MDE5Nn0.B2e3HR5EkrKPyhpQWpy1SHLAVKWSwcVqVnVM1B3AaQM
2025-05-31 12:35:52,047 - AUTH - DEBUG -   content-type: application/json
2025-05-31 12:35:52,047 - AUTH - DEBUG -   accept-language: ru,en;q=0.9,en-GB;q=0.8,en-US;q=0.7
2025-05-31 12:35:52,047 - AUTH - DEBUG -   accept-encoding: gzip, deflate, br, zstd
2025-05-31 12:35:52,047 - AUTH - DEBUG -   accept: application/json, text/plain, */*
2025-05-31 12:35:52,047 - AUTH - DEBUG -   content-length: 580
2025-05-31 12:35:52,047 - AUTH - DEBUG -   user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0
2025-05-31 12:35:52,051 - AUTH - DEBUG -   host: localhost:8000
2025-05-31 12:35:52,052 - AUTH - DEBUG -   connection: close
2025-05-31 12:35:52,052 - AUTH - DEBUG - Request method: POST
2025-05-31 12:35:52,052 - AUTH - DEBUG - POST request to /auth/telegram. Processing body...
2025-05-31 12:35:52,052 - AUTH - DEBUG - Attempt 1: Reading entire request body for POST with timeout...
2025-05-31 12:35:52,052 - AUTH - INFO - Successfully read entire body (POST), length: 580
2025-05-31 12:35:52,052 - AUTH - DEBUG - Raw request body (POST): {"init_data":"query_id=AAFreO00AAAAAGt47TTGFgQu&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748684147&signature=nZVlrvVpRxHA0QKTrduBnq8Cb51s0yL0x7HfoR6PYf-k_0GzL-F5TDGxZUEMaP6OBCwHLrdna9RMr2RqFkaABQ&hash=a118...
2025-05-31 12:35:52,052 - AUTH - DEBUG - Parsed JSON data: {'init_data': 'query_id=AAFreO00AAAAAGt47TTGFgQu&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748684147&signature=nZVlrvVpRxHA0QKTrduBnq8Cb51s0yL0x7HfoR6PYf-k_0GzL-F5TDGxZUEMaP6OBCwHLrdna9RMr2RqFkaABQ&hash=a1186e444912099c0c3d75961322a73930772b61260d93f0cdbabbf54ed2ed82', 'test_mode': False}
2025-05-31 12:35:52,052 - AUTH - INFO - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:35:52,052 - AUTH - DEBUG - Raw init_data: query_id=AAFreO00AAAAAGt47TTGFgQu&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748684147&signature=nZVlrvVpRxHA0QKTrduBnq8Cb51s0yL0x7HfoR6PYf-k_0GzL-F5TDGxZUEMaP6OBCwHLrdna9RMr2RqFkaABQ&hash=a1186e444912099c0c3d75961322a73930772b61260d93f0cdbabbf54ed2ed82
2025-05-31 12:35:52,052 - AUTH - DEBUG - Parsed data parameters count: 5
2025-05-31 12:35:52,052 - AUTH - DEBUG -   query_id: AAFreO00AAAAAGt47TTGFgQu
2025-05-31 12:35:52,057 - AUTH - DEBUG -   user: [hidden for security]
2025-05-31 12:35:52,057 - AUTH - DEBUG -   auth_date: 1748684147
2025-05-31 12:35:52,057 - AUTH - DEBUG -   signature: nZVlrvVpRxHA0QKTrduBnq8Cb51s0yL0x7HfoR6PYf-k_0GzL-F5TDGxZUEMaP6OBCwHLrdna9RMr2RqFkaABQ
2025-05-31 12:35:52,057 - AUTH - DEBUG -   hash: [hidden for security]
2025-05-31 12:35:52,057 - AUTH - DEBUG - Extracted hash value length: 64
2025-05-31 12:35:52,057 - AUTH - INFO - Verifying Telegram hash...
2025-05-31 12:35:52,057 - backend.auth - DEBUG - 
==================================================
2025-05-31 12:35:52,060 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 12:35:52,061 - backend.auth - DEBUG - ==================================================
2025-05-31 12:35:52,061 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 12:35:52,062 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 12:35:52,063 - backend.auth - DEBUG - init_data (repr): 'query_id=AAFreO00AAAAAGt47TTGFgQu&user=%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D&auth_date=1748684147&signature=nZVlrvVpRxHA0QKTrduBnq8Cb51s0yL0x7HfoR6PYf-k_0GzL-F5TDGxZUEMaP6OBCwHLrdna9RMr2RqFkaABQ&hash=a1186e444912099c0c3d75961322a73930772b61260d93f0cdbabbf54ed2ed82'
2025-05-31 12:35:52,064 - backend.auth - DEBUG - received_hash: a1186e444912099c0c3d75961322a73930772b61260d93f0cdbabbf54ed2ed82
2025-05-31 12:35:52,064 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAFreO00AAAAAGt47TTGFgQu', 'user': '%7B%22id%22%3A887978091%2C%22first_name%22%3A%22.%22%2C%22last_name%22%3A%22.%22%2C%22username%22%3A%22sar_a_to_v%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2F1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg%22%7D', 'auth_date': '1748684147', 'signature': 'nZVlrvVpRxHA0QKTrduBnq8Cb51s0yL0x7HfoR6PYf-k_0GzL-F5TDGxZUEMaP6OBCwHLrdna9RMr2RqFkaABQ'}
2025-05-31 12:35:52,065 - backend.auth - DEBUG - Hash from dictionary: a1186e444912099c0c3d75961322a73930772b61260d93f0cdbabbf54ed2ed82
2025-05-31 12:35:52,066 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748684147
query_id=AAFreO00AAAAAGt47TTGFgQu
signature=nZVlrvVpRxHA0QKTrduBnq8Cb51s0yL0x7HfoR6PYf-k_0GzL-F5TDGxZUEMaP6OBCwHLrdna9RMr2RqFkaABQ
user={"id":887978091,"first_name":".","last_name":".","username":"sar_a_to_v","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg"}
2025-05-31 12:35:52,066 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 12:35:52,067 - backend.auth - DEBUG - Calculated hash: a1186e444912099c0c3d75961322a73930772b61260d93f0cdbabbf54ed2ed82
2025-05-31 12:35:52,068 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 12:35:52,068 - backend.auth - DEBUG - ==================================================

2025-05-31 12:35:52,069 - AUTH - INFO - Hash verification successful
2025-05-31 12:35:52,070 - AUTH - INFO - Parsing user data...
2025-05-31 12:35:52,070 - AUTH - DEBUG - Raw user data length: 319
2025-05-31 12:35:52,071 - AUTH - DEBUG - URL-decoded user data length: 215
2025-05-31 12:35:52,071 - AUTH - DEBUG - Parsed user_info: ID=887978091, username=sar_a_to_v
2025-05-31 12:35:52,071 - AUTH - DEBUG - Converted telegram_id to int: 887978091 (type: <class 'int'>)
2025-05-31 12:35:52,072 - AUTH - INFO - Looking up user with telegram_id: 887978091
2025-05-31 12:35:52,074 - AUTH - INFO - Found existing user: sar_a_to_v (ID: 2, Telegram ID: 887978091)
2025-05-31 12:35:52,074 - AUTH - INFO - Creating JWT tokens for user: sar_a_to_v
2025-05-31 12:35:52,074 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-06-01 09:35:52.074021)
2025-05-31 12:35:52,074 - backend.auth - DEBUG - JWT created for sar_a_to_v (exp 2025-06-01 09:35:52.074021)
2025-05-31 12:35:52,074 - AUTH - INFO - === Authentication Successful ===
2025-05-31 12:35:52,077 - AUTH - INFO - ********************************************************************************


2025-05-31 12:35:52,079 - AUTH - INFO - [aee2292c-ec4c-4cf7-855b-766917e50918] Response status: 200 - Completed in 0.0386s
2025-05-31 12:35:52,739 - AUTH - INFO - [c0fdb19e-ee12-4807-a1c0-5f206896322b] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:35:52,744 - AUTH - INFO - [c0fdb19e-ee12-4807-a1c0-5f206896322b] Response status: 200 - Completed in 0.0049s
2025-05-31 12:35:53,866 - AUTH - INFO - [bb473551-7a2b-4edf-b60c-199717d143ba] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:35:53,870 - AUTH - INFO - [bb473551-7a2b-4edf-b60c-199717d143ba] Response status: 200 - Completed in 0.0027s
2025-05-31 12:35:53,979 - AUTH - INFO - [c94d01d6-858d-4a6a-aead-34b48afcba7b] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:35:53,981 - AUTH - INFO - [396b889a-444d-41b2-baba-6f13f0120875] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:35:53,981 - AUTH - INFO - [ab2838ca-bc24-4454-bc28-f8f07e71a648] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:35:53,985 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:35:53,988 - AUTH - INFO - [ab2838ca-bc24-4454-bc28-f8f07e71a648] Response status: 200 - Completed in 0.0076s
2025-05-31 12:35:53,988 - AUTH - INFO - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:35:53,996 - AUTH - INFO - [c94d01d6-858d-4a6a-aead-34b48afcba7b] Response status: 200 - Completed in 0.0163s
2025-05-31 12:35:53,996 - AUTH - DEBUG - [GetTransactionPartners] Added partner_id 3 (from listing 11, user was creator)
2025-05-31 12:35:53,999 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:35:54,004 - AUTH - INFO - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:35:54,004 - AUTH - DEBUG - [GetTransactionPartners] Returning partner 1: ID=3, Username=en7ka
2025-05-31 12:35:54,006 - AUTH - INFO - [396b889a-444d-41b2-baba-6f13f0120875] Response status: 200 - Completed in 0.0253s
2025-05-31 12:35:54,037 - AUTH - INFO - [c9f22b88-0229-4273-b756-4e02fc758653] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:35:54,042 - AUTH - INFO - [c9f22b88-0229-4273-b756-4e02fc758653] Response status: 200 - Completed in 0.0044s
2025-05-31 12:35:54,163 - AUTH - INFO - [ac06de22-85ea-4a29-8c1f-90e59de207cc] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:35:54,170 - AUTH - INFO - [ac06de22-85ea-4a29-8c1f-90e59de207cc] Response status: 200 - Completed in 0.0053s
2025-05-31 12:35:54,221 - AUTH - INFO - [22eaed82-65f9-4602-8d90-f7ab1b6e15bb] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:35:54,224 - AUTH - INFO - [e4fd424a-99d6-4559-8767-dc6cc90c048d] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:35:54,226 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:35:54,226 - AUTH - INFO - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:35:54,234 - AUTH - INFO - [22eaed82-65f9-4602-8d90-f7ab1b6e15bb] Response status: 200 - Completed in 0.0104s
2025-05-31 12:35:54,234 - AUTH - DEBUG - [GetTransactionPartners] Added partner_id 3 (from listing 11, user was creator)
2025-05-31 12:35:54,234 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:35:54,239 - AUTH - INFO - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:35:54,239 - AUTH - DEBUG - [GetTransactionPartners] Returning partner 1: ID=3, Username=en7ka
2025-05-31 12:35:54,241 - AUTH - INFO - [e4fd424a-99d6-4559-8767-dc6cc90c048d] Response status: 200 - Completed in 0.0162s
2025-05-31 12:44:12,255 - AUTH - INFO - [72e98829-cd43-4658-a689-94d687af866a] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:44:12,258 - AUTH - INFO - [72e98829-cd43-4658-a689-94d687af866a] Response status: 200 - Completed in 0.0016s
2025-05-31 12:44:13,892 - backend.auth - INFO - ================================================================================
2025-05-31 12:44:13,893 - backend.auth - INFO - Authentication module initialized
2025-05-31 12:44:13,893 - backend.auth - INFO - BOT_TOKEN: 80221..._4-bU (length: 46)
2025-05-31 12:44:13,893 - backend.auth - INFO - ================================================================================
2025-05-31 12:44:13,895 - AUTH - INFO - ================================================================================
2025-05-31 12:44:13,896 - AUTH - INFO - Starting Time Banking API
2025-05-31 12:44:13,896 - AUTH - INFO - ================================================================================
2025-05-31 12:44:13,897 - AUTH - INFO - Bot token: 80221..._4-bU (length: 46)
2025-05-31 12:44:13,937 - AUTH - INFO - [4376fc07-2985-47d8-99a5-e2e373a4005d] Request from 77.91.101.132:0 - GET /user/me/
2025-05-31 12:44:13,943 - AUTH - DEBUG - [GetUserMe] Attempting to get current user.
2025-05-31 12:44:13,944 - AUTH - DEBUG - [GetUserMe] Token SUB: 2. Fetching user from DB.
2025-05-31 12:44:13,947 - AUTH - INFO - [GetUserMe] User sar_a_to_v (ID: 2) found. Avatar path from DB to be returned: 'https://t.me/i/userpic/320/1RamL_iAFcdZ2kGPxN7DFOtBN-utHaDkfIu1okZ2zsA.svg'
2025-05-31 12:44:13,948 - AUTH - INFO - [4376fc07-2985-47d8-99a5-e2e373a4005d] Response status: 200 - Completed in 0.0091s
2025-05-31 12:44:14,606 - AUTH - INFO - [53c0ffa1-5a69-43c4-b760-ce63bbd16910] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:44:14,615 - AUTH - INFO - [53c0ffa1-5a69-43c4-b760-ce63bbd16910] Response status: 200 - Completed in 0.0075s
2025-05-31 12:44:15,810 - AUTH - INFO - [58812260-4fa7-40a0-afd1-2ca49abf750e] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:44:15,818 - AUTH - INFO - [58812260-4fa7-40a0-afd1-2ca49abf750e] Response status: 200 - Completed in 0.0080s
2025-05-31 12:44:15,933 - AUTH - INFO - [551944bf-26d2-40c1-b2fc-ff13941316e8] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:44:15,936 - AUTH - INFO - [c43a9056-6fbc-4f60-a4bb-038ca79eaf35] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:44:15,937 - AUTH - INFO - [4f658dbe-753a-4615-b81e-a8951c5c2f88] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:44:15,947 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:44:15,955 - AUTH - INFO - [551944bf-26d2-40c1-b2fc-ff13941316e8] Response status: 200 - Completed in 0.0212s
2025-05-31 12:44:15,959 - AUTH - INFO - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:44:15,961 - AUTH - INFO - [4f658dbe-753a-4615-b81e-a8951c5c2f88] Response status: 200 - Completed in 0.0234s
2025-05-31 12:44:15,961 - AUTH - DEBUG - [GetTransactionPartners] Added partner_id 3 (from listing 11, user was creator)
2025-05-31 12:44:15,962 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:44:15,967 - AUTH - INFO - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:44:15,968 - AUTH - DEBUG - [GetTransactionPartners] Returning partner 1: ID=3, Username=en7ka
2025-05-31 12:44:15,969 - AUTH - INFO - [c43a9056-6fbc-4f60-a4bb-038ca79eaf35] Response status: 200 - Completed in 0.0322s
2025-05-31 12:44:16,034 - AUTH - INFO - [e0ab6e82-b71c-424b-8c72-600ecd6abda0] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:44:16,039 - AUTH - INFO - [e0ab6e82-b71c-424b-8c72-600ecd6abda0] Response status: 200 - Completed in 0.0039s
2025-05-31 12:44:16,176 - AUTH - INFO - [22284943-24f6-468f-ad88-3980345fc5b5] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 12:44:16,177 - AUTH - INFO - [12738295-301a-405f-b749-18efc151e6bd] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:44:16,178 - AUTH - INFO - [1621ff89-5d26-4c27-98b2-8df366bf8f04] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:44:16,182 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 12:44:16,187 - AUTH - INFO - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 12:44:16,187 - AUTH - INFO - [1621ff89-5d26-4c27-98b2-8df366bf8f04] Response status: 200 - Completed in 0.0084s
2025-05-31 12:44:16,188 - AUTH - DEBUG - [GetTransactionPartners] Added partner_id 3 (from listing 11, user was creator)
2025-05-31 12:44:16,191 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 12:44:16,191 - AUTH - INFO - [22284943-24f6-468f-ad88-3980345fc5b5] Response status: 200 - Completed in 0.0144s
2025-05-31 12:44:16,192 - AUTH - INFO - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 12:44:16,193 - AUTH - DEBUG - [GetTransactionPartners] Returning partner 1: ID=3, Username=en7ka
2025-05-31 12:44:16,197 - AUTH - INFO - [12738295-301a-405f-b749-18efc151e6bd] Response status: 200 - Completed in 0.0188s
2025-05-31 12:44:20,487 - AUTH - INFO - [cdac9a34-3544-4d40-947b-ad360439e6c4] Request from 77.91.101.132:0 - POST /profile/2/avatar/
2025-05-31 12:44:20,488 - AUTH - INFO - [cdac9a34-3544-4d40-947b-ad360439e6c4] Request body for POST will be processed by endpoint.
2025-05-31 12:44:20,505 - AUTH - INFO - [cdac9a34-3544-4d40-947b-ad360439e6c4] Response status: 200 - Completed in 0.0166s
2025-05-31 12:44:20,732 - AUTH - INFO - [4febc741-1d60-418f-a9a5-07ab98023b47] Request from 77.91.101.132:0 - GET /static/avatars/user_2_avatar_1748684660.jpg
2025-05-31 12:44:20,782 - AUTH - INFO - [4febc741-1d60-418f-a9a5-07ab98023b47] Response status: 200 - Completed in 0.0485s
2025-05-31 12:45:09,613 - AUTH - INFO - [88c5c756-60e6-4505-89ab-53da39d0366d] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:45:09,617 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:45:09,618 - AUTH - INFO - [88c5c756-60e6-4505-89ab-53da39d0366d] Response status: 401 - Completed in 0.0032s
2025-05-31 12:45:10,066 - AUTH - INFO - [0236a331-9e85-4c86-936a-2435dad16016] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:45:10,067 - AUTH - INFO - [0236a331-9e85-4c86-936a-2435dad16016] Request body for POST will be processed by endpoint.
2025-05-31 12:45:10,069 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:45:10,069 - AUTH - INFO - [0236a331-9e85-4c86-936a-2435dad16016] Response status: 401 - Completed in 0.0017s
2025-05-31 12:45:10,551 - AUTH - INFO - [36c140b3-0be2-4e4a-8402-07034d62aa92] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:45:10,552 - AUTH - INFO - [36c140b3-0be2-4e4a-8402-07034d62aa92] Request body for POST will be processed by endpoint.
2025-05-31 12:45:10,554 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:45:10,555 - AUTH - INFO - [36c140b3-0be2-4e4a-8402-07034d62aa92] Response status: 401 - Completed in 0.0026s
2025-05-31 12:45:11,530 - AUTH - INFO - [4dbe7442-057a-4848-917f-bab04e923d20] Request from 77.91.101.132:0 - POST /debug/auth/
2025-05-31 12:45:11,531 - AUTH - INFO - [4dbe7442-057a-4848-917f-bab04e923d20] Request body for POST will be processed by endpoint.
2025-05-31 12:45:11,532 - AUTH - WARNING - 

********************************************************************************
2025-05-31 12:45:11,533 - AUTH - WARNING - === Starting Debug Auth POST ===
2025-05-31 12:45:11,534 - AUTH - WARNING - ********************************************************************************
2025-05-31 12:45:11,534 - AUTH - DEBUG - Attempting to read request body for /debug/auth POST...
2025-05-31 12:45:11,535 - AUTH - INFO - Successfully read body for /debug/auth POST, length: 44
2025-05-31 12:45:11,536 - AUTH - DEBUG - Raw request body for /debug/auth POST: {"telegram_id":12345,"username":"test_user"}...
2025-05-31 12:45:11,536 - AUTH - DEBUG - Parsed JSON data for /debug/auth POST: {'telegram_id': 12345, 'username': 'test_user'}
2025-05-31 12:45:11,537 - AUTH - WARNING - Creating/fetching test user for /debug/auth: telegram_id=12345, username=test_user
2025-05-31 12:45:11,538 - AUTH - WARNING - User 12345 found in database, using existing user
2025-05-31 12:45:11,539 - backend.auth - DEBUG - JWT created for None (exp 2025-06-01 09:45:11.538847)
2025-05-31 12:45:11,539 - backend.auth - DEBUG - JWT created for test_user (exp 2025-06-01 09:45:11.539834)
2025-05-31 12:45:11,541 - AUTH - INFO - [4dbe7442-057a-4848-917f-bab04e923d20] Response status: 200 - Completed in 0.0093s
2025-05-31 12:45:16,106 - AUTH - INFO - [3021ffcd-a2bd-4128-abc1-b70dd6813690] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:45:16,109 - AUTH - INFO - [3021ffcd-a2bd-4128-abc1-b70dd6813690] Response status: 200 - Completed in 0.0026s
2025-05-31 12:48:48,218 - backend.auth - INFO - ================================================================================
2025-05-31 12:48:48,218 - backend.auth - INFO - Authentication module initialized
2025-05-31 12:48:48,219 - backend.auth - INFO - BOT_TOKEN: 80221..._4-bU (length: 46)
2025-05-31 12:48:48,219 - backend.auth - INFO - ================================================================================
2025-05-31 12:48:48,221 - AUTH - INFO - ================================================================================
2025-05-31 12:48:48,222 - AUTH - INFO - Starting Time Banking API
2025-05-31 12:48:48,223 - AUTH - INFO - ================================================================================
2025-05-31 12:48:48,223 - AUTH - INFO - Bot token: 80221..._4-bU (length: 46)
2025-05-31 12:49:06,497 - AUTH - INFO - [ac04a991-ed72-45ab-91fc-4b0467adf009] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:49:06,500 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:49:06,501 - AUTH - INFO - [ac04a991-ed72-45ab-91fc-4b0467adf009] Response status: 401 - Completed in 0.0030s
2025-05-31 12:49:07,314 - AUTH - INFO - [76f7912b-1e0f-4b31-b0bd-d967b9e5bf64] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:49:07,315 - AUTH - INFO - [76f7912b-1e0f-4b31-b0bd-d967b9e5bf64] Request body for POST will be processed by endpoint.
2025-05-31 12:49:07,316 - AUTH - INFO - 

********************************************************************************
2025-05-31 12:49:07,317 - AUTH - INFO - === Starting Telegram Authentication ===
2025-05-31 12:49:07,317 - AUTH - INFO - ********************************************************************************
2025-05-31 12:49:07,317 - AUTH - DEBUG - Request headers:
2025-05-31 12:49:07,318 - AUTH - DEBUG -   x-forwarded-proto: https
2025-05-31 12:49:07,318 - AUTH - DEBUG -   x-forwarded-host: 0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:49:07,318 - AUTH - DEBUG -   x-forwarded-for: 77.91.101.132
2025-05-31 12:49:07,318 - AUTH - DEBUG -   sec-fetch-site: same-origin
2025-05-31 12:49:07,319 - AUTH - DEBUG -   sec-fetch-mode: cors
2025-05-31 12:49:07,319 - AUTH - DEBUG -   sec-fetch-dest: empty
2025-05-31 12:49:07,319 - AUTH - DEBUG -   sec-ch-ua-platform: "Windows"
2025-05-31 12:49:07,320 - AUTH - DEBUG -   sec-ch-ua-mobile: ?0
2025-05-31 12:49:07,320 - AUTH - DEBUG -   sec-ch-ua: "Microsoft Edge";v="136", "Microsoft Edge WebView2";v="136", "Not.A/Brand";v="99", "Chromium";v="136"
2025-05-31 12:49:07,320 - AUTH - DEBUG -   referer: https://0e4c-77-91-101-132.ngrok-free.app/
2025-05-31 12:49:07,321 - AUTH - DEBUG -   priority: u=1, i
2025-05-31 12:49:07,321 - AUTH - DEBUG -   origin: https://0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:49:07,321 - AUTH - DEBUG -   cookie: abuse_interstitial=0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:49:07,321 - AUTH - DEBUG -   content-type: application/json
2025-05-31 12:49:07,322 - AUTH - DEBUG -   accept-language: ru,en;q=0.9,en-GB;q=0.8,en-US;q=0.7
2025-05-31 12:49:07,322 - AUTH - DEBUG -   accept-encoding: gzip, deflate, br, zstd
2025-05-31 12:49:07,322 - AUTH - DEBUG -   accept: application/json, text/plain, */*
2025-05-31 12:49:07,323 - AUTH - DEBUG -   content-length: 604
2025-05-31 12:49:07,324 - AUTH - DEBUG -   user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0
2025-05-31 12:49:07,324 - AUTH - DEBUG -   host: localhost:8000
2025-05-31 12:49:07,325 - AUTH - DEBUG -   connection: close
2025-05-31 12:49:07,325 - AUTH - DEBUG - Request method: POST
2025-05-31 12:49:07,326 - AUTH - DEBUG - POST request to /auth/telegram. Processing body...
2025-05-31 12:49:07,326 - AUTH - DEBUG - Attempt 1: Reading entire request body for POST with timeout...
2025-05-31 12:49:07,326 - AUTH - INFO - Successfully read entire body (POST), length: 604
2025-05-31 12:49:07,327 - AUTH - DEBUG - Raw request body (POST): {"init_data":"query_id=AAH6WM8oAwAAAPpYzyiDFv3E&user=%7B%22id%22%3A7127128314%2C%22first_name%22%3A%22alan%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22hendrix611%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2Fr_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg%22%7D&auth_date=1748684939&signature=Jbp7St_CDg48Kv5HQ4w4ZyxACJwrxSFDjRZ2ExFLYLIXRSF4j8N1nE4bmefy7c0V3Svd71Vq...
2025-05-31 12:49:07,327 - AUTH - DEBUG - Parsed JSON data: {'init_data': 'query_id=AAH6WM8oAwAAAPpYzyiDFv3E&user=%7B%22id%22%3A7127128314%2C%22first_name%22%3A%22alan%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22hendrix611%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2Fr_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg%22%7D&auth_date=1748684939&signature=Jbp7St_CDg48Kv5HQ4w4ZyxACJwrxSFDjRZ2ExFLYLIXRSF4j8N1nE4bmefy7c0V3Svd71VqIqQYKyjfUlxxAw&hash=4b9a159974bd3848ed1676f4b21aae31ca176b0465c13acfa404c6dbcc75f967', 'test_mode': False}
2025-05-31 12:49:07,328 - AUTH - INFO - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:49:07,328 - AUTH - DEBUG - Raw init_data: query_id=AAH6WM8oAwAAAPpYzyiDFv3E&user=%7B%22id%22%3A7127128314%2C%22first_name%22%3A%22alan%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22hendrix611%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2Fr_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg%22%7D&auth_date=1748684939&signature=Jbp7St_CDg48Kv5HQ4w4ZyxACJwrxSFDjRZ2ExFLYLIXRSF4j8N1nE4bmefy7c0V3Svd71VqIqQYKyjfUlxxAw&hash=4b9a159974bd3848ed1676f4b21aae31ca176b0465c13acfa404c6dbcc75f967
2025-05-31 12:49:07,329 - AUTH - DEBUG - Parsed data parameters count: 5
2025-05-31 12:49:07,329 - AUTH - DEBUG -   query_id: AAH6WM8oAwAAAPpYzyiDFv3E
2025-05-31 12:49:07,329 - AUTH - DEBUG -   user: [hidden for security]
2025-05-31 12:49:07,331 - AUTH - DEBUG -   auth_date: 1748684939
2025-05-31 12:49:07,331 - AUTH - DEBUG -   signature: Jbp7St_CDg48Kv5HQ4w4ZyxACJwrxSFDjRZ2ExFLYLIXRSF4j8N1nE4bmefy7c0V3Svd71VqIqQYKyjfUlxxAw
2025-05-31 12:49:07,332 - AUTH - DEBUG -   hash: [hidden for security]
2025-05-31 12:49:07,332 - AUTH - DEBUG - Extracted hash value length: 64
2025-05-31 12:49:07,332 - AUTH - INFO - Verifying Telegram hash...
2025-05-31 12:49:07,334 - backend.auth - DEBUG - 
==================================================
2025-05-31 12:49:07,334 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 12:49:07,335 - backend.auth - DEBUG - ==================================================
2025-05-31 12:49:07,336 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 12:49:07,336 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 12:49:07,337 - backend.auth - DEBUG - init_data (repr): 'query_id=AAH6WM8oAwAAAPpYzyiDFv3E&user=%7B%22id%22%3A7127128314%2C%22first_name%22%3A%22alan%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22hendrix611%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2Fr_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg%22%7D&auth_date=1748684939&signature=Jbp7St_CDg48Kv5HQ4w4ZyxACJwrxSFDjRZ2ExFLYLIXRSF4j8N1nE4bmefy7c0V3Svd71VqIqQYKyjfUlxxAw&hash=4b9a159974bd3848ed1676f4b21aae31ca176b0465c13acfa404c6dbcc75f967'
2025-05-31 12:49:07,338 - backend.auth - DEBUG - received_hash: 4b9a159974bd3848ed1676f4b21aae31ca176b0465c13acfa404c6dbcc75f967
2025-05-31 12:49:07,338 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAH6WM8oAwAAAPpYzyiDFv3E', 'user': '%7B%22id%22%3A7127128314%2C%22first_name%22%3A%22alan%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22hendrix611%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2Fr_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg%22%7D', 'auth_date': '1748684939', 'signature': 'Jbp7St_CDg48Kv5HQ4w4ZyxACJwrxSFDjRZ2ExFLYLIXRSF4j8N1nE4bmefy7c0V3Svd71VqIqQYKyjfUlxxAw'}
2025-05-31 12:49:07,339 - backend.auth - DEBUG - Hash from dictionary: 4b9a159974bd3848ed1676f4b21aae31ca176b0465c13acfa404c6dbcc75f967
2025-05-31 12:49:07,340 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748684939
query_id=AAH6WM8oAwAAAPpYzyiDFv3E
signature=Jbp7St_CDg48Kv5HQ4w4ZyxACJwrxSFDjRZ2ExFLYLIXRSF4j8N1nE4bmefy7c0V3Svd71VqIqQYKyjfUlxxAw
user={"id":7127128314,"first_name":"alan","last_name":"","username":"hendrix611","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/r_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg"}
2025-05-31 12:49:07,340 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 12:49:07,341 - backend.auth - DEBUG - Calculated hash: 4b9a159974bd3848ed1676f4b21aae31ca176b0465c13acfa404c6dbcc75f967
2025-05-31 12:49:07,342 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 12:49:07,342 - backend.auth - DEBUG - ==================================================

2025-05-31 12:49:07,343 - AUTH - INFO - Hash verification successful
2025-05-31 12:49:07,343 - AUTH - INFO - Parsing user data...
2025-05-31 12:49:07,344 - AUTH - DEBUG - Raw user data length: 343
2025-05-31 12:49:07,344 - AUTH - DEBUG - URL-decoded user data length: 239
2025-05-31 12:49:07,345 - AUTH - DEBUG - Parsed user_info: ID=7127128314, username=hendrix611
2025-05-31 12:49:07,345 - AUTH - DEBUG - Converted telegram_id to int: 7127128314 (type: <class 'int'>)
2025-05-31 12:49:07,346 - AUTH - INFO - Looking up user with telegram_id: 7127128314
2025-05-31 12:49:07,347 - AUTH - INFO - Creating new user with telegram_id: 7127128314
2025-05-31 12:49:07,348 - AUTH - DEBUG - Using username: hendrix611
2025-05-31 12:49:07,359 - AUTH - INFO - New user created: hendrix611 (ID: 4, Telegram ID: 7127128314)
2025-05-31 12:49:07,360 - AUTH - INFO - Creating JWT tokens for user: hendrix611
2025-05-31 12:49:07,365 - backend.auth - DEBUG - JWT created for hendrix611 (exp 2025-06-01 09:49:07.360541)
2025-05-31 12:49:07,367 - backend.auth - DEBUG - JWT created for hendrix611 (exp 2025-06-01 09:49:07.367134)
2025-05-31 12:49:07,368 - AUTH - INFO - === Authentication Successful ===
2025-05-31 12:49:07,368 - AUTH - INFO - ********************************************************************************


2025-05-31 12:49:07,369 - AUTH - INFO - [76f7912b-1e0f-4b31-b0bd-d967b9e5bf64] Response status: 200 - Completed in 0.0531s
2025-05-31 12:49:07,932 - AUTH - INFO - [131498c7-911f-4609-960a-ac2373eff5ec] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:49:07,942 - AUTH - INFO - [131498c7-911f-4609-960a-ac2373eff5ec] Response status: 200 - Completed in 0.0096s
2025-05-31 12:49:10,010 - AUTH - INFO - [f38bac18-630a-455d-80d9-a830b94ccb5b] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:49:10,013 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 4
2025-05-31 12:49:10,016 - AUTH - INFO - [GetTransactionPartners] Found 0 completed listings involving user 4
2025-05-31 12:49:10,017 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:49:10,017 - AUTH - INFO - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:49:10,019 - AUTH - INFO - [f38bac18-630a-455d-80d9-a830b94ccb5b] Response status: 200 - Completed in 0.0079s
2025-05-31 12:49:10,028 - AUTH - INFO - [bf5da8a5-8fa6-43c5-b015-3ad74356d621] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:49:10,031 - AUTH - INFO - [61bd9d9c-c5e3-481c-a770-52aeebe39838] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:49:10,041 - AUTH - INFO - [bf5da8a5-8fa6-43c5-b015-3ad74356d621] Response status: 200 - Completed in 0.0117s
2025-05-31 12:49:10,049 - AUTH - INFO - [61bd9d9c-c5e3-481c-a770-52aeebe39838] Response status: 200 - Completed in 0.0168s
2025-05-31 12:49:10,066 - AUTH - INFO - [a0a5f349-dc2b-42f6-b6f3-0e66d3d988c0] Request from 77.91.101.132:0 - GET /listings/user/4/
2025-05-31 12:49:10,075 - AUTH - INFO - [a0a5f349-dc2b-42f6-b6f3-0e66d3d988c0] Response status: 200 - Completed in 0.0080s
2025-05-31 12:49:10,215 - AUTH - INFO - [1b8c8110-694b-4608-8006-7a244e5708e4] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:49:10,217 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 4
2025-05-31 12:49:10,219 - AUTH - INFO - [GetTransactionPartners] Found 0 completed listings involving user 4
2025-05-31 12:49:10,219 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:49:10,220 - AUTH - INFO - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:49:10,221 - AUTH - INFO - [1b8c8110-694b-4608-8006-7a244e5708e4] Response status: 200 - Completed in 0.0055s
2025-05-31 12:49:10,253 - AUTH - INFO - [37d62eef-906f-4b5b-b340-b757b92e1ad1] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:49:10,255 - AUTH - INFO - [a629c790-ebc3-4f15-bf6b-3bbfdac87606] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:49:10,261 - AUTH - INFO - [37d62eef-906f-4b5b-b340-b757b92e1ad1] Response status: 200 - Completed in 0.0069s
2025-05-31 12:49:10,262 - AUTH - INFO - [a629c790-ebc3-4f15-bf6b-3bbfdac87606] Response status: 200 - Completed in 0.0068s
2025-05-31 12:49:10,270 - AUTH - INFO - [3d8ab861-9b90-49c9-a3fa-c2425cb83fcf] Request from 77.91.101.132:0 - GET /listings/user/4/
2025-05-31 12:49:10,275 - AUTH - INFO - [3d8ab861-9b90-49c9-a3fa-c2425cb83fcf] Response status: 200 - Completed in 0.0033s
2025-05-31 12:49:17,883 - AUTH - INFO - [e0df9447-8d82-40f3-a52a-3f3119e2ecf0] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:49:17,886 - AUTH - INFO - [88f7396c-4fec-4d34-8ebe-4fbc6401dfa5] Request from 77.91.101.132:0 - GET /listings/user/4/
2025-05-31 12:49:17,892 - AUTH - INFO - [c37b36b7-ade2-4940-a52a-f7769feb78ee] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:49:17,893 - AUTH - INFO - [a4886b93-ffe5-46da-984e-43c64b832d33] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:49:17,894 - AUTH - INFO - [e0df9447-8d82-40f3-a52a-3f3119e2ecf0] Response status: 200 - Completed in 0.0098s
2025-05-31 12:49:17,895 - AUTH - INFO - [88f7396c-4fec-4d34-8ebe-4fbc6401dfa5] Response status: 200 - Completed in 0.0087s
2025-05-31 12:49:17,900 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 4
2025-05-31 12:49:17,903 - AUTH - INFO - [GetTransactionPartners] Found 0 completed listings involving user 4
2025-05-31 12:49:17,903 - AUTH - INFO - [c37b36b7-ade2-4940-a52a-f7769feb78ee] Response status: 200 - Completed in 0.0103s
2025-05-31 12:49:17,904 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:49:17,905 - AUTH - INFO - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:49:17,907 - AUTH - INFO - [a4886b93-ffe5-46da-984e-43c64b832d33] Response status: 200 - Completed in 0.0141s
2025-05-31 12:49:18,057 - AUTH - INFO - [7963c9ad-6fa6-4025-a335-ac14392923b9] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:49:18,061 - AUTH - INFO - [7963c9ad-6fa6-4025-a335-ac14392923b9] Response status: 200 - Completed in 0.0033s
2025-05-31 12:49:18,066 - AUTH - INFO - [fc772269-f2d4-4588-9503-e3ba76140a67] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:49:18,068 - AUTH - INFO - [067a989e-a49c-4868-9ddf-aaf1dce2bd6d] Request from 77.91.101.132:0 - GET /listings/user/4/
2025-05-31 12:49:18,074 - AUTH - INFO - [fc772269-f2d4-4588-9503-e3ba76140a67] Response status: 200 - Completed in 0.0072s
2025-05-31 12:49:18,074 - AUTH - INFO - [067a989e-a49c-4868-9ddf-aaf1dce2bd6d] Response status: 200 - Completed in 0.0061s
2025-05-31 12:49:18,155 - AUTH - INFO - [b0d2eda3-1758-48dd-a81c-5a5f3ff03f49] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:49:18,157 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 4
2025-05-31 12:49:18,159 - AUTH - INFO - [GetTransactionPartners] Found 0 completed listings involving user 4
2025-05-31 12:49:18,159 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:49:18,159 - AUTH - INFO - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:49:18,160 - AUTH - INFO - [b0d2eda3-1758-48dd-a81c-5a5f3ff03f49] Response status: 200 - Completed in 0.0049s
2025-05-31 12:49:27,229 - AUTH - INFO - [24c930a9-72e3-4194-b8c9-38b1ed2f3771] Request from 77.91.101.132:0 - GET /users/search/
2025-05-31 12:49:27,230 - AUTH - INFO - [24c930a9-72e3-4194-b8c9-38b1ed2f3771] Query params: {'username': '@sar_a_to_v'}
2025-05-31 12:49:27,235 - AUTH - INFO - [24c930a9-72e3-4194-b8c9-38b1ed2f3771] Response status: 200 - Completed in 0.0043s
2025-05-31 12:49:28,414 - AUTH - INFO - [630e0172-a41f-4485-b000-2fde0f11248a] Request from 77.91.101.132:0 - GET /users/search/
2025-05-31 12:49:28,415 - AUTH - INFO - [630e0172-a41f-4485-b000-2fde0f11248a] Query params: {'username': '@sar_a_to_v'}
2025-05-31 12:49:28,419 - AUTH - INFO - [630e0172-a41f-4485-b000-2fde0f11248a] Response status: 200 - Completed in 0.0022s
2025-05-31 12:49:28,721 - AUTH - INFO - [8890b8ce-b45a-457b-b09f-099522a8f1c3] Request from 77.91.101.132:0 - GET /users/search/
2025-05-31 12:49:28,722 - AUTH - INFO - [8890b8ce-b45a-457b-b09f-099522a8f1c3] Query params: {'username': '@sar_a_to_v'}
2025-05-31 12:49:28,725 - AUTH - INFO - [8890b8ce-b45a-457b-b09f-099522a8f1c3] Response status: 200 - Completed in 0.0027s
2025-05-31 12:49:53,035 - AUTH - INFO - [6cbf55c7-3f11-4251-81f4-f37071693cfb] Request from 77.91.101.132:0 - GET /users/search/
2025-05-31 12:49:53,036 - AUTH - INFO - [6cbf55c7-3f11-4251-81f4-f37071693cfb] Query params: {'username': 'sar_a_to_v'}
2025-05-31 12:49:53,040 - AUTH - INFO - [6cbf55c7-3f11-4251-81f4-f37071693cfb] Response status: 200 - Completed in 0.0027s
2025-05-31 12:49:53,310 - AUTH - INFO - [d2743199-7f7b-4a28-a3e5-f1fa0ae9cb72] Request from 77.91.101.132:0 - GET /static/avatars/user_2_avatar_1748684660.jpg
2025-05-31 12:49:53,351 - AUTH - INFO - [d2743199-7f7b-4a28-a3e5-f1fa0ae9cb72] Response status: 200 - Completed in 0.0401s
2025-05-31 12:50:20,810 - AUTH - INFO - [9706ef1b-9cb7-47d5-b0f0-f835aec66430] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:50:20,812 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 12:50:20,813 - AUTH - INFO - [9706ef1b-9cb7-47d5-b0f0-f835aec66430] Response status: 401 - Completed in 0.0016s
2025-05-31 12:50:21,264 - AUTH - INFO - [6de621da-4cb4-438e-92e9-c5cb4352398e] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 12:50:21,265 - AUTH - INFO - [6de621da-4cb4-438e-92e9-c5cb4352398e] Request body for POST will be processed by endpoint.
2025-05-31 12:50:21,266 - AUTH - INFO - 

********************************************************************************
2025-05-31 12:50:21,266 - AUTH - INFO - === Starting Telegram Authentication ===
2025-05-31 12:50:21,266 - AUTH - INFO - ********************************************************************************
2025-05-31 12:50:21,267 - AUTH - DEBUG - Request headers:
2025-05-31 12:50:21,267 - AUTH - DEBUG -   x-forwarded-proto: https
2025-05-31 12:50:21,267 - AUTH - DEBUG -   x-forwarded-host: 0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:50:21,268 - AUTH - DEBUG -   x-forwarded-for: 77.91.101.132
2025-05-31 12:50:21,269 - AUTH - DEBUG -   sec-fetch-site: same-origin
2025-05-31 12:50:21,269 - AUTH - DEBUG -   sec-fetch-mode: cors
2025-05-31 12:50:21,269 - AUTH - DEBUG -   sec-fetch-dest: empty
2025-05-31 12:50:21,270 - AUTH - DEBUG -   sec-ch-ua-platform: "Windows"
2025-05-31 12:50:21,270 - AUTH - DEBUG -   sec-ch-ua-mobile: ?0
2025-05-31 12:50:21,271 - AUTH - DEBUG -   sec-ch-ua: "Microsoft Edge";v="136", "Microsoft Edge WebView2";v="136", "Not.A/Brand";v="99", "Chromium";v="136"
2025-05-31 12:50:21,271 - AUTH - DEBUG -   referer: https://0e4c-77-91-101-132.ngrok-free.app/
2025-05-31 12:50:21,272 - AUTH - DEBUG -   priority: u=1, i
2025-05-31 12:50:21,272 - AUTH - DEBUG -   origin: https://0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:50:21,272 - AUTH - DEBUG -   cookie: abuse_interstitial=0e4c-77-91-101-132.ngrok-free.app
2025-05-31 12:50:21,273 - AUTH - DEBUG -   content-type: application/json
2025-05-31 12:50:21,274 - AUTH - DEBUG -   accept-language: ru,en;q=0.9,en-GB;q=0.8,en-US;q=0.7
2025-05-31 12:50:21,274 - AUTH - DEBUG -   accept-encoding: gzip, deflate, br, zstd
2025-05-31 12:50:21,274 - AUTH - DEBUG -   accept: application/json, text/plain, */*
2025-05-31 12:50:21,274 - AUTH - DEBUG -   content-length: 604
2025-05-31 12:50:21,274 - AUTH - DEBUG -   user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0
2025-05-31 12:50:21,276 - AUTH - DEBUG -   host: localhost:8000
2025-05-31 12:50:21,276 - AUTH - DEBUG -   connection: close
2025-05-31 12:50:21,277 - AUTH - DEBUG - Request method: POST
2025-05-31 12:50:21,277 - AUTH - DEBUG - POST request to /auth/telegram. Processing body...
2025-05-31 12:50:21,277 - AUTH - DEBUG - Attempt 1: Reading entire request body for POST with timeout...
2025-05-31 12:50:21,278 - AUTH - INFO - Successfully read entire body (POST), length: 604
2025-05-31 12:50:21,278 - AUTH - DEBUG - Raw request body (POST): {"init_data":"query_id=AAH6WM8oAwAAAPpYzyjJDsXG&user=%7B%22id%22%3A7127128314%2C%22first_name%22%3A%22alan%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22hendrix611%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2Fr_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg%22%7D&auth_date=1748685015&signature=fPz92uNkDrE7jWfzGEreoyYbuRwNpuC7Ci9arSvuvGgerQo3hcYVyQX8o0xHVEIifrsQxoqZ...
2025-05-31 12:50:21,279 - AUTH - DEBUG - Parsed JSON data: {'init_data': 'query_id=AAH6WM8oAwAAAPpYzyjJDsXG&user=%7B%22id%22%3A7127128314%2C%22first_name%22%3A%22alan%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22hendrix611%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2Fr_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg%22%7D&auth_date=1748685015&signature=fPz92uNkDrE7jWfzGEreoyYbuRwNpuC7Ci9arSvuvGgerQo3hcYVyQX8o0xHVEIifrsQxoqZoOUYkL3rUl0hAQ&hash=0bd9baabfa20eb802eccea25e9644a2520d5d593d8b8cef1e2ebbf4fcc5392d6', 'test_mode': False}
2025-05-31 12:50:21,279 - AUTH - INFO - Got init_data from JSON body (POST), test_mode=False
2025-05-31 12:50:21,279 - AUTH - DEBUG - Raw init_data: query_id=AAH6WM8oAwAAAPpYzyjJDsXG&user=%7B%22id%22%3A7127128314%2C%22first_name%22%3A%22alan%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22hendrix611%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2Fr_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg%22%7D&auth_date=1748685015&signature=fPz92uNkDrE7jWfzGEreoyYbuRwNpuC7Ci9arSvuvGgerQo3hcYVyQX8o0xHVEIifrsQxoqZoOUYkL3rUl0hAQ&hash=0bd9baabfa20eb802eccea25e9644a2520d5d593d8b8cef1e2ebbf4fcc5392d6
2025-05-31 12:50:21,280 - AUTH - DEBUG - Parsed data parameters count: 5
2025-05-31 12:50:21,280 - AUTH - DEBUG -   query_id: AAH6WM8oAwAAAPpYzyjJDsXG
2025-05-31 12:50:21,280 - AUTH - DEBUG -   user: [hidden for security]
2025-05-31 12:50:21,281 - AUTH - DEBUG -   auth_date: 1748685015
2025-05-31 12:50:21,281 - AUTH - DEBUG -   signature: fPz92uNkDrE7jWfzGEreoyYbuRwNpuC7Ci9arSvuvGgerQo3hcYVyQX8o0xHVEIifrsQxoqZoOUYkL3rUl0hAQ
2025-05-31 12:50:21,282 - AUTH - DEBUG -   hash: [hidden for security]
2025-05-31 12:50:21,282 - AUTH - DEBUG - Extracted hash value length: 64
2025-05-31 12:50:21,283 - AUTH - INFO - Verifying Telegram hash...
2025-05-31 12:50:21,283 - backend.auth - DEBUG - 
==================================================
2025-05-31 12:50:21,284 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 12:50:21,285 - backend.auth - DEBUG - ==================================================
2025-05-31 12:50:21,285 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 12:50:21,286 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 12:50:21,286 - backend.auth - DEBUG - init_data (repr): 'query_id=AAH6WM8oAwAAAPpYzyjJDsXG&user=%7B%22id%22%3A7127128314%2C%22first_name%22%3A%22alan%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22hendrix611%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2Fr_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg%22%7D&auth_date=1748685015&signature=fPz92uNkDrE7jWfzGEreoyYbuRwNpuC7Ci9arSvuvGgerQo3hcYVyQX8o0xHVEIifrsQxoqZoOUYkL3rUl0hAQ&hash=0bd9baabfa20eb802eccea25e9644a2520d5d593d8b8cef1e2ebbf4fcc5392d6'
2025-05-31 12:50:21,287 - backend.auth - DEBUG - received_hash: 0bd9baabfa20eb802eccea25e9644a2520d5d593d8b8cef1e2ebbf4fcc5392d6
2025-05-31 12:50:21,287 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAH6WM8oAwAAAPpYzyjJDsXG', 'user': '%7B%22id%22%3A7127128314%2C%22first_name%22%3A%22alan%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22hendrix611%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2Fr_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg%22%7D', 'auth_date': '1748685015', 'signature': 'fPz92uNkDrE7jWfzGEreoyYbuRwNpuC7Ci9arSvuvGgerQo3hcYVyQX8o0xHVEIifrsQxoqZoOUYkL3rUl0hAQ'}
2025-05-31 12:50:21,288 - backend.auth - DEBUG - Hash from dictionary: 0bd9baabfa20eb802eccea25e9644a2520d5d593d8b8cef1e2ebbf4fcc5392d6
2025-05-31 12:50:21,289 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748685015
query_id=AAH6WM8oAwAAAPpYzyjJDsXG
signature=fPz92uNkDrE7jWfzGEreoyYbuRwNpuC7Ci9arSvuvGgerQo3hcYVyQX8o0xHVEIifrsQxoqZoOUYkL3rUl0hAQ
user={"id":7127128314,"first_name":"alan","last_name":"","username":"hendrix611","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/r_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg"}
2025-05-31 12:50:21,290 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 12:50:21,290 - backend.auth - DEBUG - Calculated hash: 0bd9baabfa20eb802eccea25e9644a2520d5d593d8b8cef1e2ebbf4fcc5392d6
2025-05-31 12:50:21,291 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 12:50:21,291 - backend.auth - DEBUG - ==================================================

2025-05-31 12:50:21,292 - AUTH - INFO - Hash verification successful
2025-05-31 12:50:21,292 - AUTH - INFO - Parsing user data...
2025-05-31 12:50:21,293 - AUTH - DEBUG - Raw user data length: 343
2025-05-31 12:50:21,293 - AUTH - DEBUG - URL-decoded user data length: 239
2025-05-31 12:50:21,294 - AUTH - DEBUG - Parsed user_info: ID=7127128314, username=hendrix611
2025-05-31 12:50:21,294 - AUTH - DEBUG - Converted telegram_id to int: 7127128314 (type: <class 'int'>)
2025-05-31 12:50:21,295 - AUTH - INFO - Looking up user with telegram_id: 7127128314
2025-05-31 12:50:21,297 - AUTH - INFO - Found existing user: hendrix611 (ID: 4, Telegram ID: 7127128314)
2025-05-31 12:50:21,297 - AUTH - INFO - Creating JWT tokens for user: hendrix611
2025-05-31 12:50:21,298 - backend.auth - DEBUG - JWT created for hendrix611 (exp 2025-06-01 09:50:21.297653)
2025-05-31 12:50:21,298 - backend.auth - DEBUG - JWT created for hendrix611 (exp 2025-06-01 09:50:21.298746)
2025-05-31 12:50:21,299 - AUTH - INFO - === Authentication Successful ===
2025-05-31 12:50:21,300 - AUTH - INFO - ********************************************************************************


2025-05-31 12:50:21,301 - AUTH - INFO - [6de621da-4cb4-438e-92e9-c5cb4352398e] Response status: 200 - Completed in 0.0356s
2025-05-31 12:50:21,465 - AUTH - INFO - [d0b6f27d-cc27-4d02-b28f-8d6f15308bab] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:50:21,469 - AUTH - INFO - [d0b6f27d-cc27-4d02-b28f-8d6f15308bab] Response status: 200 - Completed in 0.0034s
2025-05-31 12:50:23,676 - AUTH - INFO - [2f8cc889-ee97-4003-b87f-21d2035fa4c0] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:50:23,678 - AUTH - INFO - [a0f801d5-9f47-4a8a-9587-b3199449a957] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:50:23,680 - AUTH - INFO - [1ca04930-a5b0-49f8-ad64-81e2707d9a9c] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:50:23,686 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 4
2025-05-31 12:50:23,690 - AUTH - INFO - [2f8cc889-ee97-4003-b87f-21d2035fa4c0] Response status: 200 - Completed in 0.0129s
2025-05-31 12:50:23,692 - AUTH - INFO - [a0f801d5-9f47-4a8a-9587-b3199449a957] Response status: 200 - Completed in 0.0137s
2025-05-31 12:50:23,692 - AUTH - INFO - [GetTransactionPartners] Found 0 completed listings involving user 4
2025-05-31 12:50:23,694 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:50:23,695 - AUTH - INFO - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:50:23,701 - AUTH - INFO - [1ca04930-a5b0-49f8-ad64-81e2707d9a9c] Response status: 200 - Completed in 0.0214s
2025-05-31 12:50:23,705 - AUTH - INFO - [8b12390f-19b5-418b-bd2d-1ee358fdd1c1] Request from 77.91.101.132:0 - GET /listings/user/4/
2025-05-31 12:50:23,710 - AUTH - INFO - [8b12390f-19b5-418b-bd2d-1ee358fdd1c1] Response status: 200 - Completed in 0.0044s
2025-05-31 12:50:23,874 - AUTH - INFO - [51c31c60-84a8-42b6-bd69-91dce17ac901] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 12:50:23,876 - AUTH - INFO - [91a4e36c-a14a-4a91-8e4c-7212c259fc2d] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 12:50:23,879 - AUTH - INFO - [f582c60a-6bf6-475b-b44c-172698791b63] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 12:50:23,885 - AUTH - INFO - [51c31c60-84a8-42b6-bd69-91dce17ac901] Response status: 200 - Completed in 0.0100s
2025-05-31 12:50:23,888 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 4
2025-05-31 12:50:23,888 - AUTH - INFO - [91a4e36c-a14a-4a91-8e4c-7212c259fc2d] Response status: 200 - Completed in 0.0109s
2025-05-31 12:50:23,890 - AUTH - INFO - [GetTransactionPartners] Found 0 completed listings involving user 4
2025-05-31 12:50:23,891 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 12:50:23,893 - AUTH - INFO - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 12:50:23,895 - AUTH - INFO - [f582c60a-6bf6-475b-b44c-172698791b63] Response status: 200 - Completed in 0.0137s
2025-05-31 12:50:23,952 - AUTH - INFO - [1ea26932-e144-4125-b2be-3097d6247a3a] Request from 77.91.101.132:0 - GET /listings/user/4/
2025-05-31 12:50:23,956 - AUTH - INFO - [1ea26932-e144-4125-b2be-3097d6247a3a] Response status: 200 - Completed in 0.0033s
2025-05-31 12:50:32,423 - AUTH - INFO - [494542e6-6da0-4da0-b851-87144370d0f7] Request from 77.91.101.132:0 - GET /users/search/
2025-05-31 12:50:32,424 - AUTH - INFO - [494542e6-6da0-4da0-b851-87144370d0f7] Query params: {'username': 'sar_a_to_v'}
2025-05-31 12:50:32,427 - AUTH - INFO - [494542e6-6da0-4da0-b851-87144370d0f7] Response status: 200 - Completed in 0.0027s
2025-05-31 12:50:32,692 - AUTH - INFO - [28617bd2-ab7e-4b43-8e9a-8d48592326ce] Request from 77.91.101.132:0 - GET /static/avatars/user_2_avatar_1748684660.jpg
2025-05-31 12:50:32,694 - AUTH - INFO - [28617bd2-ab7e-4b43-8e9a-8d48592326ce] Response status: 304 - Completed in 0.0011s
2025-05-31 12:54:09,110 - AUTH - INFO - [6a35684a-f0fd-451c-8bdb-fb2e08a26857] Request from 77.91.101.132:0 - POST /listings/
2025-05-31 12:54:09,111 - AUTH - INFO - [6a35684a-f0fd-451c-8bdb-fb2e08a26857] Request body for POST will be processed by endpoint.
2025-05-31 12:54:09,128 - AUTH - INFO - [6a35684a-f0fd-451c-8bdb-fb2e08a26857] Response status: 200 - Completed in 0.0164s
2025-05-31 12:54:25,739 - AUTH - INFO - [edb2c763-2c83-4d51-a338-cd067969aad4] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 12:54:25,741 - AUTH - INFO - [edb2c763-2c83-4d51-a338-cd067969aad4] Response status: 200 - Completed in 0.0016s
2025-05-31 12:54:25,910 - AUTH - INFO - [a573d94b-f667-47d6-a786-569e017c5ed9] Request from 77.91.101.132:0 - GET /user/me/
2025-05-31 12:54:25,913 - AUTH - DEBUG - [GetUserMe] Attempting to get current user.
2025-05-31 12:54:25,913 - AUTH - DEBUG - [GetUserMe] Token SUB: 2. Fetching user from DB.
2025-05-31 12:54:25,915 - AUTH - INFO - [GetUserMe] User sar_a_to_v (ID: 2) found. Avatar path from DB to be returned: '/static/avatars/user_2_avatar_1748684660.jpg'
2025-05-31 12:54:25,916 - AUTH - INFO - [a573d94b-f667-47d6-a786-569e017c5ed9] Response status: 200 - Completed in 0.0049s
2025-05-31 12:54:26,108 - AUTH - INFO - [d326e31f-8f04-4175-9b82-c5c62474dd9b] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 12:54:26,114 - AUTH - INFO - [d326e31f-8f04-4175-9b82-c5c62474dd9b] Response status: 200 - Completed in 0.0049s
2025-05-31 12:54:31,583 - AUTH - INFO - [ab266f30-025d-4fd7-9810-db4c16d0a984] Request from 77.91.101.132:0 - POST /listings/12/apply/
2025-05-31 12:54:31,584 - AUTH - INFO - [ab266f30-025d-4fd7-9810-db4c16d0a984] Request body for POST will be processed by endpoint.
2025-05-31 12:54:31,598 - AUTH - INFO - [ab266f30-025d-4fd7-9810-db4c16d0a984] Response status: 200 - Completed in 0.0136s
2025-05-31 12:58:48,386 - backend.auth - INFO - ================================================================================
2025-05-31 12:58:48,387 - backend.auth - INFO - Authentication module initialized
2025-05-31 12:58:48,387 - backend.auth - INFO - BOT_TOKEN: 80221..._4-bU (length: 46)
2025-05-31 12:58:48,388 - backend.auth - INFO - ================================================================================
2025-05-31 12:58:48,389 - AUTH - INFO - ================================================================================
2025-05-31 12:58:48,390 - AUTH - INFO - Starting Time Banking API
2025-05-31 12:58:48,390 - AUTH - INFO - ================================================================================
2025-05-31 12:58:48,391 - AUTH - INFO - Bot token: 80221..._4-bU (length: 46)
2025-05-31 13:18:09,027 - AUTH - INFO - [580b4c75-6273-4938-99d1-12770030d41d] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 13:18:09,033 - AUTH - INFO - [580b4c75-6273-4938-99d1-12770030d41d] Response status: 200 - Completed in 0.0055s
2025-05-31 13:18:09,244 - AUTH - INFO - [f5942540-ac50-4192-b68f-66fad4442d74] Request from 77.91.101.132:0 - GET /user/me/
2025-05-31 13:18:09,245 - AUTH - DEBUG - [GetUserMe] Attempting to get current user.
2025-05-31 13:18:09,246 - AUTH - DEBUG - [GetUserMe] Token SUB: 2. Fetching user from DB.
2025-05-31 13:18:09,248 - AUTH - INFO - [GetUserMe] User sar_a_to_v (ID: 2) found. Avatar path from DB to be returned: '/static/avatars/user_2_avatar_1748684660.jpg'
2025-05-31 13:18:09,250 - AUTH - INFO - [f5942540-ac50-4192-b68f-66fad4442d74] Response status: 200 - Completed in 0.0059s
2025-05-31 13:18:09,460 - AUTH - INFO - [094c2be3-dd96-4f72-af29-c0e57c7003f3] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 13:18:09,470 - AUTH - INFO - [094c2be3-dd96-4f72-af29-c0e57c7003f3] Response status: 200 - Completed in 0.0086s
2025-05-31 13:18:11,486 - AUTH - INFO - [8dd22e6d-036b-4b11-9119-81842ab47c66] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 13:18:11,497 - AUTH - INFO - [8dd22e6d-036b-4b11-9119-81842ab47c66] Response status: 200 - Completed in 0.0098s
2025-05-31 13:18:11,547 - AUTH - INFO - [3f043974-3ef6-4acf-9bf5-97de016f206b] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 13:18:11,549 - AUTH - INFO - [1e659dbd-09c0-4e4c-9eac-3ef80c7337c6] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 13:18:11,551 - AUTH - INFO - [be8241e8-3faa-4494-a985-727aa9d88dc0] Request from 77.91.101.132:0 - GET /static/avatars/user_2_avatar_1748684660.jpg
2025-05-31 13:18:11,551 - AUTH - INFO - [72790309-4e75-4c63-baa1-160777a04de1] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 13:18:11,562 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 13:18:11,571 - AUTH - INFO - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 13:18:11,573 - AUTH - DEBUG - [GetTransactionPartners] Added partner_id 3 (from listing 11, user was creator)
2025-05-31 13:18:11,573 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 13:18:11,575 - AUTH - INFO - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 13:18:11,575 - AUTH - DEBUG - [GetTransactionPartners] Returning partner 1: ID=3, Username=en7ka
2025-05-31 13:18:11,615 - AUTH - INFO - [3f043974-3ef6-4acf-9bf5-97de016f206b] Response status: 200 - Completed in 0.0668s
2025-05-31 13:18:11,615 - AUTH - INFO - [be8241e8-3faa-4494-a985-727aa9d88dc0] Response status: 304 - Completed in 0.0637s
2025-05-31 13:18:11,618 - AUTH - INFO - [72790309-4e75-4c63-baa1-160777a04de1] Response status: 200 - Completed in 0.0657s
2025-05-31 13:18:11,620 - AUTH - INFO - [1e659dbd-09c0-4e4c-9eac-3ef80c7337c6] Response status: 200 - Completed in 0.0701s
2025-05-31 13:18:11,659 - AUTH - INFO - [015d05fe-3354-4b2d-a6df-627f380c22e7] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 13:18:11,663 - AUTH - INFO - [015d05fe-3354-4b2d-a6df-627f380c22e7] Response status: 200 - Completed in 0.0027s
2025-05-31 13:18:11,795 - AUTH - INFO - [d0222c6b-d7fe-4011-8dab-0c961fd22697] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 13:18:11,796 - AUTH - INFO - [c1e0ffcc-1822-4c61-a36d-7530350c3791] Request from 77.91.101.132:0 - GET /listings/user/2/
2025-05-31 13:18:11,798 - AUTH - INFO - [11e77dfe-9608-4321-b961-1184e8e87d60] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 13:18:11,801 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 2
2025-05-31 13:18:11,806 - AUTH - INFO - [11e77dfe-9608-4321-b961-1184e8e87d60] Response status: 200 - Completed in 0.0077s
2025-05-31 13:18:11,807 - AUTH - INFO - [GetTransactionPartners] Found 1 completed listings involving user 2
2025-05-31 13:18:11,808 - AUTH - DEBUG - [GetTransactionPartners] Added partner_id 3 (from listing 11, user was creator)
2025-05-31 13:18:11,809 - AUTH - INFO - [c1e0ffcc-1822-4c61-a36d-7530350c3791] Response status: 200 - Completed in 0.0118s
2025-05-31 13:18:11,810 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: {3}
2025-05-31 13:18:11,812 - AUTH - INFO - [GetTransactionPartners] Fetched 1 partner user objects from DB.
2025-05-31 13:18:11,815 - AUTH - DEBUG - [GetTransactionPartners] Returning partner 1: ID=3, Username=en7ka
2025-05-31 13:18:11,816 - AUTH - INFO - [d0222c6b-d7fe-4011-8dab-0c961fd22697] Response status: 200 - Completed in 0.0202s
2025-05-31 13:18:17,035 - AUTH - INFO - [a251413a-cad6-40f1-9fe5-ab2f32b4f7b8] Request from 77.91.101.132:0 - GET /users/search/
2025-05-31 13:18:17,035 - AUTH - INFO - [a251413a-cad6-40f1-9fe5-ab2f32b4f7b8] Query params: {'username': 'en7ka'}
2025-05-31 13:18:17,040 - AUTH - INFO - [a251413a-cad6-40f1-9fe5-ab2f32b4f7b8] Response status: 200 - Completed in 0.0038s
2025-05-31 13:18:18,940 - AUTH - INFO - [dd0cafd1-64e9-4fc0-af57-208cdb9adf67] Request from 77.91.101.132:0 - POST /friends/request/
2025-05-31 13:18:18,941 - AUTH - INFO - [dd0cafd1-64e9-4fc0-af57-208cdb9adf67] Request body for POST will be processed by endpoint.
2025-05-31 13:18:18,945 - AUTH - ERROR - HTTP exception: 400 - Friend request already exists
2025-05-31 13:18:18,946 - AUTH - INFO - [dd0cafd1-64e9-4fc0-af57-208cdb9adf67] Response status: 400 - Completed in 0.0049s
2025-05-31 13:18:21,051 - AUTH - INFO - [e14cff85-77be-4eff-9ba2-30b7eb3c0460] Request from 77.91.101.132:0 - POST /friends/request/
2025-05-31 13:18:21,051 - AUTH - INFO - [e14cff85-77be-4eff-9ba2-30b7eb3c0460] Request body for POST will be processed by endpoint.
2025-05-31 13:18:21,055 - AUTH - ERROR - HTTP exception: 400 - Friend request already exists
2025-05-31 13:18:21,056 - AUTH - INFO - [e14cff85-77be-4eff-9ba2-30b7eb3c0460] Response status: 400 - Completed in 0.0037s
2025-05-31 13:18:22,895 - AUTH - INFO - [ce10fde1-2666-4dd5-a432-9af4b452faf8] Request from 77.91.101.132:0 - POST /friends/request/
2025-05-31 13:18:22,896 - AUTH - INFO - [ce10fde1-2666-4dd5-a432-9af4b452faf8] Request body for POST will be processed by endpoint.
2025-05-31 13:18:22,900 - AUTH - ERROR - HTTP exception: 400 - Friend request already exists
2025-05-31 13:18:22,901 - AUTH - INFO - [ce10fde1-2666-4dd5-a432-9af4b452faf8] Response status: 400 - Completed in 0.0037s
2025-05-31 13:18:33,342 - AUTH - INFO - [ccc81bcf-c2a4-49a6-9396-4837c86aa4b5] Request from 77.91.101.132:0 - GET /users/search/
2025-05-31 13:18:33,343 - AUTH - INFO - [ccc81bcf-c2a4-49a6-9396-4837c86aa4b5] Query params: {'username': 'hendrix'}
2025-05-31 13:18:33,346 - AUTH - INFO - [ccc81bcf-c2a4-49a6-9396-4837c86aa4b5] Response status: 200 - Completed in 0.0033s
2025-05-31 13:18:34,735 - AUTH - INFO - [532c0847-5f98-4809-9a9f-336a8c8b99b1] Request from 77.91.101.132:0 - POST /friends/request/
2025-05-31 13:18:34,736 - AUTH - INFO - [532c0847-5f98-4809-9a9f-336a8c8b99b1] Request body for POST will be processed by endpoint.
2025-05-31 13:18:34,753 - AUTH - INFO - [532c0847-5f98-4809-9a9f-336a8c8b99b1] Response status: 200 - Completed in 0.0170s
2025-05-31 13:18:34,995 - AUTH - INFO - [e5f2b29e-d483-412b-95ea-4a39b2ca9015] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 13:18:34,999 - AUTH - INFO - [e5f2b29e-d483-412b-95ea-4a39b2ca9015] Response status: 200 - Completed in 0.0033s
2025-05-31 13:18:49,042 - AUTH - INFO - [d7432c08-7bde-47db-8879-f484ef51982f] Request from 77.91.101.132:0 - GET /auth/protected/
2025-05-31 13:18:49,044 - AUTH - ERROR - HTTP exception: 401 - Not authenticated
2025-05-31 13:18:49,045 - AUTH - INFO - [d7432c08-7bde-47db-8879-f484ef51982f] Response status: 401 - Completed in 0.0016s
2025-05-31 13:18:49,594 - AUTH - INFO - [2e54a2d0-aa12-41a6-9d6a-bdee268ec740] Request from 77.91.101.132:0 - POST /auth/telegram/
2025-05-31 13:18:49,595 - AUTH - INFO - [2e54a2d0-aa12-41a6-9d6a-bdee268ec740] Request body for POST will be processed by endpoint.
2025-05-31 13:18:49,596 - AUTH - INFO - 

********************************************************************************
2025-05-31 13:18:49,596 - AUTH - INFO - === Starting Telegram Authentication ===
2025-05-31 13:18:49,597 - AUTH - INFO - ********************************************************************************
2025-05-31 13:18:49,597 - AUTH - DEBUG - Request headers:
2025-05-31 13:18:49,598 - AUTH - DEBUG -   x-forwarded-proto: https
2025-05-31 13:18:49,598 - AUTH - DEBUG -   x-forwarded-host: 0e4c-77-91-101-132.ngrok-free.app
2025-05-31 13:18:49,598 - AUTH - DEBUG -   x-forwarded-for: 77.91.101.132
2025-05-31 13:18:49,598 - AUTH - DEBUG -   sec-fetch-site: same-origin
2025-05-31 13:18:49,599 - AUTH - DEBUG -   sec-fetch-mode: cors
2025-05-31 13:18:49,599 - AUTH - DEBUG -   sec-fetch-dest: empty
2025-05-31 13:18:49,599 - AUTH - DEBUG -   sec-ch-ua-platform: "Windows"
2025-05-31 13:18:49,600 - AUTH - DEBUG -   sec-ch-ua-mobile: ?0
2025-05-31 13:18:49,600 - AUTH - DEBUG -   sec-ch-ua: "Microsoft Edge";v="136", "Microsoft Edge WebView2";v="136", "Not.A/Brand";v="99", "Chromium";v="136"
2025-05-31 13:18:49,601 - AUTH - DEBUG -   referer: https://0e4c-77-91-101-132.ngrok-free.app/
2025-05-31 13:18:49,601 - AUTH - DEBUG -   priority: u=1, i
2025-05-31 13:18:49,601 - AUTH - DEBUG -   origin: https://0e4c-77-91-101-132.ngrok-free.app
2025-05-31 13:18:49,602 - AUTH - DEBUG -   cookie: abuse_interstitial=0e4c-77-91-101-132.ngrok-free.app
2025-05-31 13:18:49,602 - AUTH - DEBUG -   content-type: application/json
2025-05-31 13:18:49,602 - AUTH - DEBUG -   accept-language: ru,en;q=0.9,en-GB;q=0.8,en-US;q=0.7
2025-05-31 13:18:49,604 - AUTH - DEBUG -   accept-encoding: gzip, deflate, br, zstd
2025-05-31 13:18:49,604 - AUTH - DEBUG -   accept: application/json, text/plain, */*
2025-05-31 13:18:49,604 - AUTH - DEBUG -   content-length: 604
2025-05-31 13:18:49,604 - AUTH - DEBUG -   user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0
2025-05-31 13:18:49,604 - AUTH - DEBUG -   host: localhost:8000
2025-05-31 13:18:49,606 - AUTH - DEBUG -   connection: close
2025-05-31 13:18:49,606 - AUTH - DEBUG - Request method: POST
2025-05-31 13:18:49,607 - AUTH - DEBUG - POST request to /auth/telegram. Processing body...
2025-05-31 13:18:49,607 - AUTH - DEBUG - Attempt 1: Reading entire request body for POST with timeout...
2025-05-31 13:18:49,608 - AUTH - INFO - Successfully read entire body (POST), length: 604
2025-05-31 13:18:49,608 - AUTH - DEBUG - Raw request body (POST): {"init_data":"query_id=AAH6WM8oAwAAAPpYzyg2F6_k&user=%7B%22id%22%3A7127128314%2C%22first_name%22%3A%22alan%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22hendrix611%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2Fr_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg%22%7D&auth_date=1748686719&signature=3TzIqMw0oLnzdwWA-hitiiB_RYPqupegIWk3MzMRhnKRYG6Rc8LniDW4_IVy5gzD9cM2zOoM...
2025-05-31 13:18:49,609 - AUTH - DEBUG - Parsed JSON data: {'init_data': 'query_id=AAH6WM8oAwAAAPpYzyg2F6_k&user=%7B%22id%22%3A7127128314%2C%22first_name%22%3A%22alan%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22hendrix611%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2Fr_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg%22%7D&auth_date=1748686719&signature=3TzIqMw0oLnzdwWA-hitiiB_RYPqupegIWk3MzMRhnKRYG6Rc8LniDW4_IVy5gzD9cM2zOoM7nYsJqdzgRPNBA&hash=b2203b61ded320ec11bdf71d38c54eded30b9579ca859de2390b289c24163d15', 'test_mode': False}
2025-05-31 13:18:49,609 - AUTH - INFO - Got init_data from JSON body (POST), test_mode=False
2025-05-31 13:18:49,610 - AUTH - DEBUG - Raw init_data: query_id=AAH6WM8oAwAAAPpYzyg2F6_k&user=%7B%22id%22%3A7127128314%2C%22first_name%22%3A%22alan%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22hendrix611%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2Fr_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg%22%7D&auth_date=1748686719&signature=3TzIqMw0oLnzdwWA-hitiiB_RYPqupegIWk3MzMRhnKRYG6Rc8LniDW4_IVy5gzD9cM2zOoM7nYsJqdzgRPNBA&hash=b2203b61ded320ec11bdf71d38c54eded30b9579ca859de2390b289c24163d15
2025-05-31 13:18:49,610 - AUTH - DEBUG - Parsed data parameters count: 5
2025-05-31 13:18:49,610 - AUTH - DEBUG -   query_id: AAH6WM8oAwAAAPpYzyg2F6_k
2025-05-31 13:18:49,611 - AUTH - DEBUG -   user: [hidden for security]
2025-05-31 13:18:49,611 - AUTH - DEBUG -   auth_date: 1748686719
2025-05-31 13:18:49,611 - AUTH - DEBUG -   signature: 3TzIqMw0oLnzdwWA-hitiiB_RYPqupegIWk3MzMRhnKRYG6Rc8LniDW4_IVy5gzD9cM2zOoM7nYsJqdzgRPNBA
2025-05-31 13:18:49,612 - AUTH - DEBUG -   hash: [hidden for security]
2025-05-31 13:18:49,612 - AUTH - DEBUG - Extracted hash value length: 64
2025-05-31 13:18:49,612 - AUTH - INFO - Verifying Telegram hash...
2025-05-31 13:18:49,613 - backend.auth - DEBUG - 
==================================================
2025-05-31 13:18:49,613 - backend.auth - DEBUG - Starting Telegram WebApp hash verification
2025-05-31 13:18:49,613 - backend.auth - DEBUG - ==================================================
2025-05-31 13:18:49,615 - backend.auth - DEBUG - BOT_TOKEN (repr): '8022193791:AAEAt9a6kBmP28XN60P8d0HmPKG4n9_4-bU'
2025-05-31 13:18:49,615 - backend.auth - DEBUG - BOT_TOKEN length: 46
2025-05-31 13:18:49,616 - backend.auth - DEBUG - init_data (repr): 'query_id=AAH6WM8oAwAAAPpYzyg2F6_k&user=%7B%22id%22%3A7127128314%2C%22first_name%22%3A%22alan%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22hendrix611%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2Fr_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg%22%7D&auth_date=1748686719&signature=3TzIqMw0oLnzdwWA-hitiiB_RYPqupegIWk3MzMRhnKRYG6Rc8LniDW4_IVy5gzD9cM2zOoM7nYsJqdzgRPNBA&hash=b2203b61ded320ec11bdf71d38c54eded30b9579ca859de2390b289c24163d15'
2025-05-31 13:18:49,616 - backend.auth - DEBUG - received_hash: b2203b61ded320ec11bdf71d38c54eded30b9579ca859de2390b289c24163d15
2025-05-31 13:18:49,617 - backend.auth - DEBUG - Parsed data dict: {'query_id': 'AAH6WM8oAwAAAPpYzyg2F6_k', 'user': '%7B%22id%22%3A7127128314%2C%22first_name%22%3A%22alan%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22hendrix611%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2Fr_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg%22%7D', 'auth_date': '1748686719', 'signature': '3TzIqMw0oLnzdwWA-hitiiB_RYPqupegIWk3MzMRhnKRYG6Rc8LniDW4_IVy5gzD9cM2zOoM7nYsJqdzgRPNBA'}
2025-05-31 13:18:49,618 - backend.auth - DEBUG - Hash from dictionary: b2203b61ded320ec11bdf71d38c54eded30b9579ca859de2390b289c24163d15
2025-05-31 13:18:49,618 - backend.auth - DEBUG - Data check string (values URL-decoded): auth_date=1748686719
query_id=AAH6WM8oAwAAAPpYzyg2F6_k
signature=3TzIqMw0oLnzdwWA-hitiiB_RYPqupegIWk3MzMRhnKRYG6Rc8LniDW4_IVy5gzD9cM2zOoM7nYsJqdzgRPNBA
user={"id":7127128314,"first_name":"alan","last_name":"","username":"hendrix611","language_code":"ru","allows_write_to_pm":true,"photo_url":"https:\/\/t.me\/i\/userpic\/320\/r_XQW7YBVizKM8MjLDsK8dnxVkEfAqTG4IPkkViiyAU0Uay7uCZ9VM14-8vu0UC5.svg"}
2025-05-31 13:18:49,619 - backend.auth - DEBUG - Secret key created using HMAC_SHA256(<bot_token>, "WebAppData") (first 5 bytes): b'7\x9a\xa6{\x19'
2025-05-31 13:18:49,620 - backend.auth - DEBUG - Calculated hash: b2203b61ded320ec11bdf71d38c54eded30b9579ca859de2390b289c24163d15
2025-05-31 13:18:49,620 - backend.auth - DEBUG - Hash verification result: True
2025-05-31 13:18:49,621 - backend.auth - DEBUG - ==================================================

2025-05-31 13:18:49,621 - AUTH - INFO - Hash verification successful
2025-05-31 13:18:49,622 - AUTH - INFO - Parsing user data...
2025-05-31 13:18:49,622 - AUTH - DEBUG - Raw user data length: 343
2025-05-31 13:18:49,624 - AUTH - DEBUG - URL-decoded user data length: 239
2025-05-31 13:18:49,624 - AUTH - DEBUG - Parsed user_info: ID=7127128314, username=hendrix611
2025-05-31 13:18:49,625 - AUTH - DEBUG - Converted telegram_id to int: 7127128314 (type: <class 'int'>)
2025-05-31 13:18:49,625 - AUTH - INFO - Looking up user with telegram_id: 7127128314
2025-05-31 13:18:49,626 - AUTH - INFO - Found existing user: hendrix611 (ID: 4, Telegram ID: 7127128314)
2025-05-31 13:18:49,627 - AUTH - INFO - Creating JWT tokens for user: hendrix611
2025-05-31 13:18:49,628 - backend.auth - DEBUG - JWT created for hendrix611 (exp 2025-06-01 10:18:49.628420)
2025-05-31 13:18:49,628 - backend.auth - DEBUG - JWT created for hendrix611 (exp 2025-06-01 10:18:49.628972)
2025-05-31 13:18:49,630 - AUTH - INFO - === Authentication Successful ===
2025-05-31 13:18:49,630 - AUTH - INFO - ********************************************************************************


2025-05-31 13:18:49,631 - AUTH - INFO - [2e54a2d0-aa12-41a6-9d6a-bdee268ec740] Response status: 200 - Completed in 0.0352s
2025-05-31 13:18:50,041 - AUTH - INFO - [b88647f7-5e8d-4781-bce2-bcdab469bbd2] Request from 77.91.101.132:0 - GET /listings/
2025-05-31 13:18:50,046 - AUTH - INFO - [b88647f7-5e8d-4781-bce2-bcdab469bbd2] Response status: 200 - Completed in 0.0032s
2025-05-31 13:18:52,532 - AUTH - INFO - [b07f84ca-6547-48b2-97a4-90be66e1b574] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 13:18:52,534 - AUTH - INFO - [a22dfb05-17ad-4344-9a56-ac339a439cf0] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 13:18:52,535 - AUTH - INFO - [a50f3f2c-ddf8-434f-9518-2981340434d3] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 13:18:52,536 - AUTH - INFO - [4cf0aa30-847d-46a6-b0c8-e72f3e1d2502] Request from 77.91.101.132:0 - GET /listings/user/4/
2025-05-31 13:18:52,541 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 4
2025-05-31 13:18:52,545 - AUTH - INFO - [4cf0aa30-847d-46a6-b0c8-e72f3e1d2502] Response status: 200 - Completed in 0.0093s
2025-05-31 13:18:52,546 - AUTH - INFO - [a22dfb05-17ad-4344-9a56-ac339a439cf0] Response status: 200 - Completed in 0.0124s
2025-05-31 13:18:52,547 - AUTH - INFO - [b07f84ca-6547-48b2-97a4-90be66e1b574] Response status: 200 - Completed in 0.0150s
2025-05-31 13:18:52,547 - AUTH - INFO - [GetTransactionPartners] Found 0 completed listings involving user 4
2025-05-31 13:18:52,548 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 13:18:52,550 - AUTH - INFO - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 13:18:52,554 - AUTH - INFO - [a50f3f2c-ddf8-434f-9518-2981340434d3] Response status: 200 - Completed in 0.0178s
2025-05-31 13:18:52,716 - AUTH - INFO - [56cf24d1-2587-4fb1-a164-54c0636c4160] Request from 77.91.101.132:0 - GET /listings/user/4/
2025-05-31 13:18:52,717 - AUTH - INFO - [68e165bc-5ae3-4a72-bca8-ceae4097e812] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 13:18:52,718 - AUTH - INFO - [04497abc-9b43-4883-9380-e59723590391] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 13:18:52,726 - AUTH - INFO - [04497abc-9b43-4883-9380-e59723590391] Response status: 200 - Completed in 0.0081s
2025-05-31 13:18:52,727 - AUTH - INFO - [56cf24d1-2587-4fb1-a164-54c0636c4160] Response status: 200 - Completed in 0.0113s
2025-05-31 13:18:52,728 - AUTH - INFO - [68e165bc-5ae3-4a72-bca8-ceae4097e812] Response status: 200 - Completed in 0.0112s
2025-05-31 13:18:52,809 - AUTH - INFO - [11b6a134-6218-41bf-a6f9-a92e4f1081f0] Request from 77.91.101.132:0 - GET /users/transactions/
2025-05-31 13:18:52,811 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 4
2025-05-31 13:18:52,812 - AUTH - INFO - [GetTransactionPartners] Found 0 completed listings involving user 4
2025-05-31 13:18:52,813 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 13:18:52,814 - AUTH - INFO - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 13:18:52,814 - AUTH - INFO - [11b6a134-6218-41bf-a6f9-a92e4f1081f0] Response status: 200 - Completed in 0.0050s
2025-05-31 13:18:53,442 - AUTH - INFO - [6a22b240-405b-4b1a-9ac8-dfa9552465b6] Request from 77.91.101.132:0 - GET /static/avatars/user_2_avatar_1748684660.jpg
2025-05-31 13:18:53,445 - AUTH - INFO - [6a22b240-405b-4b1a-9ac8-dfa9552465b6] Response status: 304 - Completed in 0.0010s
2025-05-31 13:18:54,346 - AUTH - INFO - [1ac55711-e1a3-4708-82dd-275abe353555] Request from 77.91.101.132:0 - POST /friends/2/accept/
2025-05-31 13:18:54,347 - AUTH - INFO - [1ac55711-e1a3-4708-82dd-275abe353555] Request body for POST will be processed by endpoint.
2025-05-31 13:18:54,358 - AUTH - INFO - [1ac55711-e1a3-4708-82dd-275abe353555] Response status: 200 - Completed in 0.0113s
2025-05-31 13:18:54,563 - AUTH - INFO - [2fa5513d-dd26-45f1-adb5-c0d2afe10554] Request from 77.91.101.132:0 - GET /friends/
2025-05-31 13:18:54,566 - AUTH - INFO - [78a7f7d2-73fb-4b88-851d-08ba8c500237] Request from 77.91.101.132:0 - GET /friends/pending/
2025-05-31 13:18:54,573 - AUTH - INFO - [2fa5513d-dd26-45f1-adb5-c0d2afe10554] Response status: 200 - Completed in 0.0085s
2025-05-31 13:18:54,574 - AUTH - INFO - [78a7f7d2-73fb-4b88-851d-08ba8c500237] Response status: 200 - Completed in 0.0079s
2025-05-31 13:19:58,778 - AUTH - INFO - [3dc26fb2-36c4-4b76-971b-a9358ce05c9f] Request from 5.35.38.40:0 - GET /auth/protected/
2025-05-31 13:19:58,783 - AUTH - INFO - [3dc26fb2-36c4-4b76-971b-a9358ce05c9f] Response status: 200 - Completed in 0.0029s
2025-05-31 13:19:59,191 - AUTH - INFO - [b097a0e9-fda9-424a-84bd-874073bad98a] Request from 5.35.38.40:0 - GET /user/me/
2025-05-31 13:19:59,194 - AUTH - DEBUG - [GetUserMe] Attempting to get current user.
2025-05-31 13:19:59,195 - AUTH - DEBUG - [GetUserMe] Token SUB: 1. Fetching user from DB.
2025-05-31 13:19:59,197 - AUTH - INFO - [GetUserMe] User test_user (ID: 1) found. Avatar path from DB to be returned: 'None'
2025-05-31 13:19:59,199 - AUTH - INFO - [b097a0e9-fda9-424a-84bd-874073bad98a] Response status: 200 - Completed in 0.0065s
2025-05-31 13:19:59,605 - AUTH - INFO - [826b25ee-72a0-4c19-9432-61f6b2ef6b2a] Request from 5.35.38.40:0 - GET /listings/
2025-05-31 13:19:59,608 - AUTH - INFO - [826b25ee-72a0-4c19-9432-61f6b2ef6b2a] Response status: 200 - Completed in 0.0032s
2025-05-31 13:20:03,094 - AUTH - INFO - [65b49358-b200-4525-bd62-9f50fc38b1b4] Request from 5.35.38.40:0 - GET /listings/user/1/
2025-05-31 13:20:03,095 - AUTH - INFO - [cdfe2cf1-87c8-4688-9c5c-6ed56daea336] Request from 5.35.38.40:0 - GET /friends/
2025-05-31 13:20:03,097 - AUTH - INFO - [a3a4ffec-11fd-40c2-a777-c346735c03f4] Request from 5.35.38.40:0 - GET /users/transactions/
2025-05-31 13:20:03,103 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 1
2025-05-31 13:20:03,104 - AUTH - INFO - [65b49358-b200-4525-bd62-9f50fc38b1b4] Response status: 200 - Completed in 0.0091s
2025-05-31 13:20:03,106 - AUTH - INFO - [GetTransactionPartners] Found 0 completed listings involving user 1
2025-05-31 13:20:03,107 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 13:20:03,108 - AUTH - INFO - [cdfe2cf1-87c8-4688-9c5c-6ed56daea336] Response status: 200 - Completed in 0.0117s
2025-05-31 13:20:03,108 - AUTH - INFO - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 13:20:03,111 - AUTH - INFO - [d5ea3483-d4a6-48e0-a7e3-a370a860d522] Request from 5.35.38.40:0 - GET /friends/pending/
2025-05-31 13:20:03,114 - AUTH - INFO - [a3a4ffec-11fd-40c2-a777-c346735c03f4] Response status: 200 - Completed in 0.0155s
2025-05-31 13:20:03,118 - AUTH - INFO - [d5ea3483-d4a6-48e0-a7e3-a370a860d522] Response status: 200 - Completed in 0.0061s
2025-05-31 13:20:10,033 - AUTH - INFO - [e29e4265-724b-4914-bc2e-976a9f06c60c] Request from 5.35.38.40:0 - POST /profile/1/avatar/
2025-05-31 13:20:10,033 - AUTH - INFO - [e29e4265-724b-4914-bc2e-976a9f06c60c] Request body for POST will be processed by endpoint.
2025-05-31 13:20:10,300 - AUTH - INFO - [e29e4265-724b-4914-bc2e-976a9f06c60c] Response status: 200 - Completed in 0.2658s
2025-05-31 13:20:10,485 - AUTH - INFO - [fdcc4174-0c5a-4b04-8f2e-04ea54ae3eb3] Request from 5.35.38.40:0 - GET /static/avatars/user_1_avatar_1748686810.jpeg
2025-05-31 13:20:10,486 - AUTH - INFO - [fdcc4174-0c5a-4b04-8f2e-04ea54ae3eb3] Response status: 200 - Completed in 0.0011s
2025-05-31 13:20:42,353 - AUTH - INFO - [28fb8ea5-9f3b-4a2b-a225-168f1ac0c64c] Request from 5.35.38.40:0 - GET /listings/user/1/
2025-05-31 13:20:42,355 - AUTH - INFO - [785b2a7b-e7d0-49e7-843b-7d78c9ed2e43] Request from 5.35.38.40:0 - GET /friends/pending/
2025-05-31 13:20:42,357 - AUTH - INFO - [45b8f3c7-37d4-471f-a716-ebfc3d4a2c82] Request from 5.35.38.40:0 - GET /users/transactions/
2025-05-31 13:20:42,357 - AUTH - INFO - [b5de0262-2b64-4d49-b490-f89dc0502ef2] Request from 5.35.38.40:0 - GET /friends/
2025-05-31 13:20:42,363 - AUTH - INFO - [GetTransactionPartners] Fetching transaction partners for user_id: 1
2025-05-31 13:20:42,366 - AUTH - INFO - [28fb8ea5-9f3b-4a2b-a225-168f1ac0c64c] Response status: 200 - Completed in 0.0107s
2025-05-31 13:20:42,367 - AUTH - INFO - [GetTransactionPartners] Found 0 completed listings involving user 1
2025-05-31 13:20:42,367 - AUTH - INFO - [785b2a7b-e7d0-49e7-843b-7d78c9ed2e43] Response status: 200 - Completed in 0.0111s
2025-05-31 13:20:42,368 - AUTH - INFO - [GetTransactionPartners] Collected partner_ids: set()
2025-05-31 13:20:42,369 - AUTH - INFO - [GetTransactionPartners] No partner IDs found, returning empty list.
2025-05-31 13:20:42,371 - AUTH - INFO - [b5de0262-2b64-4d49-b490-f89dc0502ef2] Response status: 200 - Completed in 0.0115s
2025-05-31 13:20:42,374 - AUTH - INFO - [45b8f3c7-37d4-471f-a716-ebfc3d4a2c82] Response status: 200 - Completed in 0.0167s
2025-05-31 13:28:04,206 - backend.auth - INFO - ================================================================================
2025-05-31 13:28:04,207 - backend.auth - INFO - Authentication module initialized
2025-05-31 13:28:04,207 - backend.auth - INFO - BOT_TOKEN: 80221..._4-bU (length: 46)
2025-05-31 13:28:04,207 - backend.auth - INFO - ================================================================================
2025-05-31 13:28:04,208 - AUTH - INFO - ================================================================================
2025-05-31 13:28:04,209 - AUTH - INFO - Starting Time Banking API
2025-05-31 13:28:04,209 - AUTH - INFO - ================================================================================
2025-05-31 13:28:04,209 - AUTH - INFO - Bot token: 80221..._4-bU (length: 46)
2025-05-31 13:33:04,299 - backend.auth - INFO - ================================================================================
2025-05-31 13:33:04,300 - backend.auth - INFO - Authentication module initialized
2025-05-31 13:33:04,300 - backend.auth - INFO - BOT_TOKEN: 80221..._4-bU (length: 46)
2025-05-31 13:33:04,300 - backend.auth - INFO - ================================================================================
2025-05-31 13:33:04,302 - AUTH - INFO - ================================================================================
2025-05-31 13:33:04,302 - AUTH - INFO - Starting Time Banking API
2025-05-31 13:33:04,302 - AUTH - INFO - ================================================================================
2025-05-31 13:33:04,303 - AUTH - INFO - Bot token: 80221..._4-bU (length: 46)
